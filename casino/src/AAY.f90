module slaarnaay
use dsp
use slaarnaat
use slaarnabg
use slaarnabp
use store
use slaarnaag,  only : czero,zi
use slaarnabt,  only : ddot_alt,zdotu_alt,multi_ddot_s,multi_zdotu_s
use slaarnaca,      only : is_ae
implicit none
private
public gauss_per_cusp_bf_orb_eval
integer xyzzyaaaa1,xyzzyaaab1,xyzzyaaac1
real(dp) xyzzyaaad1(3)
contains
subroutine gauss_per_cusp_bf_orb_eval(rvec,jspin,norb,orbmask,norbc,co&
&rbmask,val,orbval,orbgrad,orblap,orbsderivs)
implicit none
integer,intent(in) :: jspin,norb,norbc
real(dp),intent(in) :: rvec(3)
real(dp),intent(inout) :: orbval(norb,real1_complex2),orbgrad(3,norb,r&
&eal1_complex2),orblap(norb,real1_complex2)
real(dp),intent(inout) :: orbsderivs(6,nemax,real1_complex2)
logical,intent(in) :: val,orbmask(norb),corbmask(norbc)
integer xyzzyaaaa2
real(dp) xyzzyaaab2,xyzzyaaac2,xyzzyaaad2,xyzzyaaae2,xyzzyaaaf2,xyzzya&
&aag2,xyzzyaaah2
select case (periodicity)
case(3)
xyzzyaaad1=anint(matmul(rvec,painv))
new_origin=matmul(xyzzyaaad1,pamat)
case(2)
xyzzyaaad1(1:2)=anint(matmul(rvec(1:2),painv(1:2,1:2)))
new_origin(1:2)=matmul(xyzzyaaad1(1:2),pamat(1:2,1:2))
new_origin(3)=0.d0
case(1)
xyzzyaaad1(1)=anint(rvec(1)*painv(1,1))
new_origin(1)=xyzzyaaad1(1)*pamat(1,1)
new_origin(2:3)=0.d0
end select
new_origin_to_rvec=rvec-new_origin
xyzzyaaab2=new_origin(1)
xyzzyaaac2=new_origin(2)
xyzzyaaad2=new_origin(3)
do xyzzyaaaa2=1,num_real_k
xyzzyaaae2=kvec(1,xyzzyaaaa2)
xyzzyaaaf2=kvec(2,xyzzyaaaa2)
xyzzyaaag2=kvec(3,xyzzyaaaa2)
xyzzyaaah2=xyzzyaaae2*xyzzyaaab2+xyzzyaaaf2*xyzzyaaac2+xyzzyaaag2*xyzz&
&yaaad2
coskdotg_shift(xyzzyaaaa2)=cos(xyzzyaaah2)
enddo
do xyzzyaaaa2=num_real_k_plus_1,num_k
xyzzyaaae2=kvec(1,xyzzyaaaa2)
xyzzyaaaf2=kvec(2,xyzzyaaaa2)
xyzzyaaag2=kvec(3,xyzzyaaaa2)
xyzzyaaah2=xyzzyaaae2*xyzzyaaab2+xyzzyaaaf2*xyzzyaaac2+xyzzyaaag2*xyzz&
&yaaad2
expikdotg_shift(xyzzyaaaa2)=exp(xyzzyaaah2*zi)
enddo
xyzzyaaaa1=which_ssingle(jspin,spin_dep_gs)
xyzzyaaab1=which_ssingle(jspin,spin_dep_in)
xyzzyaaac1=which_ssingle(jspin,spin_dep_full)
if(.not.val)then
call xyzzyaaae1(jspin,norb,orbmask,norbc,corbmask,orbgrad,orblap,orbsd&
&erivs)
else
call xyzzyaaaf1(jspin,norb,orbmask,norbc,corbmask,orbval,orbgrad,orbla&
&p,orbsderivs)
endif
if(complex_wf)then
if(val)orbval(:,2)=0.d0
orbgrad(:,:,2)=0.d0
orblap(:,2)=0.d0
orbsderivs(:,:,2)=0.d0
endif
end subroutine gauss_per_cusp_bf_orb_eval
subroutine xyzzyaaae1(jspin,norb,orbmask,norbc,corbmask,orbgrad,orblap&
&,orbsderivs)
implicit none
integer,intent(in) :: jspin,norb,norbc
real(dp),intent(inout) :: orbgrad(3,norb,real1_complex2),orblap(norb,r&
&eal1_complex2),orbsderivs(6,nemax,real1_complex2)
logical,intent(in) :: orbmask(norb),corbmask(norbc)
integer xyzzyaaaa3,xyzzyaaab3,xyzzyaaac3,xyzzyaaad3,xyzzyaaae3,xyzzyaa&
&af3,xyzzyaaag3,xyzzyaaah3,xyzzyaaai3,xyzzyaaaj3,xyzzyaaak3,xyzzyaaal3&
&,xyzzyaaam3,xyzzyaaan3,xyzzyaaao3,xyzzyaaap3,xyzzyaaaq3,xyzzyaaar3,xy&
&zzyaaas3,xyzzyaaat3,xyzzyaaau3,xyzzyaaav3,xyzzyaaaw3,xyzzyaaax3(num_a&
&o),xyzzyaaay3,xyzzyaaaz3
real(dp) xyzzyaaba3,xyzzyaabb3,xyzzyaabc3,xyzzyaabd3,xyzzyaabe3,xyzzya&
&abf3,xyzzyaabg3,xyzzyaabh3,xyzzyaabi3,xyzzyaabj3,xyzzyaabk3,xyzzyaabl&
&3,xyzzyaabm3,xyzzyaabn3,xyzzyaabo3,xyzzyaabp3,xyzzyaabq3,xyzzyaabr3,x&
&yzzyaabs3,xyzzyaabt3,xyzzyaabu3,xyzzyaabv3,xyzzyaabw3,xyzzyaabx3,xyzz&
&yaaby3,xyzzyaabz3,xyzzyaaca3,xyzzyaacb3,xyzzyaacc3,xyzzyaacd3,xyzzyaa&
&ce3,xyzzyaacf3,xyzzyaacg3,xyzzyaach3(7),xyzzyaaci3(21),xyzzyaacj3(42)&
&,xyzzyaack3(7),xyzzyaacl3(21),xyzzyaacm3(42),xyzzyaacn3(3),xyzzyaaco3&
&(3),xyzzyaacp3(3),xyzzyaacq3(3),xyzzyaacr3,xyzzyaacs3,xyzzyaact3,xyzz&
&yaacu3,xyzzyaacv3,xyzzyaacw3,xyzzyaacx3,xyzzyaacy3,xyzzyaacz3,xyzzyaa&
&da3,xyzzyaadb3,xyzzyaadc3,xyzzyaadd3,xyzzyaade3,xyzzyaadf3,xyzzyaadg3&
&,xyzzyaadh3,xyzzyaadi3,xyzzyaadj3,xyzzyaadk3,xyzzyaadl3,xyzzyaadm3,xy&
&zzyaadn3,xyzzyaado3,xyzzyaadp3,xyzzyaadq3
real(dp) xyzzyaadr3,xyzzyaads3,xyzzyaadt3,xyzzyaadu3,xyzzyaadv3,xyzzya&
&adw3,xyzzyaadx3,xyzzyaady3,xyzzyaadz3,xyzzyaaea3,xyzzyaaeb3,xyzzyaaec&
&3,xyzzyaaed3,xyzzyaaee3,xyzzyaaef3,xyzzyaaeg3,xyzzyaaeh3,xyzzyaaei3,x&
&yzzyaaej3,xyzzyaaek3,xyzzyaael3,xyzzyaaem3,xyzzyaaen3,xyzzyaaeo3,xyzz&
&yaaep3,xyzzyaaeq3,xyzzyaaer3,xyzzyaaes3,xyzzyaaet3,xyzzyaaeu3,xyzzyaa&
&ev3,xyzzyaaew3,xyzzyaaex3,xyzzyaaey3,xyzzyaaez3,xyzzyaafa3,xyzzyaafb3&
&,xyzzyaafc3,xyzzyaafd3,xyzzyaafe3,xyzzyaaff3,xyzzyaafg3,xyzzyaafh3,xy&
&zzyaafi3,xyzzyaafj3,xyzzyaafk3,xyzzyaafl3,xyzzyaafm3,xyzzyaafn3,xyzzy&
&aafo3,xyzzyaafp3,xyzzyaafq3,xyzzyaafr3,xyzzyaafs3,xyzzyaaft3,xyzzyaaf&
&u3,xyzzyaafv3,xyzzyaafw3,xyzzyaafx3,xyzzyaafy3,xyzzyaafz3,xyzzyaaga3,&
&xyzzyaagb3,xyzzyaagc3,xyzzyaagd3,xyzzyaage3,xyzzyaagf3,xyzzyaagg3,xyz&
&zyaagh3,xyzzyaagi3,xyzzyaagj3,xyzzyaagk3,xyzzyaagl3,xyzzyaagm3,xyzzya&
&agn3,xyzzyaago3,xyzzyaagp3,xyzzyaagq3,xyzzyaagr3,xyzzyaags3,xyzzyaagt&
&3,xyzzyaagu3,xyzzyaagv3,xyzzyaagw3,xyzzyaagx3,xyzzyaagy3,xyzzyaagz3,x&
&yzzyaaha3,xyzzyaahb3,xyzzyaahc3,xyzzyaahd3,xyzzyaahe3,xyzzyaahf3,xyzz&
&yaahg3,xyzzyaahh3,xyzzyaahi3,xyzzyaahj3,xyzzyaahk3,xyzzyaahl3,xyzzyaa&
&hm3,xyzzyaahn3,xyzzyaaho3,xyzzyaahp3,xyzzyaahq3,xyzzyaahr3,xyzzyaahs3&
&,xyzzyaaht3,xyzzyaahu3,xyzzyaahv3,xyzzyaahw3,xyzzyaahx3,xyzzyaahy3,xy&
&zzyaahz3,xyzzyaaia3,xyzzyaaib3,xyzzyaaic3,xyzzyaaid3,xyzzyaaie3,xyzzy&
&aaif3,xyzzyaaig3,xyzzyaaih3,xyzzyaaii3,xyzzyaaij3,xyzzyaaik3
real(dp) xyzzyaail3,xyzzyaaim3,xyzzyaain3,xyzzyaaio3,xyzzyaaip3,xyzzya&
&aiq3,xyzzyaair3,xyzzyaais3,xyzzyaait3,xyzzyaaiu3,xyzzyaaiv3,xyzzyaaiw&
&3,xyzzyaaix3,xyzzyaaiy3,xyzzyaaiz3,xyzzyaaja3,xyzzyaajb3,xyzzyaajc3,x&
&yzzyaajd3,xyzzyaaje3,xyzzyaajf3,xyzzyaajg3,xyzzyaajh3,xyzzyaaji3,xyzz&
&yaajj3,xyzzyaajk3,xyzzyaajl3,xyzzyaajm3,xyzzyaajn3,xyzzyaajo3,xyzzyaa&
&jp3,xyzzyaajq3,xyzzyaajr3,xyzzyaajs3,xyzzyaajt3,xyzzyaaju3,xyzzyaajv3&
&,xyzzyaajw3,xyzzyaajx3,xyzzyaajy3,xyzzyaajz3,xyzzyaaka3,xyzzyaakb3,xy&
&zzyaakc3,xyzzyaakd3,xyzzyaake3,xyzzyaakf3,xyzzyaakg3
complex(dp) xyzzyaakh3,xyzzyaaki3
logical xyzzyaakj3,xyzzyaakk3,xyzzyaakl3(nemaxc),xyzzyaakm3(nemaxc),xy&
&zzyaakn3,xyzzyaako3(num_shells)
xyzzyaaaq3=0
rblap=0.d0
rbgra1=0.d0
rbgra2=0.d0
rbgra3=0.d0
rbsderiv1=0.d0
rbsderiv2=0.d0
rbsderiv3=0.d0
rbsderiv4=0.d0
rbsderiv5=0.d0
rbsderiv6=0.d0
rblap_s=0.d0
rbgra1_s=0.d0
rbgra2_s=0.d0
rbgra3_s=0.d0
rbsderiv1_s=0.d0
rbsderiv2_s=0.d0
rbsderiv3_s=0.d0
rbsderiv4_s=0.d0
rbsderiv5_s=0.d0
rbsderiv6_s=0.d0
exp_poly1=0.d0
exp_poly2=0.d0
exp_poly3=0.d0
exp_poly4=0.d0
exp_poly5=0.d0
exp_poly6=0.d0
exp_poly7=0.d0
exp_poly8=0.d0
exp_poly9=0.d0
exp_poly10=0.d0
xyzzyaakm3=.false.
xyzzyaakk3=.true.
xyzzyaako3=.false.
if(complex_states)then
cblap=czero
cbgra1=czero
cbgra2=czero
cbgra3=czero
cblap_s=czero
cbgra1_s=czero
cbgra2_s=czero
cbgra3_s=czero
cbsderiv1=czero
cbsderiv2=czero
cbsderiv3=czero
cbsderiv4=czero
cbsderiv5=czero
cbsderiv6=czero
cbsderiv1_s=czero
cbsderiv2_s=czero
cbsderiv3_s=czero
cbsderiv4_s=czero
cbsderiv5_s=czero
cbsderiv6_s=czero
endif
do xyzzyaaaa3=1,num_cell
do xyzzyaaab3=1,num_real_k
phase(xyzzyaaab3)=coskdotg(xyzzyaaab3,xyzzyaaaa3)*coskdotg_shift(xyzzy&
&aaab3)
enddo
do xyzzyaaab3=num_real_k_plus_1,num_k
cphase(xyzzyaaab3)=expikdotg(xyzzyaaab3,xyzzyaaaa3)*expikdotg_shift(xy&
&zzyaaab3)
enddo
do xyzzyaaap3=1,num_centres_in_cell(xyzzyaaaa3)
xyzzyaaav3=which_ion(xyzzyaaap3,xyzzyaaaa3)
xyzzyaacn3(1)=xpos_in_cell(xyzzyaaap3,xyzzyaaaa3)
xyzzyaacn3(2)=ypos_in_cell(xyzzyaaap3,xyzzyaaaa3)
xyzzyaacn3(3)=zpos_in_cell(xyzzyaaap3,xyzzyaaaa3)
xyzzyaabb3=new_origin_to_rvec(1)-xyzzyaacn3(1)
xyzzyaabc3=new_origin_to_rvec(2)-xyzzyaacn3(2)
xyzzyaabd3=new_origin_to_rvec(3)-xyzzyaacn3(3)
xyzzyaabe3=xyzzyaabb3*xyzzyaabb3
xyzzyaabf3=xyzzyaabc3*xyzzyaabc3
xyzzyaabg3=xyzzyaabd3*xyzzyaabd3
xyzzyaaba3=xyzzyaabe3+xyzzyaabf3+xyzzyaabg3
xyzzyaabh3=xyzzyaabb3*xyzzyaabc3
xyzzyaabj3=xyzzyaabb3*xyzzyaabd3
xyzzyaabi3=xyzzyaabc3*xyzzyaabd3
if(complex_states)then
select case(ndim)
case(1)
xyzzyaaco3(1)=xyzzyaacn3(1)+new_origin(1)
xyzzyaaad1(1)=xyzzyaaco3(1)*ainv(1,1)+1.d-5
xyzzyaacq3(1)=real(floor(xyzzyaaad1(1)),dp)
xyzzyaacp3(1)=xyzzyaacq3(1)*amat(1,1)
xyzzyaaad1(1)=xyzzyaaco3(1)-xyzzyaacp3(1)
xyzzyaacq3(1)=xyzzyaaad1(1)*painv(1,1)+1.d-5
nnn(1)=floor(xyzzyaacq3(1))
case(2)
xyzzyaaco3(1:2)=xyzzyaacn3(1:2)+new_origin(1:2)
xyzzyaaad1(1:2)=matmul(xyzzyaaco3(1:2),ainv(1:2,1:2))+1.d-5
xyzzyaacq3(1:2)=real(floor(xyzzyaaad1(1:2)),dp)
xyzzyaacp3(1:2)=matmul(xyzzyaacq3(1:2),amat(1:2,1:2))
xyzzyaaad1(1:2)=xyzzyaaco3(1:2)-xyzzyaacp3(1:2)
xyzzyaacq3(1:2)=matmul(xyzzyaaad1(1:2),painv(1:2,1:2))+1.d-5
nnn(1:2)=floor(xyzzyaacq3(1:2))
case(3)
xyzzyaaco3=xyzzyaacn3+new_origin
xyzzyaaad1=matmul(xyzzyaaco3,ainv)+1.d-5
xyzzyaacq3=real(floor(xyzzyaaad1),dp)
xyzzyaacp3=matmul(xyzzyaacq3,amat)
xyzzyaaad1=xyzzyaaco3-xyzzyaacp3
xyzzyaacq3=matmul(xyzzyaaad1,painv)+1.d-5
nnn=floor(xyzzyaacq3)
end select
xyzzyaaav3=nbasis_to_nitot(nnn(1),nnn(2),nnn(3),xyzzyaaav3)
endif
if(is_ae(xyzzyaaav3))then
xyzzyaakj3=xyzzyaaba3<rcusp_sq_max(xyzzyaaav3,xyzzyaaac1)
xyzzyaakl3(1:nuc_nele(jspin))=xyzzyaaba3<rcusp_sq(1:nuc_nele(jspin),xy&
&zzyaaav3,xyzzyaaac1)
do xyzzyaaak3=1,nuc_nele(jspin)
if(xyzzyaakl3(xyzzyaaak3))xyzzyaakm3(xyzzyaaak3)=.true.
enddo
else
xyzzyaakj3=.false.
endif
xyzzyaaau3=num_shells_on_centre(xyzzyaaap3,xyzzyaaaa3)
do xyzzyaaac3=1,xyzzyaaau3
xyzzyaaaq3=xyzzyaaaq3+1
xyzzyaaao3=shell_sequence_number(xyzzyaaaq3)
xyzzyaacc3=min_exponent(xyzzyaaao3)
xyzzyaabq3=xyzzyaacc3*xyzzyaaba3
if(xyzzyaabq3>screening_tolerance)cycle
xyzzyaaad3=shell_am(xyzzyaaao3)
xyzzyaaae3=numao_in_shell(xyzzyaaao3)
xyzzyaaaf3=xyzzyaaae3*3
xyzzyaaag3=xyzzyaaae3*6
do xyzzyaaak3=1,xyzzyaaae3
xyzzyaack3(xyzzyaaak3)=0.d0
enddo
do xyzzyaaak3=1,xyzzyaaaf3
xyzzyaacl3(xyzzyaaak3)=0.d0
enddo
do xyzzyaaak3=1,xyzzyaaag3
xyzzyaacm3(xyzzyaaak3)=0.d0
enddo
xyzzyaaam3=primitive(xyzzyaaao3)
xyzzyaaan3=primitive(xyzzyaaao3+1)-1
xyzzyaakn3=.false.
do xyzzyaaal3=xyzzyaaam3,xyzzyaaan3
xyzzyaacc3=exponent(xyzzyaaal3)
xyzzyaabq3=xyzzyaacc3*xyzzyaaba3
if(xyzzyaabq3>30.d0)cycle
xyzzyaakn3=.true.
xyzzyaako3(xyzzyaaao3)=.true.
xyzzyaacd3=exp(-xyzzyaabq3)
xyzzyaabm3=-xyzzyaacc3-xyzzyaacc3
select case (xyzzyaaad3)
case(1)
xyzzyaace3=c_prim(xyzzyaaal3)*xyzzyaacd3*xyzzyaabm3
xyzzyaaci3(1)=xyzzyaabb3*xyzzyaace3
xyzzyaaci3(2)=xyzzyaabc3*xyzzyaace3
xyzzyaaci3(3)=xyzzyaabd3*xyzzyaace3
xyzzyaacj3(1)=(1.d0+xyzzyaabm3*xyzzyaabe3)*xyzzyaace3
xyzzyaacj3(2)=(1.d0+xyzzyaabm3*xyzzyaabf3)*xyzzyaace3
xyzzyaacj3(3)=(1.d0+xyzzyaabm3*xyzzyaabg3)*xyzzyaace3
xyzzyaach3(1)=xyzzyaacj3(1)+xyzzyaacj3(2)+xyzzyaacj3(3)
xyzzyaacj3(4)=xyzzyaabm3*xyzzyaabc3*xyzzyaaci3(1)
xyzzyaacj3(5)=xyzzyaabm3*xyzzyaabd3*xyzzyaaci3(1)
xyzzyaacj3(6)=xyzzyaabm3*xyzzyaabd3*xyzzyaaci3(2)
case(2)
xyzzyaaci3(1)=xyzzyaabm3*xyzzyaabb3
xyzzyaaci3(2)=xyzzyaabm3*xyzzyaabc3
xyzzyaaci3(3)=xyzzyaabm3*xyzzyaabd3
xyzzyaaci3(4)=1.d0+xyzzyaaci3(1)*xyzzyaabb3
xyzzyaaci3(5)=xyzzyaaci3(1)*xyzzyaabc3
xyzzyaaci3(6)=xyzzyaaci3(1)*xyzzyaabd3
xyzzyaaci3(8)=1.d0+xyzzyaaci3(2)*xyzzyaabc3
xyzzyaaci3(9)=xyzzyaaci3(2)*xyzzyaabd3
xyzzyaaci3(7)=xyzzyaaci3(5)
xyzzyaaci3(10)=xyzzyaaci3(6)
xyzzyaaci3(11)=xyzzyaaci3(9)
xyzzyaaci3(12)=1.d0+xyzzyaaci3(3)*xyzzyaabd3
xyzzyaacj3(1)=xyzzyaabm3*xyzzyaaci3(4)
xyzzyaacj3(2)=xyzzyaabm3*xyzzyaaci3(8)
xyzzyaacj3(3)=xyzzyaabm3*xyzzyaaci3(12)
xyzzyaacj3(4)=xyzzyaaci3(1)*xyzzyaaci3(2)
xyzzyaacj3(5)=xyzzyaaci3(1)*xyzzyaaci3(3)
xyzzyaacj3(6)=xyzzyaaci3(2)*xyzzyaaci3(3)
xyzzyaacj3(7)=xyzzyaaci3(1)*(xyzzyaaci3(4)+2.d0)
xyzzyaacj3(10)=xyzzyaaci3(2)*xyzzyaaci3(4)
xyzzyaacj3(13)=xyzzyaacj3(10)
xyzzyaacj3(11)=xyzzyaaci3(3)*xyzzyaaci3(4)
xyzzyaacj3(19)=xyzzyaacj3(11)
xyzzyaacj3(8)=xyzzyaaci3(1)*xyzzyaaci3(8)
xyzzyaacj3(16)=xyzzyaacj3(8)
xyzzyaacj3(14)=xyzzyaaci3(2)*(xyzzyaaci3(8)+2.d0)
xyzzyaacj3(18)=xyzzyaaci3(3)*xyzzyaaci3(8)
xyzzyaacj3(20)=xyzzyaacj3(18)
xyzzyaacj3(9)=xyzzyaaci3(1)*xyzzyaaci3(12)
xyzzyaacj3(23)=xyzzyaacj3(9)
xyzzyaacj3(15)=xyzzyaaci3(2)*xyzzyaaci3(12)
xyzzyaacj3(24)=xyzzyaacj3(15)
xyzzyaacj3(21)=xyzzyaaci3(3)*(xyzzyaaci3(12)+2.d0)
xyzzyaacj3(12)=xyzzyaaci3(1)*xyzzyaaci3(9)
xyzzyaacj3(17)=xyzzyaacj3(12)
xyzzyaacj3(22)=xyzzyaacj3(12)
xyzzyaace3=c_prim(xyzzyaaal3)*xyzzyaacd3
xyzzyaacf3=c_prim2(xyzzyaaal3)*xyzzyaacd3
xyzzyaaci3(1:3)=xyzzyaaci3(1:3)*xyzzyaace3
xyzzyaaci3(4:12)=xyzzyaaci3(4:12)*xyzzyaacf3
xyzzyaacj3(1:6)=xyzzyaacj3(1:6)*xyzzyaace3
xyzzyaacj3(7:24)=xyzzyaacj3(7:24)*xyzzyaacf3
xyzzyaach3(1)=xyzzyaacj3(1)+xyzzyaacj3(2)+xyzzyaacj3(3)
xyzzyaach3(2)=xyzzyaacj3(7)+xyzzyaacj3(8)+xyzzyaacj3(9)
xyzzyaach3(3)=xyzzyaacj3(13)+xyzzyaacj3(14)+xyzzyaacj3(15)
xyzzyaach3(4)=xyzzyaacj3(19)+xyzzyaacj3(20)+xyzzyaacj3(21)
case(3)
xyzzyaabn3=xyzzyaabm3*xyzzyaabb3
xyzzyaabo3=xyzzyaabm3*xyzzyaabc3
xyzzyaabp3=xyzzyaabm3*xyzzyaabd3
xyzzyaaci3(1)=1.d0+xyzzyaabn3*xyzzyaabb3
xyzzyaaci3(2)=xyzzyaabn3*xyzzyaabc3
xyzzyaaci3(3)=xyzzyaabn3*xyzzyaabd3
xyzzyaaci3(5)=1.d0+xyzzyaabo3*xyzzyaabc3
xyzzyaaci3(6)=xyzzyaabo3*xyzzyaabd3
xyzzyaaci3(9)=1.d0+xyzzyaabp3*xyzzyaabd3
xyzzyaaci3(4)=xyzzyaaci3(2)
xyzzyaaci3(7)=xyzzyaaci3(3)
xyzzyaaci3(8)=xyzzyaaci3(6)
xyzzyaacj3(1)=xyzzyaabn3*(xyzzyaaci3(1)+2.d0)
xyzzyaacj3(4)=xyzzyaabo3*xyzzyaaci3(1)
xyzzyaacj3(7)=xyzzyaacj3(4)
xyzzyaacj3(5)=xyzzyaabp3*xyzzyaaci3(1)
xyzzyaacj3(13)=xyzzyaacj3(5)
xyzzyaacj3(2)=xyzzyaabn3*xyzzyaaci3(5)
xyzzyaacj3(10)=xyzzyaacj3(2)
xyzzyaacj3(8)=xyzzyaabo3*(xyzzyaaci3(5)+2.d0)
xyzzyaacj3(12)=xyzzyaabp3*xyzzyaaci3(5)
xyzzyaacj3(14)=xyzzyaacj3(12)
xyzzyaacj3(3)=xyzzyaabn3*xyzzyaaci3(9)
xyzzyaacj3(17)=xyzzyaacj3(3)
xyzzyaacj3(9)=xyzzyaabo3*xyzzyaaci3(9)
xyzzyaacj3(18)=xyzzyaacj3(9)
xyzzyaacj3(15)=xyzzyaabp3*(xyzzyaaci3(9)+2.d0)
xyzzyaacj3(6)=xyzzyaabn3*xyzzyaaci3(6)
xyzzyaacj3(11)=xyzzyaacj3(6)
xyzzyaacj3(16)=xyzzyaacj3(6)
xyzzyaacf3=c_prim(xyzzyaaal3)*xyzzyaacd3
xyzzyaaci3(1:9)=xyzzyaaci3(1:9)*xyzzyaacf3
xyzzyaacj3(1:18)=xyzzyaacj3(1:18)*xyzzyaacf3
xyzzyaach3(1)=xyzzyaacj3(1)+xyzzyaacj3(2)+xyzzyaacj3(3)
xyzzyaach3(2)=xyzzyaacj3(7)+xyzzyaacj3(8)+xyzzyaacj3(9)
xyzzyaach3(3)=xyzzyaacj3(13)+xyzzyaacj3(14)+xyzzyaacj3(15)
case(4)
xyzzyaabl3=xyzzyaabe3-xyzzyaabf3
xyzzyaabk3=3.d0*xyzzyaabg3-xyzzyaaba3
xyzzyaabn3=xyzzyaabm3*xyzzyaabb3
xyzzyaadg3=xyzzyaabn3*xyzzyaabd3
xyzzyaabo3=xyzzyaabm3*xyzzyaabc3
xyzzyaadh3=xyzzyaabo3*xyzzyaabd3
xyzzyaabp3=xyzzyaabm3*xyzzyaabd3
xyzzyaadf3=xyzzyaabn3*xyzzyaabc3
xyzzyaabq3=1.d0+xyzzyaabn3*xyzzyaabb3
xyzzyaabx3=xyzzyaabq3+2.d0
xyzzyaabr3=1.d0+xyzzyaabo3*xyzzyaabc3
xyzzyaaby3=xyzzyaabr3+2.d0
xyzzyaabs3=1.d0+xyzzyaabp3*xyzzyaabd3
xyzzyaabz3=xyzzyaabs3+2.d0
xyzzyaabt3=xyzzyaabm3*xyzzyaabk3-2.d0
xyzzyaabu3=xyzzyaabm3*xyzzyaabl3
xyzzyaaci3(1)=xyzzyaabt3*xyzzyaabb3
xyzzyaaci3(2)=xyzzyaabt3*xyzzyaabc3
xyzzyaaci3(3)=(xyzzyaabt3+6.d0)*xyzzyaabd3
xyzzyaaci3(4)=xyzzyaabq3*xyzzyaabd3
xyzzyaaci3(5)=xyzzyaabn3*xyzzyaabi3
xyzzyaaci3(6)=xyzzyaabs3*xyzzyaabb3
xyzzyaaci3(7)=xyzzyaaci3(5)
xyzzyaaci3(8)=xyzzyaabr3*xyzzyaabd3
xyzzyaaci3(9)=xyzzyaabs3*xyzzyaabc3
xyzzyaaci3(10)=(2.d0+xyzzyaabm3*xyzzyaabl3)*xyzzyaabb3
xyzzyaaci3(11)=(xyzzyaabu3-2.d0)*xyzzyaabc3
xyzzyaaci3(12)=xyzzyaabu3*xyzzyaabd3
xyzzyaaci3(13)=xyzzyaabq3*xyzzyaabc3
xyzzyaaci3(14)=xyzzyaabr3*xyzzyaabb3
xyzzyaaci3(15)=xyzzyaaci3(5)
xyzzyaacg3=c_prim(xyzzyaaal3)*xyzzyaacd3
xyzzyaaci3(1:15)=xyzzyaaci3(1:15)*xyzzyaacg3
xyzzyaabv3=7.d0+xyzzyaabm3*xyzzyaaba3
xyzzyaabv3=xyzzyaabm3*xyzzyaabv3*xyzzyaacg3
xyzzyaach3(1)=xyzzyaabv3*xyzzyaabk3
xyzzyaach3(2)=xyzzyaabv3*xyzzyaabj3
xyzzyaach3(3)=xyzzyaabv3*xyzzyaabi3
xyzzyaach3(4)=xyzzyaabv3*xyzzyaabl3
xyzzyaach3(5)=xyzzyaabv3*xyzzyaabh3
xyzzyaabw3=xyzzyaabe3+xyzzyaabf3-2.d0*xyzzyaabg3
xyzzyaacj3(1)=-xyzzyaabn3*xyzzyaabn3*xyzzyaabw3-xyzzyaabm3*(xyzzyaabw3&
&+4.d0*xyzzyaabe3)-2.d0
xyzzyaacj3(2)=-xyzzyaabo3*xyzzyaabo3*xyzzyaabw3-xyzzyaabm3*(xyzzyaabw3&
&+4.d0*xyzzyaabf3)-2.d0
xyzzyaacj3(3)=-xyzzyaabp3*xyzzyaabp3*xyzzyaabw3-xyzzyaabm3*(xyzzyaabw3&
&-8.d0*xyzzyaabg3)+4.d0
xyzzyaaca3=2.d0*(1.d0+xyzzyaacc3*xyzzyaabw3)
xyzzyaacj3(4)=xyzzyaadf3*(xyzzyaaca3-6.d0)
xyzzyaacj3(5)=xyzzyaadg3*xyzzyaaca3
xyzzyaacj3(6)=xyzzyaadh3*xyzzyaaca3
xyzzyaacj3(7)=xyzzyaadg3*xyzzyaabx3
xyzzyaacj3(8)=xyzzyaadg3*xyzzyaabr3
xyzzyaacj3(9)=xyzzyaadg3*xyzzyaabz3
xyzzyaacj3(10)=xyzzyaadh3*xyzzyaabq3
xyzzyaacj3(11)=(-xyzzyaabq3)*(-xyzzyaabs3)
xyzzyaacj3(12)=xyzzyaadf3*xyzzyaabs3
xyzzyaacj3(13)=xyzzyaacj3(10)
xyzzyaacj3(14)=xyzzyaadh3*xyzzyaaby3
xyzzyaacj3(15)=xyzzyaadh3*xyzzyaabz3
xyzzyaacj3(16)=xyzzyaacj3(8)
xyzzyaacj3(17)=xyzzyaadf3*xyzzyaabs3
xyzzyaacj3(18)=(-xyzzyaabr3)*(-xyzzyaabs3)
xyzzyaacj3(19)=2.d0+xyzzyaabm3*(xyzzyaabq3*xyzzyaabl3+4.d0*xyzzyaabe3)
xyzzyaacj3(20)=xyzzyaabm3*(xyzzyaabr3*xyzzyaabl3-4.d0*xyzzyaabf3)-2.d0
xyzzyaacj3(21)=xyzzyaabm3*xyzzyaabl3*xyzzyaabs3
xyzzyaacj3(22)=xyzzyaabm3*xyzzyaabm3*xyzzyaabh3*xyzzyaabl3
xyzzyaacj3(23)=-2.d0*xyzzyaadg3*(xyzzyaacc3*xyzzyaabl3-1.d0)
xyzzyaacj3(24)=-2.d0*xyzzyaadh3*(xyzzyaacc3*xyzzyaabl3+1.d0)
xyzzyaacj3(25)=xyzzyaadf3*xyzzyaabx3
xyzzyaacj3(26)=xyzzyaadf3*xyzzyaaby3
xyzzyaacj3(27)=xyzzyaacj3(12)
xyzzyaacj3(28)=(-xyzzyaabq3)*(-xyzzyaabr3)
xyzzyaacj3(29)=xyzzyaacj3(10)
xyzzyaacj3(30)=xyzzyaacj3(8)
xyzzyaacj3(1:30)=xyzzyaacj3(1:30)*xyzzyaacg3
case(5)
xyzzyaacg3=c_prim(xyzzyaaal3)*xyzzyaacd3
xyzzyaadi3=xyzzyaabe3*xyzzyaabb3
xyzzyaadj3=xyzzyaabf3*xyzzyaabc3
xyzzyaadk3=xyzzyaabe3*xyzzyaabe3
xyzzyaadl3=xyzzyaabf3*xyzzyaabf3
xyzzyaadm3=xyzzyaabg3*xyzzyaabg3
xyzzyaadn3=xyzzyaabh3*xyzzyaabd3
xyzzyaajn3=xyzzyaabe3*xyzzyaabf3
xyzzyaajo3=xyzzyaabe3*xyzzyaabg3
xyzzyaajp3=xyzzyaabf3*xyzzyaabg3
xyzzyaado3=xyzzyaacc3*xyzzyaabe3
xyzzyaadp3=xyzzyaacc3*xyzzyaabf3
xyzzyaadq3=xyzzyaacc3*xyzzyaabg3
xyzzyaajq3=xyzzyaacc3*xyzzyaacc3
xyzzyaajr3=xyzzyaacc3*xyzzyaacg3
xyzzyaajs3=xyzzyaabb3*xyzzyaacg3
xyzzyaajt3=xyzzyaabc3*xyzzyaacg3
xyzzyaaju3=xyzzyaabd3*xyzzyaacg3
xyzzyaajv3=3.d0*xyzzyaabe3
xyzzyaajw3=3.d0*xyzzyaabf3
xyzzyaajx3=-2.d0*xyzzyaabg3
xyzzyaabq3=xyzzyaajv3+xyzzyaajw3+xyzzyaajx3
xyzzyaabr3=xyzzyaacc3*xyzzyaabq3
xyzzyaabs3=-3.d0+xyzzyaabr3
xyzzyaabt3=3.d0*xyzzyaadq3
xyzzyaabu3=-1.5d0+xyzzyaabt3
xyzzyaabv3=-12.d0*xyzzyaabg3
xyzzyaabw3=xyzzyaabv3+xyzzyaajv3+xyzzyaajw3
xyzzyaabx3=xyzzyaacc3*xyzzyaabw3
xyzzyaaby3=-3.d0+xyzzyaabx3
xyzzyaadr3=xyzzyaabh3*xyzzyaaby3*xyzzyaacg3
xyzzyaads3=3.d0*xyzzyaadp3
xyzzyaajy3=6.d0*xyzzyaabg3
xyzzyaadt3=-12.d0*xyzzyaadq3
xyzzyaadu3=12.d0+xyzzyaabx3
xyzzyaadv3=-30.d0*xyzzyaado3
xyzzyaadw3=30.d0*xyzzyaadp3
xyzzyaadx3=90.d0*xyzzyaadp3
xyzzyaady3=-45.d0*xyzzyaabf3
xyzzyaajz3=-6.d0*xyzzyaabe3
xyzzyaaka3=-6.d0*xyzzyaabf3
xyzzyaadz3=xyzzyaajz3+xyzzyaaka3+4.d0*xyzzyaabg3
xyzzyaaea3=-6.d0*xyzzyaadq3
xyzzyaaeb3=3.d0+xyzzyaaea3
xyzzyaakb3=4.d0*xyzzyaadm3
xyzzyaakc3=15.d0*xyzzyaabe3
xyzzyaaec3=xyzzyaakc3+xyzzyaajw3+xyzzyaajx3
xyzzyaaed3=xyzzyaacc3*xyzzyaaec3
xyzzyaaee3=xyzzyaajq3*xyzzyaadz3*xyzzyaabe3
xyzzyaaef3=-3.d0+xyzzyaaed3+xyzzyaaee3
xyzzyaaeg3=xyzzyaaef3*xyzzyaaju3
xyzzyaakd3=15.d0*xyzzyaabf3
xyzzyaaeh3=xyzzyaakd3+xyzzyaajv3+xyzzyaajx3
xyzzyaaei3=xyzzyaacc3*xyzzyaaeh3
xyzzyaaej3=xyzzyaajq3*xyzzyaadz3*xyzzyaabf3
xyzzyaaek3=-3.d0+xyzzyaaei3+xyzzyaaej3
xyzzyaael3=xyzzyaaek3*xyzzyaaju3
xyzzyaake3=9.d0*xyzzyaabe3
xyzzyaail3=9.d0*xyzzyaabf3
xyzzyaaim3=-14.d0*xyzzyaabg3
xyzzyaaem3=xyzzyaake3+xyzzyaail3+xyzzyaaim3
xyzzyaaen3=xyzzyaacc3*xyzzyaaem3
xyzzyaaeo3=xyzzyaajq3*xyzzyaadz3*xyzzyaabg3
xyzzyaaep3=6.d0+xyzzyaaen3+xyzzyaaeo3
xyzzyaaeq3=xyzzyaaep3*xyzzyaaju3
xyzzyaain3=24.d0*xyzzyaabg3
xyzzyaaer3=xyzzyaajz3+xyzzyaaka3+xyzzyaain3
xyzzyaaes3=xyzzyaajq3*xyzzyaaer3*xyzzyaabe3
xyzzyaaio3=21.d0*xyzzyaabe3
xyzzyaaip3=-36.d0*xyzzyaabg3
xyzzyaaet3=xyzzyaail3+xyzzyaaio3+xyzzyaaip3
xyzzyaaeu3=xyzzyaacc3*xyzzyaaet3
xyzzyaaev3=-9.d0+xyzzyaaeu3+xyzzyaaes3
xyzzyaaew3=xyzzyaaev3*xyzzyaajs3
xyzzyaaex3=xyzzyaabv3+xyzzyaakd3+xyzzyaajv3
xyzzyaaey3=xyzzyaacc3*xyzzyaaex3
xyzzyaaez3=xyzzyaajq3*xyzzyaaer3*xyzzyaabf3
xyzzyaafa3=-3.d0+xyzzyaaey3+xyzzyaaez3
xyzzyaafb3=xyzzyaafa3*xyzzyaajs3
xyzzyaaiq3=-60.d0*xyzzyaabg3
xyzzyaafc3=xyzzyaaiq3+xyzzyaajv3+xyzzyaajw3
xyzzyaafd3=xyzzyaacc3*xyzzyaafc3
xyzzyaafe3=xyzzyaajq3*xyzzyaaer3*xyzzyaabg3
xyzzyaaff3=12.d0+xyzzyaafd3+xyzzyaafe3
xyzzyaafg3=xyzzyaaff3*xyzzyaajs3
xyzzyaafh3=xyzzyaabv3+xyzzyaakc3+xyzzyaajw3
xyzzyaafi3=xyzzyaacc3*xyzzyaafh3
xyzzyaafj3=-3.d0+xyzzyaaes3+xyzzyaafi3
xyzzyaafk3=xyzzyaafj3*xyzzyaajt3
xyzzyaafl3=xyzzyaacc3*xyzzyaaer3
xyzzyaafm3=-18.d0+xyzzyaafl3
xyzzyaafn3=xyzzyaadn3*xyzzyaafm3*xyzzyaajr3
xyzzyaair3=21.d0*xyzzyaabf3
xyzzyaafo3=xyzzyaake3+xyzzyaaip3+xyzzyaair3
xyzzyaafp3=xyzzyaacc3*xyzzyaafo3
xyzzyaafq3=-9.d0+xyzzyaaez3+xyzzyaafp3
xyzzyaafr3=xyzzyaafq3*xyzzyaajt3
xyzzyaafs3=xyzzyaaff3*xyzzyaajt3
xyzzyaais3=30.d0*xyzzyaabf3
xyzzyaait3=-30.d0*xyzzyaabe3
xyzzyaaft3=-60.d0*xyzzyaadq3
xyzzyaakf3=60.d0*xyzzyaabe3
xyzzyaakg3=-60.d0*xyzzyaabf3
xyzzyaafu3=xyzzyaakf3+xyzzyaakg3
xyzzyaafv3=xyzzyaajq3*xyzzyaafu3*xyzzyaabg3
xyzzyaaiu3=-150.d0*xyzzyaabe3
xyzzyaafw3=xyzzyaais3+xyzzyaaiu3
xyzzyaafx3=xyzzyaacc3*xyzzyaafw3
xyzzyaaiv3=60.d0*xyzzyaadk3
xyzzyaafy3=-60.d0*xyzzyaajn3
xyzzyaafz3=xyzzyaaiv3+xyzzyaafy3
xyzzyaaga3=xyzzyaajq3*xyzzyaafz3
xyzzyaagb3=30.d0+xyzzyaafx3+xyzzyaaga3
xyzzyaagc3=xyzzyaagb3*xyzzyaaju3
xyzzyaaiw3=150.d0*xyzzyaabf3
xyzzyaagd3=xyzzyaait3+xyzzyaaiw3
xyzzyaage3=xyzzyaacc3*xyzzyaagd3
xyzzyaagf3=60.d0*xyzzyaajn3
xyzzyaaix3=-60.d0*xyzzyaadl3
xyzzyaagg3=xyzzyaagf3+xyzzyaaix3
xyzzyaagh3=xyzzyaajq3*xyzzyaagg3
xyzzyaagi3=-30.d0+xyzzyaage3+xyzzyaagh3
xyzzyaagj3=xyzzyaagi3*xyzzyaaju3
xyzzyaagk3=90.d0+xyzzyaaft3
xyzzyaagl3=xyzzyaagk3*xyzzyaabf3
xyzzyaagm3=-90.d0-xyzzyaaft3
xyzzyaagn3=xyzzyaagm3*xyzzyaabe3
xyzzyaago3=xyzzyaagl3+xyzzyaagn3
xyzzyaagp3=xyzzyaabd3*xyzzyaago3*xyzzyaajr3
xyzzyaaiy3=-60.d0*xyzzyaado3
xyzzyaaiz3=-60.d0*xyzzyaadp3
xyzzyaaja3=120.d0*xyzzyaado3
xyzzyaagq3=-180.d0+xyzzyaaja3
xyzzyaagr3=xyzzyaadn3*xyzzyaagq3*xyzzyaajr3
xyzzyaajb3=120.d0*xyzzyaadp3
xyzzyaags3=-180.d0+xyzzyaajb3
xyzzyaagt3=xyzzyaadn3*xyzzyaags3*xyzzyaajr3
xyzzyaajc3=120.d0*xyzzyaadq3
xyzzyaagu3=-180.d0+xyzzyaajc3
xyzzyaagv3=xyzzyaadn3*xyzzyaagu3*xyzzyaajr3
xyzzyaajd3=90.d0*xyzzyaabf3
xyzzyaagw3=-180.d0*xyzzyaajn3
xyzzyaagx3=xyzzyaaiv3+xyzzyaagw3
xyzzyaagy3=xyzzyaajq3*xyzzyaagx3
xyzzyaagz3=-180.d0*xyzzyaadp3
xyzzyaaje3=-210.d0*xyzzyaabe3
xyzzyaajf3=270.d0*xyzzyaabf3
xyzzyaaha3=xyzzyaaje3+xyzzyaajf3
xyzzyaahb3=xyzzyaacc3*xyzzyaaha3
xyzzyaahc3=90.d0+xyzzyaahb3+xyzzyaagy3
xyzzyaahd3=xyzzyaahc3*xyzzyaajs3
xyzzyaajg3=450.d0*xyzzyaabf3
xyzzyaahe3=xyzzyaait3+xyzzyaajg3
xyzzyaahf3=xyzzyaacc3*xyzzyaahe3
xyzzyaajh3=-180.d0*xyzzyaadl3
xyzzyaahg3=xyzzyaagf3+xyzzyaajh3
xyzzyaahh3=xyzzyaajq3*xyzzyaahg3
xyzzyaahi3=-90.d0+xyzzyaahf3+xyzzyaahh3
xyzzyaahj3=xyzzyaahi3*xyzzyaajs3
xyzzyaahk3=-180.d0*xyzzyaadq3
xyzzyaahl3=90.d0+xyzzyaahk3
xyzzyaahm3=xyzzyaahl3*xyzzyaabf3
xyzzyaahn3=-30.d0-xyzzyaaft3
xyzzyaaho3=xyzzyaahn3*xyzzyaabe3
xyzzyaahp3=xyzzyaahm3+xyzzyaaho3
xyzzyaahq3=xyzzyaabb3*xyzzyaahp3*xyzzyaajr3
xyzzyaahr3=30.d0+xyzzyaaft3
xyzzyaaji3=-90.d0*xyzzyaabe3
xyzzyaahs3=180.d0*xyzzyaajn3
xyzzyaaht3=xyzzyaaix3+xyzzyaahs3
xyzzyaahu3=xyzzyaajq3*xyzzyaaht3
xyzzyaajj3=-450.d0*xyzzyaabe3
xyzzyaahv3=xyzzyaais3+xyzzyaajj3
xyzzyaahw3=xyzzyaacc3*xyzzyaahv3
xyzzyaajk3=180.d0*xyzzyaadk3
xyzzyaahx3=xyzzyaafy3+xyzzyaajk3
xyzzyaahy3=xyzzyaajq3*xyzzyaahx3
xyzzyaahz3=90.d0+xyzzyaahw3+xyzzyaahy3
xyzzyaaia3=xyzzyaahz3*xyzzyaajt3
xyzzyaajl3=-270.d0*xyzzyaabe3
xyzzyaajm3=210.d0*xyzzyaabf3
xyzzyaaib3=xyzzyaajl3+xyzzyaajm3
xyzzyaaic3=xyzzyaacc3*xyzzyaaib3
xyzzyaaid3=-9.d1+xyzzyaaic3+xyzzyaahu3
xyzzyaaie3=xyzzyaaid3*xyzzyaajt3
xyzzyaaif3=xyzzyaahr3*xyzzyaabf3
xyzzyaaig3=180.d0*xyzzyaadq3
xyzzyaaih3=-90.d0+xyzzyaaig3
xyzzyaaii3=xyzzyaaih3*xyzzyaabe3
xyzzyaaij3=xyzzyaaif3+xyzzyaaii3
xyzzyaaik3=xyzzyaabc3*xyzzyaaij3*xyzzyaajr3
xyzzyaaci3(1)=xyzzyaabj3*xyzzyaacg3*xyzzyaabs3
xyzzyaaci3(2)=xyzzyaabi3*xyzzyaacg3*xyzzyaabs3
xyzzyaaci3(3)=xyzzyaacg3*(3.d0*xyzzyaabg3-2.d0*xyzzyaacc3*xyzzyaadm3+x&
&yzzyaabu3*(xyzzyaabe3+xyzzyaabf3))
xyzzyaaci3(4)=xyzzyaacg3*((-4.5d0+xyzzyaads3+xyzzyaadt3)*xyzzyaabe3-1.&
&5d0*xyzzyaabf3+3.d0*xyzzyaacc3*xyzzyaadk3+xyzzyaajy3)
xyzzyaaci3(5)=xyzzyaadr3
xyzzyaaci3(6)=xyzzyaabj3*xyzzyaadu3*xyzzyaacg3
xyzzyaaci3(7)=xyzzyaadr3
xyzzyaaci3(8)=xyzzyaacg3*(3.d0*xyzzyaacc3*xyzzyaadl3+(-1.5d0+xyzzyaads&
&3)*xyzzyaabe3+(-4.5d0+xyzzyaadt3)*xyzzyaabf3+xyzzyaajy3)
xyzzyaaci3(9)=xyzzyaabi3*xyzzyaadu3*xyzzyaacg3
xyzzyaaci3(10)=xyzzyaabj3*(30.d0+xyzzyaadv3+xyzzyaadw3)*xyzzyaacg3
xyzzyaaci3(11)=xyzzyaabi3*(-30.d0+xyzzyaadv3+xyzzyaadw3)*xyzzyaacg3
xyzzyaaci3(12)=(xyzzyaabe3*(15.d0-30.d0*xyzzyaadq3)+xyzzyaabf3*(-15.d0&
&+30.d0*xyzzyaadq3))*xyzzyaacg3
xyzzyaaci3(13)=xyzzyaabi3*(30.d0+xyzzyaaiy3)*xyzzyaacg3
xyzzyaaci3(14)=xyzzyaabj3*(30.d0+xyzzyaaiz3)*xyzzyaacg3
xyzzyaaci3(15)=xyzzyaabh3*xyzzyaahr3*xyzzyaacg3
xyzzyaaci3(16)=xyzzyaacg3*(xyzzyaady3+(45.d0+xyzzyaadx3)*xyzzyaabe3-30&
&.d0*xyzzyaacc3*xyzzyaadk3)
xyzzyaaci3(17)=xyzzyaabh3*(-90.d0+xyzzyaadv3+xyzzyaadx3)*xyzzyaacg3
xyzzyaaci3(18)=xyzzyaacc3*xyzzyaabj3*(xyzzyaait3+xyzzyaajd3)*xyzzyaacg&
&3
xyzzyaaci3(19)=xyzzyaabh3*(90.d0+xyzzyaadw3-90.d0*xyzzyaado3)*xyzzyaac&
&g3
xyzzyaaci3(20)=(30.d0*xyzzyaacc3*xyzzyaadl3+xyzzyaady3+xyzzyaabe3*(45.&
&d0-90.d0*xyzzyaadp3))*xyzzyaacg3
xyzzyaaci3(21)=xyzzyaabi3*(xyzzyaaji3+xyzzyaais3)*xyzzyaajr3
xyzzyaacj3(1)=xyzzyaaeg3
xyzzyaacj3(2)=xyzzyaael3
xyzzyaacj3(3)=xyzzyaaeq3
xyzzyaacj3(4)=(12.d0+xyzzyaacc3*xyzzyaadz3)*xyzzyaadn3*xyzzyaajr3
xyzzyaacj3(5)=xyzzyaacg3*(xyzzyaacc3*xyzzyaaeb3*xyzzyaadi3+xyzzyaabb3*&
&(-3.d0+xyzzyaajq3*(xyzzyaakb3-6.d0*xyzzyaajp3)+xyzzyaacc3*xyzzyaajw3)&
&)
xyzzyaacj3(6)=xyzzyaacg3*(xyzzyaacc3*xyzzyaaeb3*xyzzyaadj3+xyzzyaabc3*&
&(-3.d0+xyzzyaajq3*(xyzzyaakb3-6.d0*xyzzyaajo3)+xyzzyaacc3*xyzzyaajv3)&
&)
xyzzyaacj3(7)=xyzzyaaew3
xyzzyaacj3(8)=xyzzyaafb3
xyzzyaacj3(9)=xyzzyaafg3
xyzzyaacj3(10)=xyzzyaafk3
xyzzyaacj3(11)=xyzzyaaju3*(12.d0+xyzzyaaes3+xyzzyaacc3*(xyzzyaabv3-15.&
&d0*xyzzyaabe3+xyzzyaajw3))
xyzzyaacj3(12)=xyzzyaafn3
xyzzyaacj3(13)=xyzzyaafk3
xyzzyaacj3(14)=xyzzyaafr3
xyzzyaacj3(15)=xyzzyaafs3
xyzzyaacj3(16)=xyzzyaafb3
xyzzyaacj3(17)=xyzzyaafn3
xyzzyaacj3(18)=xyzzyaaju3*(12.d0+xyzzyaaez3+xyzzyaacc3*(xyzzyaabv3-15.&
&d0*xyzzyaabf3+xyzzyaajv3))
xyzzyaacj3(19)=xyzzyaagc3
xyzzyaacj3(20)=xyzzyaagj3
xyzzyaacj3(21)=xyzzyaagp3
xyzzyaacj3(22)=60.d0*xyzzyaadn3*xyzzyaajq3*(xyzzyaabe3-xyzzyaabf3)*xyz&
&zyaacg3
xyzzyaacj3(23)=(30.d0+xyzzyaacc3*(xyzzyaait3+xyzzyaais3+xyzzyaaiq3)+xy&
&zzyaafv3)*xyzzyaajs3
xyzzyaacj3(24)=(-30.d0+xyzzyaafv3+xyzzyaacc3*(xyzzyaait3+xyzzyaais3+60&
&.d0*xyzzyaabg3))*xyzzyaajt3
xyzzyaacj3(25)=xyzzyaagr3
xyzzyaacj3(26)=xyzzyaagt3
xyzzyaacj3(27)=xyzzyaagv3
xyzzyaacj3(28)=(30.d0+xyzzyaaiy3+xyzzyaaiz3+120.d0*xyzzyaajq3*xyzzyaaj&
&n3)*xyzzyaaju3
xyzzyaacj3(29)=(30.d0+xyzzyaaiy3+xyzzyaaft3+120.d0*xyzzyaajq3*xyzzyaaj&
&o3)*xyzzyaajt3
xyzzyaacj3(30)=(30.d0+xyzzyaaiz3+xyzzyaaft3+120.d0*xyzzyaajq3*xyzzyaaj&
&p3)*xyzzyaajs3
xyzzyaacj3(31)=xyzzyaahd3
xyzzyaacj3(32)=xyzzyaahj3
xyzzyaacj3(33)=xyzzyaahq3
xyzzyaacj3(34)=(-90.d0+xyzzyaagy3+xyzzyaacc3*(xyzzyaajd3+90.d0*xyzzyaa&
&be3))*xyzzyaajt3
xyzzyaacj3(35)=(xyzzyaajd3+(-90.d0+xyzzyaagz3)*xyzzyaabe3+60.d0*xyzzya&
&acc3*xyzzyaadk3)*xyzzyaabd3*xyzzyaajr3
xyzzyaacj3(36)=(180.d0+xyzzyaagz3+60.d0*xyzzyaado3)*xyzzyaadn3*xyzzyaa&
&jr3
xyzzyaacj3(37)=xyzzyaaia3
xyzzyaacj3(38)=xyzzyaaie3
xyzzyaacj3(39)=xyzzyaaik3
xyzzyaacj3(40)=(90.d0+xyzzyaahu3+xyzzyaacc3*(xyzzyaaji3-90.d0*xyzzyaab&
&f3))*xyzzyaajs3
xyzzyaacj3(41)=(xyzzyaaiz3+180.d0*(xyzzyaado3-1.d0))*xyzzyaadn3*xyzzya&
&ajr3
xyzzyaacj3(42)=(-60.d0*xyzzyaacc3*xyzzyaadl3+xyzzyaajd3+xyzzyaabe3*(-9&
&0.d0+180.d0*xyzzyaadp3))*xyzzyaabd3*xyzzyaajr3
end select
do xyzzyaaak3=1,xyzzyaaae3
xyzzyaack3(xyzzyaaak3)=xyzzyaack3(xyzzyaaak3)+xyzzyaach3(xyzzyaaak3)
enddo
do xyzzyaaak3=1,xyzzyaaaf3
xyzzyaacl3(xyzzyaaak3)=xyzzyaacl3(xyzzyaaak3)+xyzzyaaci3(xyzzyaaak3)
enddo
do xyzzyaaak3=1,xyzzyaaag3
xyzzyaacm3(xyzzyaaak3)=xyzzyaacm3(xyzzyaaak3)+xyzzyaacj3(xyzzyaaak3)
enddo
enddo
if(xyzzyaakn3)then
xyzzyaaar3=first_ao(xyzzyaaao3)
xyzzyaaas3=xyzzyaaar3+xyzzyaaae3-1
if(.not.xyzzyaakj3.or.xyzzyaaad3>2)then
do xyzzyaaab3=1,num_real_k
rblap(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rblap(xyzzyaaar3:xyzzyaaas3,xy&
&zzyaaab3)+xyzzyaack3(1:xyzzyaaae3)*phase(xyzzyaaab3)
rbgra1(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbgra1(xyzzyaaar3:xyzzyaaas3,&
&xyzzyaaab3)+xyzzyaacl3(1:xyzzyaaaf3:3)*phase(xyzzyaaab3)
rbgra2(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbgra2(xyzzyaaar3:xyzzyaaas3,&
&xyzzyaaab3)+xyzzyaacl3(2:xyzzyaaaf3:3)*phase(xyzzyaaab3)
rbgra3(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbgra3(xyzzyaaar3:xyzzyaaas3,&
&xyzzyaaab3)+xyzzyaacl3(3:xyzzyaaaf3:3)*phase(xyzzyaaab3)
rbsderiv1(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbsderiv1(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+xyzzyaacm3(1:xyzzyaaag3:6)*phase(xyzzyaaab3)
rbsderiv2(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbsderiv2(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+xyzzyaacm3(2:xyzzyaaag3:6)*phase(xyzzyaaab3)
rbsderiv3(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbsderiv3(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+xyzzyaacm3(3:xyzzyaaag3:6)*phase(xyzzyaaab3)
rbsderiv4(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbsderiv4(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+xyzzyaacm3(4:xyzzyaaag3:6)*phase(xyzzyaaab3)
rbsderiv5(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbsderiv5(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+xyzzyaacm3(5:xyzzyaaag3:6)*phase(xyzzyaaab3)
rbsderiv6(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbsderiv6(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+xyzzyaacm3(6:xyzzyaaag3:6)*phase(xyzzyaaab3)
enddo
do xyzzyaaab3=num_real_k_plus_1,num_k
xyzzyaaki3=cphase(xyzzyaaab3)
cblap(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cblap(xyzzyaaar3:xyzzyaaas3,xy&
&zzyaaab3)+cmplx(xyzzyaack3(1:xyzzyaaae3),0.d0,kind=dp)*xyzzyaaki3
cbgra1(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbgra1(xyzzyaaar3:xyzzyaaas3,&
&xyzzyaaab3)+cmplx(xyzzyaacl3(1:xyzzyaaaf3:3),0.d0,kind=dp)*xyzzyaaki3
cbgra2(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbgra2(xyzzyaaar3:xyzzyaaas3,&
&xyzzyaaab3)+cmplx(xyzzyaacl3(2:xyzzyaaaf3:3),0.d0,kind=dp)*xyzzyaaki3
cbgra3(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbgra3(xyzzyaaar3:xyzzyaaas3,&
&xyzzyaaab3)+cmplx(xyzzyaacl3(3:xyzzyaaaf3:3),0.d0,kind=dp)*xyzzyaaki3
cbsderiv1(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbsderiv1(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+cmplx(xyzzyaacm3(1:xyzzyaaag3:6),0.d0,kind=dp)*xyzz&
&yaaki3
cbsderiv2(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbsderiv2(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+cmplx(xyzzyaacm3(2:xyzzyaaag3:6),0.d0,kind=dp)*xyzz&
&yaaki3
cbsderiv3(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbsderiv3(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+cmplx(xyzzyaacm3(3:xyzzyaaag3:6),0.d0,kind=dp)*xyzz&
&yaaki3
cbsderiv4(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbsderiv4(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+cmplx(xyzzyaacm3(4:xyzzyaaag3:6),0.d0,kind=dp)*xyzz&
&yaaki3
cbsderiv5(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbsderiv5(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+cmplx(xyzzyaacm3(5:xyzzyaaag3:6),0.d0,kind=dp)*xyzz&
&yaaki3
cbsderiv6(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbsderiv6(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+cmplx(xyzzyaacm3(6:xyzzyaaag3:6),0.d0,kind=dp)*xyzz&
&yaaki3
enddo
else
xyzzyaaak3=0
do xyzzyaaab3=1,num_real_k
rblap(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rblap(xyzzyaaar3:xyzzyaaas3,xy&
&zzyaaab3)+xyzzyaack3(1:xyzzyaaae3)*phase(xyzzyaaab3)
rbgra1(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbgra1(xyzzyaaar3:xyzzyaaas3,&
&xyzzyaaab3)+xyzzyaacl3(1:xyzzyaaaf3:3)*phase(xyzzyaaab3)
rbgra2(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbgra2(xyzzyaaar3:xyzzyaaas3,&
&xyzzyaaab3)+xyzzyaacl3(2:xyzzyaaaf3:3)*phase(xyzzyaaab3)
rbgra3(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbgra3(xyzzyaaar3:xyzzyaaas3,&
&xyzzyaaab3)+xyzzyaacl3(3:xyzzyaaaf3:3)*phase(xyzzyaaab3)
rbsderiv1(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbsderiv1(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+xyzzyaacm3(1:xyzzyaaag3:6)*phase(xyzzyaaab3)
rbsderiv2(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbsderiv2(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+xyzzyaacm3(2:xyzzyaaag3:6)*phase(xyzzyaaab3)
rbsderiv3(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbsderiv3(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+xyzzyaacm3(3:xyzzyaaag3:6)*phase(xyzzyaaab3)
rbsderiv4(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbsderiv4(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+xyzzyaacm3(4:xyzzyaaag3:6)*phase(xyzzyaaab3)
rbsderiv5(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbsderiv5(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+xyzzyaacm3(5:xyzzyaaag3:6)*phase(xyzzyaaab3)
rbsderiv6(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=rbsderiv6(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+xyzzyaacm3(6:xyzzyaaag3:6)*phase(xyzzyaaab3)
do xyzzyaaah3=1,nband(xyzzyaaab3,xyzzyaaaa1)
xyzzyaaak3=xyzzyaaak3+1
if(xyzzyaakl3(xyzzyaaak3))then
rblap_s(xyzzyaaar3,xyzzyaaak3)=rblap_s(xyzzyaaar3,xyzzyaaak3)+xyzzyaac&
&k3(1)*phase(xyzzyaaab3)
rbgra1_s(xyzzyaaar3,xyzzyaaak3)=rbgra1_s(xyzzyaaar3,xyzzyaaak3)+xyzzya&
&acl3(1)*phase(xyzzyaaab3)
rbgra2_s(xyzzyaaar3,xyzzyaaak3)=rbgra2_s(xyzzyaaar3,xyzzyaaak3)+xyzzya&
&acl3(2)*phase(xyzzyaaab3)
rbgra3_s(xyzzyaaar3,xyzzyaaak3)=rbgra3_s(xyzzyaaar3,xyzzyaaak3)+xyzzya&
&acl3(3)*phase(xyzzyaaab3)
rbsderiv1_s(xyzzyaaar3,xyzzyaaak3)=rbsderiv1_s(xyzzyaaar3,xyzzyaaak3)+&
&xyzzyaacm3(1)*phase(xyzzyaaab3)
rbsderiv2_s(xyzzyaaar3,xyzzyaaak3)=rbsderiv2_s(xyzzyaaar3,xyzzyaaak3)+&
&xyzzyaacm3(2)*phase(xyzzyaaab3)
rbsderiv3_s(xyzzyaaar3,xyzzyaaak3)=rbsderiv3_s(xyzzyaaar3,xyzzyaaak3)+&
&xyzzyaacm3(3)*phase(xyzzyaaab3)
rbsderiv4_s(xyzzyaaar3,xyzzyaaak3)=rbsderiv4_s(xyzzyaaar3,xyzzyaaak3)+&
&xyzzyaacm3(4)*phase(xyzzyaaab3)
rbsderiv5_s(xyzzyaaar3,xyzzyaaak3)=rbsderiv5_s(xyzzyaaar3,xyzzyaaak3)+&
&xyzzyaacm3(5)*phase(xyzzyaaab3)
rbsderiv6_s(xyzzyaaar3,xyzzyaaak3)=rbsderiv6_s(xyzzyaaar3,xyzzyaaak3)+&
&xyzzyaacm3(6)*phase(xyzzyaaab3)
endif
enddo
enddo
do xyzzyaaab3=num_real_k_plus_1,num_k
xyzzyaakh3=cphase(xyzzyaaab3)
cblap(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cblap(xyzzyaaar3:xyzzyaaas3,xy&
&zzyaaab3)+cmplx(xyzzyaack3(1:xyzzyaaae3),0.d0,kind=dp)*xyzzyaakh3
cbgra1(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbgra1(xyzzyaaar3:xyzzyaaas3,&
&xyzzyaaab3)+cmplx(xyzzyaacl3(1:xyzzyaaaf3:3),0.d0,kind=dp)*xyzzyaakh3
cbgra2(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbgra2(xyzzyaaar3:xyzzyaaas3,&
&xyzzyaaab3)+cmplx(xyzzyaacl3(2:xyzzyaaaf3:3),0.d0,kind=dp)*xyzzyaakh3
cbgra3(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbgra3(xyzzyaaar3:xyzzyaaas3,&
&xyzzyaaab3)+cmplx(xyzzyaacl3(3:xyzzyaaaf3:3),0.d0,kind=dp)*xyzzyaakh3
cbsderiv1(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbsderiv1(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+cmplx(xyzzyaacm3(1:xyzzyaaag3:6),0.d0,kind=dp)*xyzz&
&yaakh3
cbsderiv2(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbsderiv2(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+cmplx(xyzzyaacm3(2:xyzzyaaag3:6),0.d0,kind=dp)*xyzz&
&yaakh3
cbsderiv3(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbsderiv3(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+cmplx(xyzzyaacm3(3:xyzzyaaag3:6),0.d0,kind=dp)*xyzz&
&yaakh3
cbsderiv4(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbsderiv4(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+cmplx(xyzzyaacm3(4:xyzzyaaag3:6),0.d0,kind=dp)*xyzz&
&yaakh3
cbsderiv5(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbsderiv5(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+cmplx(xyzzyaacm3(5:xyzzyaaag3:6),0.d0,kind=dp)*xyzz&
&yaakh3
cbsderiv6(xyzzyaaar3:xyzzyaaas3,xyzzyaaab3)=cbsderiv6(xyzzyaaar3:xyzzy&
&aaas3,xyzzyaaab3)+cmplx(xyzzyaacm3(6:xyzzyaaag3:6),0.d0,kind=dp)*xyzz&
&yaakh3
do xyzzyaaah3=1,nband(xyzzyaaab3,xyzzyaaaa1)
xyzzyaaak3=xyzzyaaak3+1
if(xyzzyaakl3(xyzzyaaak3))then
cblap_s(xyzzyaaar3,xyzzyaaak3)=cblap_s(xyzzyaaar3,xyzzyaaak3)+cmplx(xy&
&zzyaack3(1),0.d0,kind=dp)*xyzzyaakh3
cbgra1_s(xyzzyaaar3,xyzzyaaak3)=cbgra1_s(xyzzyaaar3,xyzzyaaak3)+cmplx(&
&xyzzyaacl3(1),0.d0,kind=dp)*xyzzyaakh3
cbgra2_s(xyzzyaaar3,xyzzyaaak3)=cbgra2_s(xyzzyaaar3,xyzzyaaak3)+cmplx(&
&xyzzyaacl3(2),0.d0,kind=dp)*xyzzyaakh3
cbgra3_s(xyzzyaaar3,xyzzyaaak3)=cbgra3_s(xyzzyaaar3,xyzzyaaak3)+cmplx(&
&xyzzyaacl3(3),0.d0,kind=dp)*xyzzyaakh3
cbsderiv1_s(xyzzyaaar3,xyzzyaaak3)=cbsderiv1_s(xyzzyaaar3,xyzzyaaak3)+&
&cmplx(xyzzyaacm3(1),0.d0,kind=dp)*xyzzyaakh3
cbsderiv2_s(xyzzyaaar3,xyzzyaaak3)=cbsderiv2_s(xyzzyaaar3,xyzzyaaak3)+&
&cmplx(xyzzyaacm3(2),0.d0,kind=dp)*xyzzyaakh3
cbsderiv3_s(xyzzyaaar3,xyzzyaaak3)=cbsderiv3_s(xyzzyaaar3,xyzzyaaak3)+&
&cmplx(xyzzyaacm3(3),0.d0,kind=dp)*xyzzyaakh3
cbsderiv4_s(xyzzyaaar3,xyzzyaaak3)=cbsderiv4_s(xyzzyaaar3,xyzzyaaak3)+&
&cmplx(xyzzyaacm3(4),0.d0,kind=dp)*xyzzyaakh3
cbsderiv5_s(xyzzyaaar3,xyzzyaaak3)=cbsderiv5_s(xyzzyaaar3,xyzzyaaak3)+&
&cmplx(xyzzyaacm3(5),0.d0,kind=dp)*xyzzyaakh3
cbsderiv6_s(xyzzyaaar3,xyzzyaaak3)=cbsderiv6_s(xyzzyaaar3,xyzzyaaak3)+&
&cmplx(xyzzyaacm3(6),0.d0,kind=dp)*xyzzyaakh3
endif
xyzzyaaak3=xyzzyaaak3+1
if(xyzzyaakl3(xyzzyaaak3))then
cblap_s(xyzzyaaar3,xyzzyaaak3)=cblap_s(xyzzyaaar3,xyzzyaaak3)+cmplx(xy&
&zzyaack3(1),0.d0,kind=dp)*xyzzyaakh3
cbgra1_s(xyzzyaaar3,xyzzyaaak3)=cbgra1_s(xyzzyaaar3,xyzzyaaak3)+cmplx(&
&xyzzyaacl3(1),0.d0,kind=dp)*xyzzyaakh3
cbgra2_s(xyzzyaaar3,xyzzyaaak3)=cbgra2_s(xyzzyaaar3,xyzzyaaak3)+cmplx(&
&xyzzyaacl3(2),0.d0,kind=dp)*xyzzyaakh3
cbgra3_s(xyzzyaaar3,xyzzyaaak3)=cbgra3_s(xyzzyaaar3,xyzzyaaak3)+cmplx(&
&xyzzyaacl3(3),0.d0,kind=dp)*xyzzyaakh3
cbsderiv1_s(xyzzyaaar3,xyzzyaaak3)=cbsderiv1_s(xyzzyaaar3,xyzzyaaak3)+&
&cmplx(xyzzyaacm3(1),0.d0,kind=dp)*xyzzyaakh3
cbsderiv2_s(xyzzyaaar3,xyzzyaaak3)=cbsderiv2_s(xyzzyaaar3,xyzzyaaak3)+&
&cmplx(xyzzyaacm3(2),0.d0,kind=dp)*xyzzyaakh3
cbsderiv3_s(xyzzyaaar3,xyzzyaaak3)=cbsderiv3_s(xyzzyaaar3,xyzzyaaak3)+&
&cmplx(xyzzyaacm3(3),0.d0,kind=dp)*xyzzyaakh3
cbsderiv4_s(xyzzyaaar3,xyzzyaaak3)=cbsderiv4_s(xyzzyaaar3,xyzzyaaak3)+&
&cmplx(xyzzyaacm3(4),0.d0,kind=dp)*xyzzyaakh3
cbsderiv5_s(xyzzyaaar3,xyzzyaaak3)=cbsderiv5_s(xyzzyaaar3,xyzzyaaak3)+&
&cmplx(xyzzyaacm3(5),0.d0,kind=dp)*xyzzyaakh3
cbsderiv6_s(xyzzyaaar3,xyzzyaaak3)=cbsderiv6_s(xyzzyaaar3,xyzzyaaak3)+&
&cmplx(xyzzyaacm3(6),0.d0,kind=dp)*xyzzyaakh3
endif
enddo
enddo
endif
endif
enddo
if(xyzzyaakj3)then
xyzzyaaak3=0
if(xyzzyaaba3/=0.d0)then
xyzzyaacb3=sqrt(xyzzyaaba3)
xyzzyaacr3=1.d0/xyzzyaacb3
xyzzyaacs3=2.d0*xyzzyaacr3
xyzzyaact3=xyzzyaabb3*xyzzyaacr3
xyzzyaacu3=xyzzyaabc3*xyzzyaacr3
xyzzyaacv3=xyzzyaabd3*xyzzyaacr3
else
xyzzyaacb3=0.d0
xyzzyaacs3=2.d0
xyzzyaact3=1.d0
xyzzyaacu3=1.d0
xyzzyaacv3=1.d0
xyzzyaacr3=1.d0
endif
do xyzzyaaab3=1,num_real_k
do xyzzyaaah3=1,nband(xyzzyaaab3,xyzzyaaaa1)
xyzzyaaak3=xyzzyaaak3+1
if(xyzzyaakl3(xyzzyaaak3))then
xyzzyaada3=acusp(1,xyzzyaaak3,xyzzyaaav3,xyzzyaaac1)
xyzzyaadb3=acusp(2,xyzzyaaak3,xyzzyaaav3,xyzzyaaac1)
xyzzyaadc3=acusp(3,xyzzyaaak3,xyzzyaaav3,xyzzyaaac1)
xyzzyaadd3=acusp(4,xyzzyaaak3,xyzzyaaav3,xyzzyaaac1)
xyzzyaade3=acusp(5,xyzzyaaak3,xyzzyaaav3,xyzzyaaac1)
xyzzyaacw3=xyzzyaada3+xyzzyaadb3*xyzzyaacb3
xyzzyaacx3=xyzzyaadb3+2.d0*xyzzyaadc3*xyzzyaacb3
xyzzyaacy3=2.d0*xyzzyaadc3+6.d0*xyzzyaadd3*xyzzyaacb3
xyzzyaacz3=xyzzyaacb3*xyzzyaacb3
xyzzyaacw3=xyzzyaacw3+xyzzyaadc3*xyzzyaacz3
xyzzyaacx3=xyzzyaacx3+3.d0*xyzzyaadd3*xyzzyaacz3
xyzzyaacy3=xyzzyaacy3+12.d0*xyzzyaade3*xyzzyaacz3
xyzzyaacz3=xyzzyaacz3*xyzzyaacb3
xyzzyaacw3=xyzzyaacw3+xyzzyaadd3*xyzzyaacz3
xyzzyaacx3=xyzzyaacx3+4.d0*xyzzyaade3*xyzzyaacz3
xyzzyaacz3=xyzzyaacz3*xyzzyaacb3
xyzzyaacw3=xyzzyaacw3+xyzzyaade3*xyzzyaacz3
xyzzyaabq3=exp(xyzzyaacw3)*disign(xyzzyaaak3,xyzzyaaav3,xyzzyaaac1)
xyzzyaabr3=xyzzyaabq3*xyzzyaacx3
xyzzyaabs3=(xyzzyaacs3+xyzzyaacx3)*xyzzyaacx3+xyzzyaacy3
xyzzyaabt3=xyzzyaacx3*(xyzzyaacx3-xyzzyaacr3)+xyzzyaacy3
xyzzyaabt3=xyzzyaabt3*xyzzyaacr3**2
xyzzyaabu3=xyzzyaacx3*xyzzyaacr3
xyzzyaabv3=xyzzyaabt3*xyzzyaabq3
exp_poly1(xyzzyaaak3)=exp_poly1(xyzzyaaak3)+xyzzyaabq3*xyzzyaabs3
exp_poly2(xyzzyaaak3)=exp_poly2(xyzzyaaak3)+xyzzyaabr3*xyzzyaact3
exp_poly3(xyzzyaaak3)=exp_poly3(xyzzyaaak3)+xyzzyaabr3*xyzzyaacu3
exp_poly4(xyzzyaaak3)=exp_poly4(xyzzyaaak3)+xyzzyaabr3*xyzzyaacv3
exp_poly5(xyzzyaaak3)=exp_poly5(xyzzyaaak3)+(xyzzyaabu3+xyzzyaabt3*xyz&
&zyaabe3)*xyzzyaabq3
exp_poly6(xyzzyaaak3)=exp_poly6(xyzzyaaak3)+(xyzzyaabu3+xyzzyaabt3*xyz&
&zyaabf3)*xyzzyaabq3
exp_poly7(xyzzyaaak3)=exp_poly7(xyzzyaaak3)+(xyzzyaabu3+xyzzyaabt3*xyz&
&zyaabg3)*xyzzyaabq3
exp_poly8(xyzzyaaak3)=exp_poly8(xyzzyaaak3)+xyzzyaabv3*xyzzyaabh3
exp_poly9(xyzzyaaak3)=exp_poly9(xyzzyaaak3)+xyzzyaabv3*xyzzyaabj3
exp_poly10(xyzzyaaak3)=exp_poly10(xyzzyaaak3)+xyzzyaabv3*xyzzyaabi3
endif
enddo
enddo
do xyzzyaaab3=num_real_k_plus_1,num_k
do xyzzyaaah3=1,nband(xyzzyaaab3,xyzzyaaaa1)
do xyzzyaaat3=0,1
xyzzyaaak3=xyzzyaaak3+1
if(xyzzyaaak3>nemax)exit
if(xyzzyaakl3(xyzzyaaak3))then
xyzzyaada3=acusp(1,xyzzyaaak3,xyzzyaaav3,xyzzyaaac1)
xyzzyaadb3=acusp(2,xyzzyaaak3,xyzzyaaav3,xyzzyaaac1)
xyzzyaadc3=acusp(3,xyzzyaaak3,xyzzyaaav3,xyzzyaaac1)
xyzzyaadd3=acusp(4,xyzzyaaak3,xyzzyaaav3,xyzzyaaac1)
xyzzyaade3=acusp(5,xyzzyaaak3,xyzzyaaav3,xyzzyaaac1)
xyzzyaacw3=xyzzyaada3+xyzzyaadb3*xyzzyaacb3
xyzzyaacx3=xyzzyaadb3+2.d0*xyzzyaadc3*xyzzyaacb3
xyzzyaacy3=2.d0*xyzzyaadc3+6.d0*xyzzyaadd3*xyzzyaacb3
xyzzyaacz3=xyzzyaacb3*xyzzyaacb3
xyzzyaacw3=xyzzyaacw3+xyzzyaadc3*xyzzyaacz3
xyzzyaacx3=xyzzyaacx3+3.d0*xyzzyaadd3*xyzzyaacz3
xyzzyaacy3=xyzzyaacy3+12.d0*xyzzyaade3*xyzzyaacz3
xyzzyaacz3=xyzzyaacz3*xyzzyaacb3
xyzzyaacw3=xyzzyaacw3+xyzzyaadd3*xyzzyaacz3
xyzzyaacx3=xyzzyaacx3+4.d0*xyzzyaade3*xyzzyaacz3
xyzzyaacz3=xyzzyaacz3*xyzzyaacb3
xyzzyaacw3=xyzzyaacw3+xyzzyaade3*xyzzyaacz3
xyzzyaabq3=exp(xyzzyaacw3)*disign(xyzzyaaak3,xyzzyaaav3,xyzzyaaac1)
xyzzyaabr3=xyzzyaabq3*xyzzyaacx3
xyzzyaabs3=(xyzzyaacs3+xyzzyaacx3)*xyzzyaacx3+xyzzyaacy3
xyzzyaabt3=xyzzyaacx3*(xyzzyaacx3-xyzzyaacr3)+xyzzyaacy3
xyzzyaabt3=xyzzyaabt3*xyzzyaacr3**2
xyzzyaabu3=xyzzyaacx3*xyzzyaacr3
xyzzyaabv3=xyzzyaabt3*xyzzyaabq3
exp_poly1(xyzzyaaak3)=exp_poly1(xyzzyaaak3)+xyzzyaabq3*xyzzyaabs3
exp_poly2(xyzzyaaak3)=exp_poly2(xyzzyaaak3)+xyzzyaabr3*xyzzyaact3
exp_poly3(xyzzyaaak3)=exp_poly3(xyzzyaaak3)+xyzzyaabr3*xyzzyaacu3
exp_poly4(xyzzyaaak3)=exp_poly4(xyzzyaaak3)+xyzzyaabr3*xyzzyaacv3
exp_poly5(xyzzyaaak3)=exp_poly5(xyzzyaaak3)+(xyzzyaabu3+xyzzyaabt3*xyz&
&zyaabe3)*xyzzyaabq3
exp_poly6(xyzzyaaak3)=exp_poly6(xyzzyaaak3)+(xyzzyaabu3+xyzzyaabt3*xyz&
&zyaabf3)*xyzzyaabq3
exp_poly7(xyzzyaaak3)=exp_poly7(xyzzyaaak3)+(xyzzyaabu3+xyzzyaabt3*xyz&
&zyaabg3)*xyzzyaabq3
exp_poly8(xyzzyaaak3)=exp_poly8(xyzzyaaak3)+xyzzyaabv3*xyzzyaabh3
exp_poly9(xyzzyaaak3)=exp_poly9(xyzzyaaak3)+xyzzyaabv3*xyzzyaabj3
exp_poly10(xyzzyaaak3)=exp_poly10(xyzzyaaak3)+xyzzyaabv3*xyzzyaabi3
endif
enddo
enddo
enddo
xyzzyaakk3=.false.
endif
enddo
enddo
if(.not.xyzzyaakk3)then
exp_poly1(1:nuc_nele(jspin))=exp_poly1(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly2(1:nuc_nele(jspin))=exp_poly2(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly3(1:nuc_nele(jspin))=exp_poly3(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly4(1:nuc_nele(jspin))=exp_poly4(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly5(1:nuc_nele(jspin))=exp_poly5(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly6(1:nuc_nele(jspin))=exp_poly6(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly7(1:nuc_nele(jspin))=exp_poly7(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly8(1:nuc_nele(jspin))=exp_poly8(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly9(1:nuc_nele(jspin))=exp_poly9(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly10(1:nuc_nele(jspin))=exp_poly10(1:nuc_nele(jspin))*one_over_r&
&norm
endif
xyzzyaaai3=0
xyzzyaaaj3=0
xyzzyaaay3=gauss_offset(jspin)
xyzzyaaaz3=gauss_offsetc(jspin)
if(xyzzyaakk3)then
xyzzyaaaw3=0
do xyzzyaaao3=1,num_shells
if(.not.xyzzyaako3(xyzzyaaao3))cycle
xyzzyaaar3=first_ao(xyzzyaaao3)-1
do xyzzyaaak3=1,numao_in_shell(xyzzyaaao3)
xyzzyaaaw3=xyzzyaaaw3+1
xyzzyaaax3(xyzzyaaaw3)=xyzzyaaar3+xyzzyaaak3
enddo
enddo
do xyzzyaaab3=1,num_real_k
xyzzyaaau3=nband(xyzzyaaab3,xyzzyaaaa1)
orb2(xyzzyaaai3+1:xyzzyaaai3+xyzzyaaau3)=multi_ddot_s(xyzzyaaau3,xyzzy&
&aaaw3,xyzzyaaax3,corbmask(xyzzyaaaj3+xyzzyaaaz3),rck(:,:,xyzzyaaab3,x&
&yzzyaaab1),maxb*num_ao,maxb,rblap(1,xyzzyaaab3),1.d0)
orb3(xyzzyaaai3+1:xyzzyaaai3+xyzzyaaau3)=multi_ddot_s(xyzzyaaau3,xyzzy&
&aaaw3,xyzzyaaax3,corbmask(xyzzyaaaj3+xyzzyaaaz3),rck(:,:,xyzzyaaab3,x&
&yzzyaaab1),maxb*num_ao,maxb,rbgra1(1,xyzzyaaab3),1.d0)
orb4(xyzzyaaai3+1:xyzzyaaai3+xyzzyaaau3)=multi_ddot_s(xyzzyaaau3,xyzzy&
&aaaw3,xyzzyaaax3,corbmask(xyzzyaaaj3+xyzzyaaaz3),rck(:,:,xyzzyaaab3,x&
&yzzyaaab1),maxb*num_ao,maxb,rbgra2(1,xyzzyaaab3),1.d0)
orb5(xyzzyaaai3+1:xyzzyaaai3+xyzzyaaau3)=multi_ddot_s(xyzzyaaau3,xyzzy&
&aaaw3,xyzzyaaax3,corbmask(xyzzyaaaj3+xyzzyaaaz3),rck(:,:,xyzzyaaab3,x&
&yzzyaaab1),maxb*num_ao,maxb,rbgra3(1,xyzzyaaab3),1.d0)
orb6(xyzzyaaai3+1:xyzzyaaai3+xyzzyaaau3)=multi_ddot_s(xyzzyaaau3,xyzzy&
&aaaw3,xyzzyaaax3,corbmask(xyzzyaaaj3+xyzzyaaaz3),rck(:,:,xyzzyaaab3,x&
&yzzyaaab1),maxb*num_ao,maxb,rbsderiv5(1,xyzzyaaab3),1.d0)
orb7(xyzzyaaai3+1:xyzzyaaai3+xyzzyaaau3)=multi_ddot_s(xyzzyaaau3,xyzzy&
&aaaw3,xyzzyaaax3,corbmask(xyzzyaaaj3+xyzzyaaaz3),rck(:,:,xyzzyaaab3,x&
&yzzyaaab1),maxb*num_ao,maxb,rbsderiv5(1,xyzzyaaab3),1.d0)
orb8(xyzzyaaai3+1:xyzzyaaai3+xyzzyaaau3)=multi_ddot_s(xyzzyaaau3,xyzzy&
&aaaw3,xyzzyaaax3,corbmask(xyzzyaaaj3+xyzzyaaaz3),rck(:,:,xyzzyaaab3,x&
&yzzyaaab1),maxb*num_ao,maxb,rbsderiv5(1,xyzzyaaab3),1.d0)
orb9(xyzzyaaai3+1:xyzzyaaai3+xyzzyaaau3)=multi_ddot_s(xyzzyaaau3,xyzzy&
&aaaw3,xyzzyaaax3,corbmask(xyzzyaaaj3+xyzzyaaaz3),rck(:,:,xyzzyaaab3,x&
&yzzyaaab1),maxb*num_ao,maxb,rbsderiv5(1,xyzzyaaab3),1.d0)
orb10(xyzzyaaai3+1:xyzzyaaai3+xyzzyaaau3)=multi_ddot_s(xyzzyaaau3,xyzz&
&yaaaw3,xyzzyaaax3,corbmask(xyzzyaaaj3+xyzzyaaaz3),rck(:,:,xyzzyaaab3,&
&xyzzyaaab1),maxb*num_ao,maxb,rbsderiv5(1,xyzzyaaab3),1.d0)
orb11(xyzzyaaai3+1:xyzzyaaai3+xyzzyaaau3)=multi_ddot_s(xyzzyaaau3,xyzz&
&yaaaw3,xyzzyaaax3,corbmask(xyzzyaaaj3+xyzzyaaaz3),rck(:,:,xyzzyaaab3,&
&xyzzyaaab1),maxb*num_ao,maxb,rbsderiv6(1,xyzzyaaab3),1.d0)
xyzzyaaai3=xyzzyaaai3+xyzzyaaau3
xyzzyaaaj3=xyzzyaaaj3+xyzzyaaau3
enddo
if(complex_states)then
do xyzzyaaab3=num_real_k_plus_1,num_k
xyzzyaaau3=nband(xyzzyaaab3,xyzzyaaaa1)
corb2(1:xyzzyaaau3)=multi_zdotu_s(xyzzyaaau3,xyzzyaaaw3,xyzzyaaax3,cor&
&bmask(xyzzyaaaj3+xyzzyaaaz3),cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_&
&ao,maxb,cblap(1,xyzzyaaab3),1.d0)
corb3(1:xyzzyaaau3)=multi_zdotu_s(xyzzyaaau3,xyzzyaaaw3,xyzzyaaax3,cor&
&bmask(xyzzyaaaj3+xyzzyaaaz3),cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_&
&ao,maxb,cbgra1(1,xyzzyaaab3),1.d0)
corb4(1:xyzzyaaau3)=multi_zdotu_s(xyzzyaaau3,xyzzyaaaw3,xyzzyaaax3,cor&
&bmask(xyzzyaaaj3+xyzzyaaaz3),cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_&
&ao,maxb,cbgra2(1,xyzzyaaab3),1.d0)
corb5(1:xyzzyaaau3)=multi_zdotu_s(xyzzyaaau3,xyzzyaaaw3,xyzzyaaax3,cor&
&bmask(xyzzyaaaj3+xyzzyaaaz3),cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_&
&ao,maxb,cbgra3(1,xyzzyaaab3),1.d0)
corb6(1:xyzzyaaau3)=multi_zdotu_s(xyzzyaaau3,xyzzyaaaw3,xyzzyaaax3,cor&
&bmask(xyzzyaaaj3+xyzzyaaaz3),cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_&
&ao,maxb,cbsderiv1(1,xyzzyaaab3),1.d0)
corb7(1:xyzzyaaau3)=multi_zdotu_s(xyzzyaaau3,xyzzyaaaw3,xyzzyaaax3,cor&
&bmask(xyzzyaaaj3+xyzzyaaaz3),cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_&
&ao,maxb,cbsderiv2(1,xyzzyaaab3),1.d0)
corb8(1:xyzzyaaau3)=multi_zdotu_s(xyzzyaaau3,xyzzyaaaw3,xyzzyaaax3,cor&
&bmask(xyzzyaaaj3+xyzzyaaaz3),cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_&
&ao,maxb,cbsderiv3(1,xyzzyaaab3),1.d0)
corb9(1:xyzzyaaau3)=multi_zdotu_s(xyzzyaaau3,xyzzyaaaw3,xyzzyaaax3,cor&
&bmask(xyzzyaaaj3+xyzzyaaaz3),cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_&
&ao,maxb,cbsderiv4(1,xyzzyaaab3),1.d0)
corb10(1:xyzzyaaau3)=multi_zdotu_s(xyzzyaaau3,xyzzyaaaw3,xyzzyaaax3,co&
&rbmask(xyzzyaaaj3+xyzzyaaaz3),cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num&
&_ao,maxb,cbsderiv5(1,xyzzyaaab3),1.d0)
corb11(1:xyzzyaaau3)=multi_zdotu_s(xyzzyaaau3,xyzzyaaaw3,xyzzyaaax3,co&
&rbmask(xyzzyaaaj3+xyzzyaaaz3),cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num&
&_ao,maxb,cbsderiv6(1,xyzzyaaab3),1.d0)
do xyzzyaaak3=1,xyzzyaaau3
xyzzyaaai3=xyzzyaaai3+1
xyzzyaaaj3=xyzzyaaaj3+1
if(.not.corbmask(xyzzyaaaj3+xyzzyaaaz3-1))cycle
orb2(xyzzyaaai3)=2.d0*real(corb2(xyzzyaaah3),dp)
orb3(xyzzyaaai3)=2.d0*real(corb3(xyzzyaaah3),dp)
orb4(xyzzyaaai3)=2.d0*real(corb4(xyzzyaaah3),dp)
orb5(xyzzyaaai3)=2.d0*real(corb5(xyzzyaaah3),dp)
orb6(xyzzyaaai3)=2.d0*real(corb6(xyzzyaaah3),dp)
orb7(xyzzyaaai3)=2.d0*real(corb7(xyzzyaaah3),dp)
orb8(xyzzyaaai3)=2.d0*real(corb8(xyzzyaaah3),dp)
orb9(xyzzyaaai3)=2.d0*real(corb9(xyzzyaaah3),dp)
orb10(xyzzyaaai3)=2.d0*real(corb10(xyzzyaaah3),dp)
orb11(xyzzyaaai3)=2.d0*real(corb11(xyzzyaaah3),dp)
if(xyzzyaaai3+1<=nuc_nele(jspin))then
xyzzyaaai3=xyzzyaaai3+1
orb2(xyzzyaaai3)=2.d0*aimag(corb2(xyzzyaaah3))
orb3(xyzzyaaai3)=2.d0*aimag(corb3(xyzzyaaah3))
orb4(xyzzyaaai3)=2.d0*aimag(corb4(xyzzyaaah3))
orb5(xyzzyaaai3)=2.d0*aimag(corb5(xyzzyaaah3))
orb6(xyzzyaaai3)=2.d0*aimag(corb6(xyzzyaaah3))
orb7(xyzzyaaai3)=2.d0*aimag(corb7(xyzzyaaah3))
orb8(xyzzyaaai3)=2.d0*aimag(corb8(xyzzyaaah3))
orb9(xyzzyaaai3)=2.d0*aimag(corb9(xyzzyaaah3))
orb10(xyzzyaaai3)=2.d0*aimag(corb10(xyzzyaaah3))
orb11(xyzzyaaai3)=2.d0*aimag(corb11(xyzzyaaah3))
endif
enddo
enddo
endif
else
do xyzzyaaab3=1,num_real_k
do xyzzyaaah3=1,nband(xyzzyaaab3,xyzzyaaaa1)
xyzzyaaai3=xyzzyaaai3+1
xyzzyaaaj3=xyzzyaaaj3+1
if(.not.corbmask(xyzzyaaaj3+xyzzyaaaz3-1))cycle
if(xyzzyaakm3(xyzzyaaai3))then
rblap_s(1:num_ao,xyzzyaaai3)=rblap(1:num_ao,xyzzyaaab3)-rblap_s(1:num_&
&ao,xyzzyaaai3)
rbgra1_s(1:num_ao,xyzzyaaai3)=rbgra1(1:num_ao,xyzzyaaab3)-rbgra1_s(1:n&
&um_ao,xyzzyaaai3)
rbgra2_s(1:num_ao,xyzzyaaai3)=rbgra2(1:num_ao,xyzzyaaab3)-rbgra2_s(1:n&
&um_ao,xyzzyaaai3)
rbgra3_s(1:num_ao,xyzzyaaai3)=rbgra3(1:num_ao,xyzzyaaab3)-rbgra3_s(1:n&
&um_ao,xyzzyaaai3)
rbsderiv1_s(1:num_ao,xyzzyaaai3)=rbsderiv1(1:num_ao,xyzzyaaab3)-rbsder&
&iv1_s(1:num_ao,xyzzyaaai3)
rbsderiv2_s(1:num_ao,xyzzyaaai3)=rbsderiv2(1:num_ao,xyzzyaaab3)-rbsder&
&iv2_s(1:num_ao,xyzzyaaai3)
rbsderiv3_s(1:num_ao,xyzzyaaai3)=rbsderiv3(1:num_ao,xyzzyaaab3)-rbsder&
&iv3_s(1:num_ao,xyzzyaaai3)
rbsderiv4_s(1:num_ao,xyzzyaaai3)=rbsderiv4(1:num_ao,xyzzyaaab3)-rbsder&
&iv4_s(1:num_ao,xyzzyaaai3)
rbsderiv5_s(1:num_ao,xyzzyaaai3)=rbsderiv5(1:num_ao,xyzzyaaab3)-rbsder&
&iv5_s(1:num_ao,xyzzyaaai3)
rbsderiv6_s(1:num_ao,xyzzyaaai3)=rbsderiv6(1:num_ao,xyzzyaaab3)-rbsder&
&iv6_s(1:num_ao,xyzzyaaai3)
orb2(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rblap_s(1,xyzzyaaai3))
orb3(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbgra1_s(1,xyzzyaaai3))
orb4(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbgra2_s(1,xyzzyaaai3))
orb5(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbgra3_s(1,xyzzyaaai3))
orb6(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbsderiv1_s(1,xyzzyaaai3))
orb7(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbsderiv2_s(1,xyzzyaaai3))
orb8(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbsderiv3_s(1,xyzzyaaai3))
orb9(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbsderiv4_s(1,xyzzyaaai3))
orb10(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*&
&num_ao,xyzzyaaah3,maxb,rbsderiv5_s(1,xyzzyaaai3))
orb11(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*&
&num_ao,xyzzyaaah3,maxb,rbsderiv6_s(1,xyzzyaaai3))
orb2(xyzzyaaai3)=orb2(xyzzyaaai3)+exp_poly1(xyzzyaaai3)
orb3(xyzzyaaai3)=orb3(xyzzyaaai3)+exp_poly2(xyzzyaaai3)
orb4(xyzzyaaai3)=orb4(xyzzyaaai3)+exp_poly3(xyzzyaaai3)
orb5(xyzzyaaai3)=orb5(xyzzyaaai3)+exp_poly4(xyzzyaaai3)
orb6(xyzzyaaai3)=orb6(xyzzyaaai3)+exp_poly5(xyzzyaaai3)
orb7(xyzzyaaai3)=orb7(xyzzyaaai3)+exp_poly6(xyzzyaaai3)
orb8(xyzzyaaai3)=orb8(xyzzyaaai3)+exp_poly7(xyzzyaaai3)
orb9(xyzzyaaai3)=orb9(xyzzyaaai3)+exp_poly8(xyzzyaaai3)
orb10(xyzzyaaai3)=orb10(xyzzyaaai3)+exp_poly9(xyzzyaaai3)
orb11(xyzzyaaai3)=orb11(xyzzyaaai3)+exp_poly10(xyzzyaaai3)
else
orb2(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rblap(1,xyzzyaaab3))
orb3(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbgra1(1,xyzzyaaab3))
orb4(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbgra2(1,xyzzyaaab3))
orb5(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbgra3(1,xyzzyaaab3))
orb6(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbsderiv1(1,xyzzyaaab3))
orb7(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbsderiv2(1,xyzzyaaab3))
orb8(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbsderiv3(1,xyzzyaaab3))
orb9(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah3,maxb,rbsderiv4(1,xyzzyaaab3))
orb10(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*&
&num_ao,xyzzyaaah3,maxb,rbsderiv5(1,xyzzyaaab3))
orb11(xyzzyaaai3)=ddot_alt(num_ao,rck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*&
&num_ao,xyzzyaaah3,maxb,rbsderiv6(1,xyzzyaaab3))
endif
enddo
enddo
if(complex_states)then
do xyzzyaaab3=num_real_k_plus_1,num_k
do xyzzyaaah3=1,nband(xyzzyaaab3,xyzzyaaaa1)
corb2(1)=czero
corb3(1)=czero
corb4(1)=czero
corb5(1)=czero
corb6(1)=czero
corb7(1)=czero
corb8(1)=czero
corb9(1)=czero
corb10(1)=czero
corb11(1)=czero
xyzzyaaai3=xyzzyaaai3+1
xyzzyaaaj3=xyzzyaaaj3+1
if(.not.corbmask(xyzzyaaaj3+xyzzyaaaz3-1))cycle
if(xyzzyaakm3(xyzzyaaai3).and.xyzzyaakm3(xyzzyaaai3+1))then
cblap_s(1:num_ao,xyzzyaaai3)=cblap(1:num_ao,xyzzyaaab3)-cblap_s(1:num_&
&ao,xyzzyaaai3)
cbgra1_s(1:num_ao,xyzzyaaai3)=cbgra1(1:num_ao,xyzzyaaab3)-cbgra1_s(1:n&
&um_ao,xyzzyaaai3)
cbgra2_s(1:num_ao,xyzzyaaai3)=cbgra2(1:num_ao,xyzzyaaab3)-cbgra2_s(1:n&
&um_ao,xyzzyaaai3)
cbgra3_s(1:num_ao,xyzzyaaai3)=cbgra3(1:num_ao,xyzzyaaab3)-cbgra3_s(1:n&
&um_ao,xyzzyaaai3)
cbsderiv1_s(1:num_ao,xyzzyaaai3)=cbsderiv1(1:num_ao,xyzzyaaab3)-cbsder&
&iv1_s(1:num_ao,xyzzyaaai3)
cbsderiv2_s(1:num_ao,xyzzyaaai3)=cbsderiv2(1:num_ao,xyzzyaaab3)-cbsder&
&iv2_s(1:num_ao,xyzzyaaai3)
cbsderiv3_s(1:num_ao,xyzzyaaai3)=cbsderiv3(1:num_ao,xyzzyaaab3)-cbsder&
&iv3_s(1:num_ao,xyzzyaaai3)
cbsderiv4_s(1:num_ao,xyzzyaaai3)=cbsderiv4(1:num_ao,xyzzyaaab3)-cbsder&
&iv4_s(1:num_ao,xyzzyaaai3)
cbsderiv5_s(1:num_ao,xyzzyaaai3)=cbsderiv5(1:num_ao,xyzzyaaab3)-cbsder&
&iv5_s(1:num_ao,xyzzyaaai3)
cbsderiv6_s(1:num_ao,xyzzyaaai3)=cbsderiv6(1:num_ao,xyzzyaaab3)-cbsder&
&iv6_s(1:num_ao,xyzzyaaai3)
corb2(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cblap_s(1,xyzzyaaai3))
corb3(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra1_s(1,xyzzyaaai3))
corb4(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra2_s(1,xyzzyaaai3))
corb5(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra3_s(1,xyzzyaaai3))
corb6(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv1_s(1,xyzzyaaai3))
corb7(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv2_s(1,xyzzyaaai3))
corb8(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv3_s(1,xyzzyaaai3))
corb9(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv4_s(1,xyzzyaaai3))
corb10(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah3,maxb,cbsderiv5_s(1,xyzzyaaai3))
corb11(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah3,maxb,cbsderiv6_s(1,xyzzyaaai3))
orb2(xyzzyaaai3)=2.d0*real(corb2(1),dp)+exp_poly1(xyzzyaaai3)
orb3(xyzzyaaai3)=2.d0*real(corb3(1),dp)+exp_poly2(xyzzyaaai3)
orb4(xyzzyaaai3)=2.d0*real(corb4(1),dp)+exp_poly3(xyzzyaaai3)
orb5(xyzzyaaai3)=2.d0*real(corb5(1),dp)+exp_poly4(xyzzyaaai3)
orb6(xyzzyaaai3)=2.d0*real(corb6(1),dp)+exp_poly5(xyzzyaaai3)
orb7(xyzzyaaai3)=2.d0*real(corb7(1),dp)+exp_poly6(xyzzyaaai3)
orb8(xyzzyaaai3)=2.d0*real(corb8(1),dp)+exp_poly7(xyzzyaaai3)
orb9(xyzzyaaai3)=2.d0*real(corb9(1),dp)+exp_poly8(xyzzyaaai3)
orb10(xyzzyaaai3)=2.d0*real(corb10(1),dp)+exp_poly9(xyzzyaaai3)
orb11(xyzzyaaai3)=2.d0*real(corb11(1),dp)+exp_poly10(xyzzyaaai3)
if(xyzzyaaai3+1<=nuc_nele(jspin))then
xyzzyaaai3=xyzzyaaai3+1
orb2(xyzzyaaai3)=2.d0*aimag(corb2(1))+exp_poly1(xyzzyaaai3)
orb3(xyzzyaaai3)=2.d0*aimag(corb3(1))+exp_poly2(xyzzyaaai3)
orb4(xyzzyaaai3)=2.d0*aimag(corb4(1))+exp_poly3(xyzzyaaai3)
orb5(xyzzyaaai3)=2.d0*aimag(corb5(1))+exp_poly4(xyzzyaaai3)
orb6(xyzzyaaai3)=2.d0*aimag(corb6(1))+exp_poly5(xyzzyaaai3)
orb7(xyzzyaaai3)=2.d0*aimag(corb7(1))+exp_poly6(xyzzyaaai3)
orb8(xyzzyaaai3)=2.d0*aimag(corb8(1))+exp_poly7(xyzzyaaai3)
orb9(xyzzyaaai3)=2.d0*aimag(corb9(1))+exp_poly8(xyzzyaaai3)
orb10(xyzzyaaai3)=2.d0*aimag(corb10(1))+exp_poly9(xyzzyaaai3)
orb11(xyzzyaaai3)=2.d0*aimag(corb11(1))+exp_poly10(xyzzyaaai3)
endif
else
if(xyzzyaakm3(xyzzyaaai3))then
cblap_s(1:num_ao,xyzzyaaai3)=cblap(1:num_ao,xyzzyaaab3)-cblap_s(1:num_&
&ao,xyzzyaaai3)
cbgra1_s(1:num_ao,xyzzyaaai3)=cbgra1(1:num_ao,xyzzyaaab3)-cbgra1_s(1:n&
&um_ao,xyzzyaaai3)
cbgra2_s(1:num_ao,xyzzyaaai3)=cbgra2(1:num_ao,xyzzyaaab3)-cbgra2_s(1:n&
&um_ao,xyzzyaaai3)
cbgra3_s(1:num_ao,xyzzyaaai3)=cbgra3(1:num_ao,xyzzyaaab3)-cbgra3_s(1:n&
&um_ao,xyzzyaaai3)
cbsderiv1_s(1:num_ao,xyzzyaaai3)=cbsderiv1(1:num_ao,xyzzyaaab3)-cbsder&
&iv1_s(1:num_ao,xyzzyaaai3)
cbsderiv2_s(1:num_ao,xyzzyaaai3)=cbsderiv2(1:num_ao,xyzzyaaab3)-cbsder&
&iv2_s(1:num_ao,xyzzyaaai3)
cbsderiv3_s(1:num_ao,xyzzyaaai3)=cbsderiv3(1:num_ao,xyzzyaaab3)-cbsder&
&iv3_s(1:num_ao,xyzzyaaai3)
cbsderiv4_s(1:num_ao,xyzzyaaai3)=cbsderiv4(1:num_ao,xyzzyaaab3)-cbsder&
&iv4_s(1:num_ao,xyzzyaaai3)
cbsderiv5_s(1:num_ao,xyzzyaaai3)=cbsderiv5(1:num_ao,xyzzyaaab3)-cbsder&
&iv5_s(1:num_ao,xyzzyaaai3)
cbsderiv6_s(1:num_ao,xyzzyaaai3)=cbsderiv6(1:num_ao,xyzzyaaab3)-cbsder&
&iv6_s(1:num_ao,xyzzyaaai3)
corb2(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cblap_s(1,xyzzyaaai3))
corb3(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra1_s(1,xyzzyaaai3))
corb4(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra2_s(1,xyzzyaaai3))
corb5(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra3_s(1,xyzzyaaai3))
corb6(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv1_s(1,xyzzyaaai3))
corb7(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv2_s(1,xyzzyaaai3))
corb8(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv3_s(1,xyzzyaaai3))
corb9(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv4_s(1,xyzzyaaai3))
corb10(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah3,maxb,cbsderiv5_s(1,xyzzyaaai3))
corb11(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah3,maxb,cbsderiv6_s(1,xyzzyaaai3))
orb2(xyzzyaaai3)=2.d0*real(corb2(1),dp)+exp_poly1(xyzzyaaai3)
orb3(xyzzyaaai3)=2.d0*real(corb3(1),dp)+exp_poly2(xyzzyaaai3)
orb4(xyzzyaaai3)=2.d0*real(corb4(1),dp)+exp_poly3(xyzzyaaai3)
orb5(xyzzyaaai3)=2.d0*real(corb5(1),dp)+exp_poly4(xyzzyaaai3)
orb6(xyzzyaaai3)=2.d0*real(corb6(1),dp)+exp_poly5(xyzzyaaai3)
orb7(xyzzyaaai3)=2.d0*real(corb7(1),dp)+exp_poly6(xyzzyaaai3)
orb8(xyzzyaaai3)=2.d0*real(corb8(1),dp)+exp_poly7(xyzzyaaai3)
orb9(xyzzyaaai3)=2.d0*real(corb9(1),dp)+exp_poly8(xyzzyaaai3)
orb10(xyzzyaaai3)=2.d0*real(corb10(1),dp)+exp_poly9(xyzzyaaai3)
orb11(xyzzyaaai3)=2.d0*real(corb11(1),dp)+exp_poly10(xyzzyaaai3)
else
corb2(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cblap(1,xyzzyaaab3))
corb3(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra1(1,xyzzyaaab3))
corb4(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra2(1,xyzzyaaab3))
corb5(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra3(1,xyzzyaaab3))
corb6(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv1(1,xyzzyaaab3))
corb7(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv2(1,xyzzyaaab3))
corb8(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv3(1,xyzzyaaab3))
corb9(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv4(1,xyzzyaaab3))
corb10(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah3,maxb,cbsderiv5(1,xyzzyaaab3))
corb11(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah3,maxb,cbsderiv6(1,xyzzyaaab3))
orb2(xyzzyaaai3)=2.d0*real(corb2(1),dp)
orb3(xyzzyaaai3)=2.d0*real(corb3(1),dp)
orb4(xyzzyaaai3)=2.d0*real(corb4(1),dp)
orb5(xyzzyaaai3)=2.d0*real(corb5(1),dp)
orb6(xyzzyaaai3)=2.d0*real(corb6(1),dp)
orb7(xyzzyaaai3)=2.d0*real(corb7(1),dp)
orb8(xyzzyaaai3)=2.d0*real(corb8(1),dp)
orb9(xyzzyaaai3)=2.d0*real(corb9(1),dp)
orb10(xyzzyaaai3)=2.d0*real(corb10(1),dp)
orb11(xyzzyaaai3)=2.d0*real(corb11(1),dp)
endif
if(xyzzyaaai3+1<=nuc_nele(jspin))then
xyzzyaaai3=xyzzyaaai3+1
corb2(1)=czero
corb3(1)=czero
corb4(1)=czero
corb5(1)=czero
corb6(1)=czero
corb7(1)=czero
corb8(1)=czero
corb9(1)=czero
corb10(1)=czero
corb11(1)=czero
if(xyzzyaakm3(xyzzyaaai3))then
cblap_s(1:num_ao,xyzzyaaai3)=cblap(1:num_ao,xyzzyaaab3)-cblap_s(1:num_&
&ao,xyzzyaaai3)
cbgra1_s(1:num_ao,xyzzyaaai3)=cbgra1(1:num_ao,xyzzyaaab3)-cbgra1_s(1:n&
&um_ao,xyzzyaaai3)
cbgra2_s(1:num_ao,xyzzyaaai3)=cbgra2(1:num_ao,xyzzyaaab3)-cbgra2_s(1:n&
&um_ao,xyzzyaaai3)
cbgra3_s(1:num_ao,xyzzyaaai3)=cbgra3(1:num_ao,xyzzyaaab3)-cbgra3_s(1:n&
&um_ao,xyzzyaaai3)
cbsderiv1_s(1:num_ao,xyzzyaaai3)=cbsderiv1(1:num_ao,xyzzyaaab3)-cbsder&
&iv1_s(1:num_ao,xyzzyaaai3)
cbsderiv2_s(1:num_ao,xyzzyaaai3)=cbsderiv2(1:num_ao,xyzzyaaab3)-cbsder&
&iv2_s(1:num_ao,xyzzyaaai3)
cbsderiv3_s(1:num_ao,xyzzyaaai3)=cbsderiv3(1:num_ao,xyzzyaaab3)-cbsder&
&iv3_s(1:num_ao,xyzzyaaai3)
cbsderiv4_s(1:num_ao,xyzzyaaai3)=cbsderiv4(1:num_ao,xyzzyaaab3)-cbsder&
&iv4_s(1:num_ao,xyzzyaaai3)
cbsderiv5_s(1:num_ao,xyzzyaaai3)=cbsderiv5(1:num_ao,xyzzyaaab3)-cbsder&
&iv5_s(1:num_ao,xyzzyaaai3)
cbsderiv6_s(1:num_ao,xyzzyaaai3)=cbsderiv6(1:num_ao,xyzzyaaab3)-cbsder&
&iv6_s(1:num_ao,xyzzyaaai3)
corb2(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cblap_s(1,xyzzyaaai3))
corb3(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra1_s(1,xyzzyaaai3))
corb4(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra2_s(1,xyzzyaaai3))
corb5(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra3_s(1,xyzzyaaai3))
corb6(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv1_s(1,xyzzyaaai3))
corb7(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv2_s(1,xyzzyaaai3))
corb8(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv3_s(1,xyzzyaaai3))
corb9(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv4_s(1,xyzzyaaai3))
corb10(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah3,maxb,cbsderiv5_s(1,xyzzyaaai3))
corb11(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah3,maxb,cbsderiv6_s(1,xyzzyaaai3))
orb2(xyzzyaaai3)=2.d0*aimag(corb2(1))+exp_poly1(xyzzyaaai3)
orb3(xyzzyaaai3)=2.d0*aimag(corb3(1))+exp_poly2(xyzzyaaai3)
orb4(xyzzyaaai3)=2.d0*aimag(corb4(1))+exp_poly3(xyzzyaaai3)
orb5(xyzzyaaai3)=2.d0*aimag(corb5(1))+exp_poly4(xyzzyaaai3)
orb6(xyzzyaaai3)=2.d0*aimag(corb6(1))+exp_poly5(xyzzyaaai3)
orb7(xyzzyaaai3)=2.d0*aimag(corb7(1))+exp_poly6(xyzzyaaai3)
orb8(xyzzyaaai3)=2.d0*aimag(corb8(1))+exp_poly7(xyzzyaaai3)
orb9(xyzzyaaai3)=2.d0*aimag(corb9(1))+exp_poly8(xyzzyaaai3)
orb10(xyzzyaaai3)=2.d0*aimag(corb10(1))+exp_poly9(xyzzyaaai3)
orb11(xyzzyaaai3)=2.d0*aimag(corb11(1))+exp_poly10(xyzzyaaai3)
else
corb2(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cblap(1,xyzzyaaab3))
corb3(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra1(1,xyzzyaaab3))
corb4(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra2(1,xyzzyaaab3))
corb5(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbgra3(1,xyzzyaaab3))
corb6(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv1(1,xyzzyaaab3))
corb7(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv2(1,xyzzyaaab3))
corb8(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv3(1,xyzzyaaab3))
corb9(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah3,maxb,cbsderiv4(1,xyzzyaaab3))
corb10(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah3,maxb,cbsderiv5(1,xyzzyaaab3))
corb11(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab3,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah3,maxb,cbsderiv6(1,xyzzyaaab3))
orb2(xyzzyaaai3)=2.d0*aimag(corb2(1))
orb3(xyzzyaaai3)=2.d0*aimag(corb3(1))
orb4(xyzzyaaai3)=2.d0*aimag(corb4(1))
orb5(xyzzyaaai3)=2.d0*aimag(corb5(1))
orb6(xyzzyaaai3)=2.d0*aimag(corb6(1))
orb7(xyzzyaaai3)=2.d0*aimag(corb7(1))
orb8(xyzzyaaai3)=2.d0*aimag(corb8(1))
orb9(xyzzyaaai3)=2.d0*aimag(corb9(1))
orb10(xyzzyaaai3)=2.d0*aimag(corb10(1))
orb11(xyzzyaaai3)=2.d0*aimag(corb11(1))
endif
endif
endif
enddo
enddo
endif
endif
orblap(xyzzyaaay3:xyzzyaaai3+xyzzyaaay3-1,1)=orb2(1:xyzzyaaai3)*rnorm
orbgrad(1,xyzzyaaay3:xyzzyaaai3+xyzzyaaay3-1,1)=orb3(1:xyzzyaaai3)*rno&
&rm
orbgrad(2,xyzzyaaay3:xyzzyaaai3+xyzzyaaay3-1,1)=orb4(1:xyzzyaaai3)*rno&
&rm
orbgrad(3,xyzzyaaay3:xyzzyaaai3+xyzzyaaay3-1,1)=orb5(1:xyzzyaaai3)*rno&
&rm
orbsderivs(1,xyzzyaaay3:xyzzyaaai3+xyzzyaaay3-1,1)=orb6(1:xyzzyaaai3)*&
&rnorm
orbsderivs(2,xyzzyaaay3:xyzzyaaai3+xyzzyaaay3-1,1)=orb7(1:xyzzyaaai3)*&
&rnorm
orbsderivs(3,xyzzyaaay3:xyzzyaaai3+xyzzyaaay3-1,1)=orb8(1:xyzzyaaai3)*&
&rnorm
orbsderivs(4,xyzzyaaay3:xyzzyaaai3+xyzzyaaay3-1,1)=orb9(1:xyzzyaaai3)*&
&rnorm
orbsderivs(5,xyzzyaaay3:xyzzyaaai3+xyzzyaaay3-1,1)=orb10(1:xyzzyaaai3)&
&*rnorm
orbsderivs(6,xyzzyaaay3:xyzzyaaai3+xyzzyaaay3-1,1)=orb11(1:xyzzyaaai3)&
&*rnorm
if(excite)then
do xyzzyaaak3=1,gauss_ex_norb
if(.not.orbmask(gauss_gs_norb+xyzzyaaak3))cycle
xyzzyaaab3=virtual_k(xyzzyaaak3,jspin)
xyzzyaaau3=full2vrt(xyzzyaaak3,jspin)
if(xyzzyaaab3<=num_real_k)then
flap(xyzzyaaak3) =sum(rblap (:,xyzzyaaab3)*rck_ex(:,xyzzyaaau3,jspin))
fgra1(xyzzyaaak3)=sum(rbgra1(:,xyzzyaaab3)*rck_ex(:,xyzzyaaau3,jspin))
fgra2(xyzzyaaak3)=sum(rbgra2(:,xyzzyaaab3)*rck_ex(:,xyzzyaaau3,jspin))
fgra3(xyzzyaaak3)=sum(rbgra3(:,xyzzyaaab3)*rck_ex(:,xyzzyaaau3,jspin))
else
flap(xyzzyaaak3)=2.d0*sum(real(cblap(:,xyzzyaaab3)*cck_ex(:,xyzzyaaau3&
&,jspin),dp))
fgra1(xyzzyaaak3)=2.d0*sum(real(cbgra1(:,xyzzyaaab3)*cck_ex(:,xyzzyaaa&
&u3,jspin),dp))
fgra2(xyzzyaaak3)=2.d0*sum(real(cbgra2(:,xyzzyaaab3)*cck_ex(:,xyzzyaaa&
&u3,jspin),dp))
fgra3(xyzzyaaak3)=2.d0*sum(real(cbgra3(:,xyzzyaaab3)*cck_ex(:,xyzzyaaa&
&u3,jspin),dp))
endif
enddo
do xyzzyaaak3=1,gauss_ex_norb
if(.not.orbmask(gauss_gs_norb+xyzzyaaak3))cycle
orblap(gauss_gs_norb+xyzzyaaak3,1)=flap(xyzzyaaak3)
orbgrad(1,gauss_gs_norb+xyzzyaaak3,1)=fgra1(xyzzyaaak3)
orbgrad(2,gauss_gs_norb+xyzzyaaak3,1)=fgra2(xyzzyaaak3)
orbgrad(3,gauss_gs_norb+xyzzyaaak3,1)=fgra3(xyzzyaaak3)
enddo
endif
end subroutine xyzzyaaae1
subroutine xyzzyaaaf1(jspin,norb,orbmask,norbc,corbmask,orbval,orbgrad&
&,orblap,orbsderivs)
implicit none
integer,intent(in) :: jspin,norb,norbc
real(dp),intent(inout) :: orbval(norb,real1_complex2),orbgrad(3,norb,r&
&eal1_complex2),orblap(norb,real1_complex2),orbsderivs(6,nemax,real1_c&
&omplex2)
logical,intent(in) :: orbmask(norb),corbmask(norbc)
integer xyzzyaaaa4,xyzzyaaab4,xyzzyaaac4,xyzzyaaad4,xyzzyaaae4,xyzzyaa&
&af4,xyzzyaaag4,xyzzyaaah4,xyzzyaaai4,xyzzyaaaj4,xyzzyaaak4,xyzzyaaal4&
&,xyzzyaaam4,xyzzyaaan4,xyzzyaaao4,xyzzyaaap4,xyzzyaaaq4,xyzzyaaar4,xy&
&zzyaaas4,xyzzyaaat4,xyzzyaaau4,xyzzyaaav4,xyzzyaaaw4,xyzzyaaax4(num_a&
&o),xyzzyaaay4,xyzzyaaaz4
real(dp) xyzzyaaba4,xyzzyaabb4,xyzzyaabc4,xyzzyaabd4,xyzzyaabe4,xyzzya&
&abf4,xyzzyaabg4,xyzzyaabh4,xyzzyaabi4,xyzzyaabj4,xyzzyaabk4,xyzzyaabl&
&4,xyzzyaabm4,xyzzyaabn4,xyzzyaabo4,xyzzyaabp4,xyzzyaabq4,xyzzyaabr4,x&
&yzzyaabs4,xyzzyaabt4,xyzzyaabu4,xyzzyaabv4,xyzzyaabw4,xyzzyaabx4,xyzz&
&yaaby4,xyzzyaabz4,xyzzyaaca4,xyzzyaacb4,xyzzyaacc4,xyzzyaacd4,xyzzyaa&
&ce4,xyzzyaacf4,xyzzyaacg4,xyzzyaach4,xyzzyaaci4(7),xyzzyaacj4(7),xyzz&
&yaack4(21),xyzzyaacl4(42),xyzzyaacm4(7),xyzzyaacn4(7),xyzzyaaco4(21),&
&xyzzyaacp4(42),xyzzyaacq4(3),xyzzyaacr4(3),xyzzyaacs4(3),xyzzyaact4(3&
&),xyzzyaacu4,xyzzyaacv4,xyzzyaacw4,xyzzyaacx4,xyzzyaacy4,xyzzyaacz4,x&
&yzzyaada4,xyzzyaadb4,xyzzyaadc4,xyzzyaadd4,xyzzyaade4,xyzzyaadf4,xyzz&
&yaadg4,xyzzyaadh4,xyzzyaadi4,xyzzyaadj4,xyzzyaadk4,xyzzyaadl4,xyzzyaa&
&dm4,xyzzyaadn4,xyzzyaado4,xyzzyaadp4,xyzzyaadq4,xyzzyaadr4,xyzzyaads4&
&,xyzzyaadt4,xyzzyaadu4,xyzzyaadv4,xyzzyaadw4,xyzzyaadx4
real(dp) xyzzyaady4,xyzzyaadz4,xyzzyaaea4,xyzzyaaeb4,xyzzyaaec4,xyzzya&
&aed4,xyzzyaaee4,xyzzyaaef4,xyzzyaaeg4,xyzzyaaeh4,xyzzyaaei4,xyzzyaaej&
&4,xyzzyaaek4,xyzzyaael4,xyzzyaaem4,xyzzyaaen4,xyzzyaaeo4,xyzzyaaep4,x&
&yzzyaaeq4,xyzzyaaer4,xyzzyaaes4,xyzzyaaet4,xyzzyaaeu4,xyzzyaaev4,xyzz&
&yaaew4,xyzzyaaex4,xyzzyaaey4,xyzzyaaez4,xyzzyaafa4,xyzzyaafb4,xyzzyaa&
&fc4,xyzzyaafd4,xyzzyaafe4,xyzzyaaff4,xyzzyaafg4,xyzzyaafh4,xyzzyaafi4&
&,xyzzyaafj4,xyzzyaafk4,xyzzyaafl4,xyzzyaafm4,xyzzyaafn4,xyzzyaafo4,xy&
&zzyaafp4,xyzzyaafq4,xyzzyaafr4,xyzzyaafs4,xyzzyaaft4,xyzzyaafu4,xyzzy&
&aafv4,xyzzyaafw4,xyzzyaafx4,xyzzyaafy4,xyzzyaafz4,xyzzyaaga4,xyzzyaag&
&b4,xyzzyaagc4,xyzzyaagd4,xyzzyaage4,xyzzyaagf4,xyzzyaagg4,xyzzyaagh4,&
&xyzzyaagi4,xyzzyaagj4,xyzzyaagk4,xyzzyaagl4,xyzzyaagm4,xyzzyaagn4,xyz&
&zyaago4,xyzzyaagp4,xyzzyaagq4,xyzzyaagr4,xyzzyaags4,xyzzyaagt4,xyzzya&
&agu4,xyzzyaagv4,xyzzyaagw4,xyzzyaagx4,xyzzyaagy4,xyzzyaagz4,xyzzyaaha&
&4,xyzzyaahb4,xyzzyaahc4,xyzzyaahd4,xyzzyaahe4,xyzzyaahf4,xyzzyaahg4,x&
&yzzyaahh4,xyzzyaahi4,xyzzyaahj4,xyzzyaahk4,xyzzyaahl4,xyzzyaahm4,xyzz&
&yaahn4,xyzzyaaho4,xyzzyaahp4,xyzzyaahq4,xyzzyaahr4,xyzzyaahs4,xyzzyaa&
&ht4,xyzzyaahu4,xyzzyaahv4,xyzzyaahw4,xyzzyaahx4,xyzzyaahy4,xyzzyaahz4&
&,xyzzyaaia4,xyzzyaaib4,xyzzyaaic4,xyzzyaaid4,xyzzyaaie4,xyzzyaaif4,xy&
&zzyaaig4,xyzzyaaih4,xyzzyaaii4,xyzzyaaij4,xyzzyaaik4,xyzzyaail4,xyzzy&
&aaim4,xyzzyaain4,xyzzyaaio4,xyzzyaaip4,xyzzyaaiq4,xyzzyaair4
real(dp) xyzzyaais4,xyzzyaait4,xyzzyaaiu4,xyzzyaaiv4,xyzzyaaiw4,xyzzya&
&aix4,xyzzyaaiy4,xyzzyaaiz4,xyzzyaaja4,xyzzyaajb4,xyzzyaajc4,xyzzyaajd&
&4,xyzzyaaje4,xyzzyaajf4,xyzzyaajg4,xyzzyaajh4,xyzzyaaji4,xyzzyaajj4,x&
&yzzyaajk4,xyzzyaajl4,xyzzyaajm4,xyzzyaajn4,xyzzyaajo4,xyzzyaajp4,xyzz&
&yaajq4,xyzzyaajr4,xyzzyaajs4,xyzzyaajt4,xyzzyaaju4,xyzzyaajv4,xyzzyaa&
&jw4,xyzzyaajx4,xyzzyaajy4,xyzzyaajz4,xyzzyaaka4,xyzzyaakb4,xyzzyaakc4&
&,xyzzyaakd4,xyzzyaake4,xyzzyaakf4,xyzzyaakg4,xyzzyaakh4,xyzzyaaki4,xy&
&zzyaakj4,xyzzyaakk4,xyzzyaakl4,xyzzyaakm4,xyzzyaakn4
complex(dp) xyzzyaako4,xyzzyaakp4
logical xyzzyaakq4,xyzzyaakr4,xyzzyaaks4(nemax),xyzzyaakt4(nemax),xyzz&
&yaaku4,xyzzyaakv4(num_shells)
xyzzyaaaq4=0
rbf=0.d0
rblap=0.d0
rbgra1=0.d0
rbgra2=0.d0
rbgra3=0.d0
rbsderiv1=0.d0
rbsderiv2=0.d0
rbsderiv3=0.d0
rbsderiv4=0.d0
rbsderiv5=0.d0
rbsderiv6=0.d0
rbf_s=0.d0
rblap_s=0.d0
rbgra1_s=0.d0
rbgra2_s=0.d0
rbgra3_s=0.d0
rbsderiv1_s=0.d0
rbsderiv2_s=0.d0
rbsderiv3_s=0.d0
rbsderiv4_s=0.d0
rbsderiv5_s=0.d0
rbsderiv6_s=0.d0
exp_poly0=0.d0
exp_poly1=0.d0
exp_poly2=0.d0
exp_poly3=0.d0
exp_poly4=0.d0
exp_poly5=0.d0
exp_poly6=0.d0
exp_poly7=0.d0
exp_poly8=0.d0
exp_poly9=0.d0
exp_poly10=0.d0
xyzzyaakt4=.false.
xyzzyaakr4=.true.
xyzzyaaks4(:)=.false.
xyzzyaakv4=.false.
if(complex_states)then
cbf=czero
cblap=czero
cbgra1=czero
cbgra2=czero
cbgra3=czero
cbf_s=czero
cblap_s=czero
cbgra1_s=czero
cbgra2_s=czero
cbgra3_s=czero
cbsderiv1=czero
cbsderiv2=czero
cbsderiv3=czero
cbsderiv4=czero
cbsderiv5=czero
cbsderiv6=czero
cbsderiv1_s=czero
cbsderiv2_s=czero
cbsderiv3_s=czero
cbsderiv4_s=czero
cbsderiv5_s=czero
cbsderiv6_s=czero
endif
do xyzzyaaaa4=1,num_cell
do xyzzyaaab4=1,num_real_k
phase(xyzzyaaab4)=coskdotg(xyzzyaaab4,xyzzyaaaa4)*coskdotg_shift(xyzzy&
&aaab4)
enddo
do xyzzyaaab4=num_real_k_plus_1,num_k
cphase(xyzzyaaab4)=expikdotg(xyzzyaaab4,xyzzyaaaa4)*expikdotg_shift(xy&
&zzyaaab4)
enddo
do xyzzyaaap4=1,num_centres_in_cell(xyzzyaaaa4)
xyzzyaaav4=which_ion(xyzzyaaap4,xyzzyaaaa4)
xyzzyaacq4(1)=xpos_in_cell(xyzzyaaap4,xyzzyaaaa4)
xyzzyaacq4(2)=ypos_in_cell(xyzzyaaap4,xyzzyaaaa4)
xyzzyaacq4(3)=zpos_in_cell(xyzzyaaap4,xyzzyaaaa4)
xyzzyaabb4=new_origin_to_rvec(1)-xyzzyaacq4(1)
xyzzyaabc4=new_origin_to_rvec(2)-xyzzyaacq4(2)
xyzzyaabd4=new_origin_to_rvec(3)-xyzzyaacq4(3)
xyzzyaabe4=xyzzyaabb4*xyzzyaabb4
xyzzyaabf4=xyzzyaabc4*xyzzyaabc4
xyzzyaabg4=xyzzyaabd4*xyzzyaabd4
xyzzyaaba4=xyzzyaabe4+xyzzyaabf4+xyzzyaabg4
xyzzyaabh4=xyzzyaabb4*xyzzyaabc4
xyzzyaabj4=xyzzyaabb4*xyzzyaabd4
xyzzyaabi4=xyzzyaabc4*xyzzyaabd4
if(complex_states)then
select case(ndim)
case(1)
xyzzyaacr4(1)=xyzzyaacq4(1)+new_origin(1)
xyzzyaaad1(1)=xyzzyaacr4(1)*ainv(1,1)+1.d-5
xyzzyaact4(1)=real(floor(xyzzyaaad1(1)),dp)
xyzzyaacs4(1)=xyzzyaact4(1)*amat(1,1)
xyzzyaaad1(1)=xyzzyaacr4(1)-xyzzyaacs4(1)
xyzzyaact4(1)=xyzzyaaad1(1)*painv(1,1)+1.d-5
nnn(1)=floor(xyzzyaact4(1))
case(2)
xyzzyaacr4(1:2)=xyzzyaacq4(1:2)+new_origin(1:2)
xyzzyaaad1(1:2)=matmul(xyzzyaacr4(1:2),ainv(1:2,1:2))+1.d-5
xyzzyaact4(1:2)=real(floor(xyzzyaaad1(1:2)),dp)
xyzzyaacs4(1:2)=matmul(xyzzyaact4(1:2),amat(1:2,1:2))
xyzzyaaad1(1:2)=xyzzyaacr4(1:2)-xyzzyaacs4(1:2)
xyzzyaact4(1:2)=matmul(xyzzyaaad1(1:2),painv(1:2,1:2))+1.d-5
nnn(1:2)=floor(xyzzyaact4(1:2))
case(3)
xyzzyaacr4=xyzzyaacq4+new_origin
xyzzyaaad1=matmul(xyzzyaacr4,ainv)+1.d-5
xyzzyaact4=real(floor(xyzzyaaad1),dp)
xyzzyaacs4=matmul(xyzzyaact4,amat)
xyzzyaaad1=xyzzyaacr4-xyzzyaacs4
xyzzyaact4=matmul(xyzzyaaad1,painv)+1.d-5
nnn=floor(xyzzyaact4)
end select
xyzzyaaav4=nbasis_to_nitot(nnn(1),nnn(2),nnn(3),xyzzyaaav4)
endif
if(is_ae(xyzzyaaav4))then
xyzzyaakq4=xyzzyaaba4<rcusp_sq_max(xyzzyaaav4,xyzzyaaac1)
xyzzyaaks4(1:nuc_nele(jspin))=xyzzyaaba4<rcusp_sq(1:nuc_nele(jspin),xy&
&zzyaaav4,xyzzyaaac1)
do xyzzyaaak4=1,nuc_nele(jspin)
if(xyzzyaaks4(xyzzyaaak4))xyzzyaakt4(xyzzyaaak4)=.true.
enddo
else
xyzzyaakq4=.false.
endif
xyzzyaaau4=num_shells_on_centre(xyzzyaaap4,xyzzyaaaa4)
do xyzzyaaac4=1,xyzzyaaau4
xyzzyaaaq4=xyzzyaaaq4+1
xyzzyaaao4=shell_sequence_number(xyzzyaaaq4)
xyzzyaacd4=min_exponent(xyzzyaaao4)
xyzzyaabq4=xyzzyaacd4*xyzzyaaba4
if(xyzzyaabq4>screening_tolerance)cycle
xyzzyaaad4=shell_am(xyzzyaaao4)
xyzzyaaae4=numao_in_shell(xyzzyaaao4)
xyzzyaaaf4=xyzzyaaae4*3
xyzzyaaag4=xyzzyaaae4*6
do xyzzyaaak4=1,xyzzyaaae4
xyzzyaacm4(xyzzyaaak4)=0.d0
enddo
do xyzzyaaak4=1,xyzzyaaae4
xyzzyaacn4(xyzzyaaak4)=0.d0
enddo
do xyzzyaaak4=1,xyzzyaaaf4
xyzzyaaco4(xyzzyaaak4)=0.d0
enddo
do xyzzyaaak4=1,xyzzyaaag4
xyzzyaacp4(xyzzyaaak4)=0.d0
enddo
xyzzyaaam4=primitive(xyzzyaaao4)
xyzzyaaan4=primitive(xyzzyaaao4+1)-1
xyzzyaaku4=.false.
do xyzzyaaal4=xyzzyaaam4,xyzzyaaan4
xyzzyaacd4=exponent(xyzzyaaal4)
xyzzyaabq4=xyzzyaacd4*xyzzyaaba4
if(xyzzyaabq4>30.d0)cycle
xyzzyaaku4=.true.
xyzzyaakv4(xyzzyaaao4)=.true.
xyzzyaace4=exp(-xyzzyaabq4)
xyzzyaabm4=-xyzzyaacd4-xyzzyaacd4
select case (xyzzyaaad4)
case(1)
xyzzyaaci4(1)=c_prim(xyzzyaaal4)*xyzzyaace4
xyzzyaacf4=xyzzyaaci4(1)*xyzzyaabm4
xyzzyaack4(1)=xyzzyaabb4*xyzzyaacf4
xyzzyaack4(2)=xyzzyaabc4*xyzzyaacf4
xyzzyaack4(3)=xyzzyaabd4*xyzzyaacf4
xyzzyaacl4(1)=(1.d0+xyzzyaabm4*xyzzyaabe4)*xyzzyaacf4
xyzzyaacl4(2)=(1.d0+xyzzyaabm4*xyzzyaabf4)*xyzzyaacf4
xyzzyaacl4(3)=(1.d0+xyzzyaabm4*xyzzyaabg4)*xyzzyaacf4
xyzzyaacj4(1)=xyzzyaacl4(1)+xyzzyaacl4(2)+xyzzyaacl4(3)
xyzzyaacl4(4)=xyzzyaabm4*xyzzyaabc4*xyzzyaack4(1)
xyzzyaacl4(5)=xyzzyaabm4*xyzzyaabd4*xyzzyaack4(1)
xyzzyaacl4(6)=xyzzyaabm4*xyzzyaabd4*xyzzyaack4(2)
case(2)
xyzzyaacf4=c_prim(xyzzyaaal4)*xyzzyaace4
xyzzyaacg4=c_prim2(xyzzyaaal4)*xyzzyaace4
xyzzyaaci4(1)=xyzzyaacf4
xyzzyaaci4(2)=xyzzyaacg4*xyzzyaabb4
xyzzyaaci4(3)=xyzzyaacg4*xyzzyaabc4
xyzzyaaci4(4)=xyzzyaacg4*xyzzyaabd4
xyzzyaack4(1)=xyzzyaabm4*xyzzyaabb4
xyzzyaack4(2)=xyzzyaabm4*xyzzyaabc4
xyzzyaack4(3)=xyzzyaabm4*xyzzyaabd4
xyzzyaack4(4)=1.d0+xyzzyaack4(1)*xyzzyaabb4
xyzzyaack4(5)=xyzzyaack4(1)*xyzzyaabc4
xyzzyaack4(6)=xyzzyaack4(1)*xyzzyaabd4
xyzzyaack4(8)=1.d0+xyzzyaack4(2)*xyzzyaabc4
xyzzyaack4(9)=xyzzyaack4(2)*xyzzyaabd4
xyzzyaack4(7)=xyzzyaack4(5)
xyzzyaack4(10)=xyzzyaack4(6)
xyzzyaack4(11)=xyzzyaack4(9)
xyzzyaack4(12)=1.d0+xyzzyaack4(3)*xyzzyaabd4
xyzzyaacl4(1)=xyzzyaabm4*xyzzyaack4(4)
xyzzyaacl4(2)=xyzzyaabm4*xyzzyaack4(8)
xyzzyaacl4(3)=xyzzyaabm4*xyzzyaack4(12)
xyzzyaacl4(4)=xyzzyaack4(1)*xyzzyaack4(2)
xyzzyaacl4(5)=xyzzyaack4(1)*xyzzyaack4(3)
xyzzyaacl4(6)=xyzzyaack4(2)*xyzzyaack4(3)
xyzzyaacl4(7)=xyzzyaack4(1)*(xyzzyaack4(4)+2.d0)
xyzzyaacl4(10)=xyzzyaack4(2)*xyzzyaack4(4)
xyzzyaacl4(13)=xyzzyaacl4(10)
xyzzyaacl4(11)=xyzzyaack4(3)*xyzzyaack4(4)
xyzzyaacl4(19)=xyzzyaacl4(11)
xyzzyaacl4(8)=xyzzyaack4(1)*xyzzyaack4(8)
xyzzyaacl4(16)=xyzzyaacl4(8)
xyzzyaacl4(14)=xyzzyaack4(2)*(xyzzyaack4(8)+2.d0)
xyzzyaacl4(18)=xyzzyaack4(3)*xyzzyaack4(8)
xyzzyaacl4(20)=xyzzyaacl4(18)
xyzzyaacl4(9)=xyzzyaack4(1)*xyzzyaack4(12)
xyzzyaacl4(23)=xyzzyaacl4(9)
xyzzyaacl4(15)=xyzzyaack4(2)*xyzzyaack4(12)
xyzzyaacl4(24)=xyzzyaacl4(15)
xyzzyaacl4(21)=xyzzyaack4(3)*(xyzzyaack4(12)+2.d0)
xyzzyaacl4(12)=xyzzyaack4(1)*xyzzyaack4(9)
xyzzyaacl4(17)=xyzzyaacl4(12)
xyzzyaacl4(22)=xyzzyaacl4(12)
xyzzyaack4(1:3)=xyzzyaack4(1:3)*xyzzyaacf4
xyzzyaack4(4:12)=xyzzyaack4(4:12)*xyzzyaacg4
xyzzyaacl4(1:6)=xyzzyaacl4(1:6)*xyzzyaacf4
xyzzyaacl4(7:24)=xyzzyaacl4(7:24)*xyzzyaacg4
xyzzyaacj4(1)=xyzzyaacl4(1)+xyzzyaacl4(2)+xyzzyaacl4(3)
xyzzyaacj4(2)=xyzzyaacl4(7)+xyzzyaacl4(8)+xyzzyaacl4(9)
xyzzyaacj4(3)=xyzzyaacl4(13)+xyzzyaacl4(14)+xyzzyaacl4(15)
xyzzyaacj4(4)=xyzzyaacl4(19)+xyzzyaacl4(20)+xyzzyaacl4(21)
case(3)
xyzzyaacg4=c_prim(xyzzyaaal4)*xyzzyaace4
xyzzyaaci4(1)=xyzzyaacg4*xyzzyaabb4
xyzzyaaci4(2)=xyzzyaacg4*xyzzyaabc4
xyzzyaaci4(3)=xyzzyaacg4*xyzzyaabd4
xyzzyaabn4=xyzzyaabm4*xyzzyaabb4
xyzzyaabo4=xyzzyaabm4*xyzzyaabc4
xyzzyaabp4=xyzzyaabm4*xyzzyaabd4
xyzzyaack4(1)=1.d0+xyzzyaabn4*xyzzyaabb4
xyzzyaack4(2)=xyzzyaabn4*xyzzyaabc4
xyzzyaack4(3)=xyzzyaabn4*xyzzyaabd4
xyzzyaack4(5)=1.d0+xyzzyaabo4*xyzzyaabc4
xyzzyaack4(6)=xyzzyaabo4*xyzzyaabd4
xyzzyaack4(9)=1.d0+xyzzyaabp4*xyzzyaabd4
xyzzyaack4(4)=xyzzyaack4(2)
xyzzyaack4(7)=xyzzyaack4(3)
xyzzyaack4(8)=xyzzyaack4(6)
xyzzyaacl4(1)=xyzzyaabn4*(xyzzyaack4(1)+2.d0)
xyzzyaacl4(4)=xyzzyaabo4*xyzzyaack4(1)
xyzzyaacl4(7)=xyzzyaacl4(4)
xyzzyaacl4(5)=xyzzyaabp4*xyzzyaack4(1)
xyzzyaacl4(13)=xyzzyaacl4(5)
xyzzyaacl4(2)=xyzzyaabn4*xyzzyaack4(5)
xyzzyaacl4(10)=xyzzyaacl4(2)
xyzzyaacl4(8)=xyzzyaabo4*(xyzzyaack4(5)+2.d0)
xyzzyaacl4(12)=xyzzyaabp4*xyzzyaack4(5)
xyzzyaacl4(14)=xyzzyaacl4(12)
xyzzyaacl4(3)=xyzzyaabn4*xyzzyaack4(9)
xyzzyaacl4(17)=xyzzyaacl4(3)
xyzzyaacl4(9)=xyzzyaabo4*xyzzyaack4(9)
xyzzyaacl4(18)=xyzzyaacl4(9)
xyzzyaacl4(15)=xyzzyaabp4*(xyzzyaack4(9)+2.d0)
xyzzyaacl4(6)=xyzzyaabn4*xyzzyaack4(6)
xyzzyaacl4(11)=xyzzyaacl4(6)
xyzzyaacl4(16)=xyzzyaacl4(6)
xyzzyaack4(1:9)=xyzzyaack4(1:9)*xyzzyaacg4
xyzzyaacl4(1:18)=xyzzyaacl4(1:18)*xyzzyaacg4
xyzzyaacj4(1)=xyzzyaacl4(1)+xyzzyaacl4(2)+xyzzyaacl4(3)
xyzzyaacj4(2)=xyzzyaacl4(7)+xyzzyaacl4(8)+xyzzyaacl4(9)
xyzzyaacj4(3)=xyzzyaacl4(13)+xyzzyaacl4(14)+xyzzyaacl4(15)
case(4)
xyzzyaabl4=xyzzyaabe4-xyzzyaabf4
xyzzyaabk4=3.d0*xyzzyaabg4-xyzzyaaba4
xyzzyaaci4(1)=xyzzyaabk4
xyzzyaaci4(2)=xyzzyaabj4
xyzzyaaci4(3)=xyzzyaabi4
xyzzyaaci4(4)=xyzzyaabl4
xyzzyaaci4(5)=xyzzyaabh4
xyzzyaach4=c_prim(xyzzyaaal4)*xyzzyaace4
xyzzyaaci4(1:5)=xyzzyaaci4(1:5)*xyzzyaach4
xyzzyaacb4=7.d0+xyzzyaabm4*xyzzyaaba4
xyzzyaacb4=xyzzyaabm4*xyzzyaacb4
xyzzyaacj4(1:5)=xyzzyaaci4(1:5)*xyzzyaacb4
xyzzyaabn4=xyzzyaabm4*xyzzyaabb4
xyzzyaadi4=xyzzyaabn4*xyzzyaabc4
xyzzyaabo4=xyzzyaabm4*xyzzyaabc4
xyzzyaadj4=xyzzyaabn4*xyzzyaabd4
xyzzyaabp4=xyzzyaabm4*xyzzyaabd4
xyzzyaadk4=xyzzyaabo4*xyzzyaabd4
xyzzyaabq4=1.d0+xyzzyaabn4*xyzzyaabb4
xyzzyaabx4=xyzzyaabq4+2.d0
xyzzyaabr4=1.d0+xyzzyaabo4*xyzzyaabc4
xyzzyaaby4=xyzzyaabr4+2.d0
xyzzyaabs4=1.d0+xyzzyaabp4*xyzzyaabd4
xyzzyaabz4=xyzzyaabs4+2.d0
xyzzyaabt4=xyzzyaabm4*xyzzyaabk4-2.d0
xyzzyaabu4=xyzzyaabm4*xyzzyaabl4
xyzzyaack4(1)=xyzzyaabt4*xyzzyaabb4
xyzzyaack4(2)=xyzzyaabt4*xyzzyaabc4
xyzzyaack4(3)=(xyzzyaabt4+6.d0)*xyzzyaabd4
xyzzyaack4(4)=xyzzyaabq4*xyzzyaabd4
xyzzyaack4(5)=xyzzyaabn4*xyzzyaabi4
xyzzyaack4(6)=xyzzyaabs4*xyzzyaabb4
xyzzyaack4(7)=xyzzyaack4(5)
xyzzyaack4(8)=xyzzyaabr4*xyzzyaabd4
xyzzyaack4(9)=xyzzyaabs4*xyzzyaabc4
xyzzyaack4(10)=(2.d0+xyzzyaabm4*xyzzyaabl4)*xyzzyaabb4
xyzzyaack4(11)=(xyzzyaabu4-2.d0)*xyzzyaabc4
xyzzyaack4(12)=xyzzyaabu4*xyzzyaabd4
xyzzyaack4(13)=xyzzyaabq4*xyzzyaabc4
xyzzyaack4(14)=xyzzyaabr4*xyzzyaabb4
xyzzyaack4(15)=xyzzyaack4(5)
xyzzyaack4(1:15)=xyzzyaack4(1:15)*xyzzyaach4
xyzzyaabw4=xyzzyaabe4+xyzzyaabf4-2.d0*xyzzyaabg4
xyzzyaacl4(1)=-xyzzyaabn4*xyzzyaabn4*xyzzyaabw4-xyzzyaabm4*(xyzzyaabw4&
&+4.d0*xyzzyaabe4)-2.d0
xyzzyaacl4(2)=-xyzzyaabo4*xyzzyaabo4*xyzzyaabw4-xyzzyaabm4*(xyzzyaabw4&
&+4.d0*xyzzyaabf4)-2.d0
xyzzyaacl4(3)=-xyzzyaabp4*xyzzyaabp4*xyzzyaabw4-xyzzyaabm4*(xyzzyaabw4&
&-8.d0*xyzzyaabg4)+4.d0
xyzzyaaca4=2.d0*(1.d0+xyzzyaacd4*xyzzyaabw4)
xyzzyaacl4(4)=xyzzyaadi4*(xyzzyaaca4-6.d0)
xyzzyaacl4(5)=xyzzyaadj4*xyzzyaaca4
xyzzyaacl4(6)=xyzzyaadk4*xyzzyaaca4
xyzzyaacl4(7)=xyzzyaadj4*xyzzyaabx4
xyzzyaacl4(8)=xyzzyaadj4*xyzzyaabr4
xyzzyaacl4(9)=xyzzyaadj4*xyzzyaabz4
xyzzyaacl4(10)=xyzzyaadk4*xyzzyaabq4
xyzzyaacl4(11)=(-xyzzyaabq4)*(-xyzzyaabs4)
xyzzyaacl4(12)=xyzzyaadi4*xyzzyaabs4
xyzzyaacl4(13)=xyzzyaacl4(10)
xyzzyaacl4(14)=xyzzyaadk4*xyzzyaaby4
xyzzyaacl4(15)=xyzzyaadk4*xyzzyaabz4
xyzzyaacl4(16)=xyzzyaacl4(8)
xyzzyaacl4(17)=xyzzyaadi4*xyzzyaabs4
xyzzyaacl4(18)=(-xyzzyaabr4)*(-xyzzyaabs4)
xyzzyaacl4(19)=2.d0+xyzzyaabm4*(xyzzyaabq4*xyzzyaabl4+4.d0*xyzzyaabe4)
xyzzyaacl4(20)=xyzzyaabm4*(xyzzyaabr4*xyzzyaabl4-4.d0*xyzzyaabf4)-2.d0
xyzzyaacl4(21)=xyzzyaabm4*xyzzyaabl4*xyzzyaabs4
xyzzyaacl4(22)=xyzzyaabm4*xyzzyaabm4*xyzzyaabh4*xyzzyaabl4
xyzzyaacl4(23)=-2.d0*xyzzyaadj4*(xyzzyaacd4*xyzzyaabl4-1.d0)
xyzzyaacl4(24)=-2.d0*xyzzyaadk4*(xyzzyaacd4*xyzzyaabl4+1.d0)
xyzzyaacl4(25)=xyzzyaadi4*xyzzyaabx4
xyzzyaacl4(26)=xyzzyaadi4*xyzzyaaby4
xyzzyaacl4(27)=xyzzyaacl4(12)
xyzzyaacl4(28)=(-xyzzyaabq4)*(-xyzzyaabr4)
xyzzyaacl4(29)=xyzzyaacl4(10)
xyzzyaacl4(30)=xyzzyaacl4(8)
xyzzyaacl4(1:30)=xyzzyaacl4(1:30)*xyzzyaach4
case(5)
xyzzyaach4=c_prim(xyzzyaaal4)*xyzzyaace4
xyzzyaadl4=xyzzyaabe4*xyzzyaabb4
xyzzyaadm4=xyzzyaabf4*xyzzyaabc4
xyzzyaadn4=xyzzyaabe4*xyzzyaabe4
xyzzyaado4=xyzzyaabf4*xyzzyaabf4
xyzzyaadp4=xyzzyaabg4*xyzzyaabg4
xyzzyaadq4=xyzzyaabe4*xyzzyaabc4
xyzzyaadr4=xyzzyaabe4*xyzzyaabd4
xyzzyaads4=xyzzyaabb4*xyzzyaabf4
xyzzyaadt4=xyzzyaabf4*xyzzyaabd4
xyzzyaadu4=xyzzyaabh4*xyzzyaabd4
xyzzyaaju4=xyzzyaabe4*xyzzyaabf4
xyzzyaajv4=xyzzyaabe4*xyzzyaabg4
xyzzyaajw4=xyzzyaabf4*xyzzyaabg4
xyzzyaadv4=xyzzyaacd4*xyzzyaabe4
xyzzyaadw4=xyzzyaacd4*xyzzyaabf4
xyzzyaadx4=xyzzyaacd4*xyzzyaabg4
xyzzyaajx4=xyzzyaacd4*xyzzyaacd4
xyzzyaajy4=xyzzyaacd4*xyzzyaach4
xyzzyaajz4=xyzzyaabb4*xyzzyaach4
xyzzyaaka4=xyzzyaabc4*xyzzyaach4
xyzzyaakb4=xyzzyaabd4*xyzzyaach4
xyzzyaakc4=3.d0*xyzzyaabe4
xyzzyaakd4=3.d0*xyzzyaabf4
xyzzyaake4=-2.d0*xyzzyaabg4
xyzzyaabq4=xyzzyaakc4+xyzzyaakd4+xyzzyaake4
xyzzyaabr4=xyzzyaacd4*xyzzyaabq4
xyzzyaabs4=-3.d0+xyzzyaabr4
xyzzyaabt4=3.d0*xyzzyaadx4
xyzzyaabu4=-1.5d0+xyzzyaabt4
xyzzyaabv4=-12.d0*xyzzyaabg4
xyzzyaabw4=xyzzyaabv4+xyzzyaakc4+xyzzyaakd4
xyzzyaabx4=xyzzyaacd4*xyzzyaabw4
xyzzyaaby4=-3.d0+xyzzyaabx4
xyzzyaady4=xyzzyaabh4*xyzzyaaby4*xyzzyaach4
xyzzyaadz4=3.d0*xyzzyaadw4
xyzzyaakf4=6.d0*xyzzyaabg4
xyzzyaaea4=-12.d0*xyzzyaadx4
xyzzyaaeb4=12.d0+xyzzyaabx4
xyzzyaaec4=-30.d0*xyzzyaadv4
xyzzyaaed4=30.d0*xyzzyaadw4
xyzzyaaee4=90.d0*xyzzyaadw4
xyzzyaaef4=-45.d0*xyzzyaabf4
xyzzyaakg4=-6.d0*xyzzyaabe4
xyzzyaakh4=-6.d0*xyzzyaabf4
xyzzyaaeg4=xyzzyaakg4+xyzzyaakh4+4.d0*xyzzyaabg4
xyzzyaaeh4=-6.d0*xyzzyaadx4
xyzzyaaei4=3.d0+xyzzyaaeh4
xyzzyaaki4=4.d0*xyzzyaadp4
xyzzyaakj4=15.d0*xyzzyaabe4
xyzzyaaej4=xyzzyaakj4+xyzzyaakd4+xyzzyaake4
xyzzyaaek4=xyzzyaacd4*xyzzyaaej4
xyzzyaael4=xyzzyaajx4*xyzzyaaeg4*xyzzyaabe4
xyzzyaaem4=-3.d0+xyzzyaaek4+xyzzyaael4
xyzzyaaen4=xyzzyaaem4*xyzzyaakb4
xyzzyaakk4=15.d0*xyzzyaabf4
xyzzyaaeo4=xyzzyaakk4+xyzzyaakc4+xyzzyaake4
xyzzyaaep4=xyzzyaacd4*xyzzyaaeo4
xyzzyaaeq4=xyzzyaajx4*xyzzyaaeg4*xyzzyaabf4
xyzzyaaer4=-3.d0+xyzzyaaep4+xyzzyaaeq4
xyzzyaaes4=xyzzyaaer4*xyzzyaakb4
xyzzyaakl4=9.d0*xyzzyaabe4
xyzzyaais4=9.d0*xyzzyaabf4
xyzzyaait4=-14.d0*xyzzyaabg4
xyzzyaaet4=xyzzyaakl4+xyzzyaais4+xyzzyaait4
xyzzyaaeu4=xyzzyaacd4*xyzzyaaet4
xyzzyaaev4=xyzzyaajx4*xyzzyaaeg4*xyzzyaabg4
xyzzyaaew4=6.d0+xyzzyaaeu4+xyzzyaaev4
xyzzyaaex4=xyzzyaaew4*xyzzyaakb4
xyzzyaaiu4=24.d0*xyzzyaabg4
xyzzyaaey4=xyzzyaakg4+xyzzyaakh4+xyzzyaaiu4
xyzzyaaez4=xyzzyaajx4*xyzzyaaey4*xyzzyaabe4
xyzzyaaiv4=21.d0*xyzzyaabe4
xyzzyaaiw4=-36.d0*xyzzyaabg4
xyzzyaafa4=xyzzyaais4+xyzzyaaiv4+xyzzyaaiw4
xyzzyaafb4=xyzzyaacd4*xyzzyaafa4
xyzzyaafc4=-9.d0+xyzzyaafb4+xyzzyaaez4
xyzzyaafd4=xyzzyaafc4*xyzzyaajz4
xyzzyaafe4=xyzzyaabv4+xyzzyaakk4+xyzzyaakc4
xyzzyaaff4=xyzzyaacd4*xyzzyaafe4
xyzzyaafg4=xyzzyaajx4*xyzzyaaey4*xyzzyaabf4
xyzzyaafh4=-3.d0+xyzzyaaff4+xyzzyaafg4
xyzzyaafi4=xyzzyaafh4*xyzzyaajz4
xyzzyaaix4=-60.d0*xyzzyaabg4
xyzzyaafj4=xyzzyaaix4+xyzzyaakc4+xyzzyaakd4
xyzzyaafk4=xyzzyaacd4*xyzzyaafj4
xyzzyaafl4=xyzzyaajx4*xyzzyaaey4*xyzzyaabg4
xyzzyaafm4=12.d0+xyzzyaafk4+xyzzyaafl4
xyzzyaafn4=xyzzyaafm4*xyzzyaajz4
xyzzyaafo4=xyzzyaabv4+xyzzyaakj4+xyzzyaakd4
xyzzyaafp4=xyzzyaacd4*xyzzyaafo4
xyzzyaafq4=-3.d0+xyzzyaaez4+xyzzyaafp4
xyzzyaafr4=xyzzyaafq4*xyzzyaaka4
xyzzyaafs4=xyzzyaacd4*xyzzyaaey4
xyzzyaaft4=-18.d0+xyzzyaafs4
xyzzyaafu4=xyzzyaadu4*xyzzyaaft4*xyzzyaajy4
xyzzyaaiy4=21.d0*xyzzyaabf4
xyzzyaafv4=xyzzyaakl4+xyzzyaaiw4+xyzzyaaiy4
xyzzyaafw4=xyzzyaacd4*xyzzyaafv4
xyzzyaafx4=-9.d0+xyzzyaafg4+xyzzyaafw4
xyzzyaafy4=xyzzyaafx4*xyzzyaaka4
xyzzyaafz4=xyzzyaafm4*xyzzyaaka4
xyzzyaaiz4=30.d0*xyzzyaabf4
xyzzyaaja4=-30.d0*xyzzyaabe4
xyzzyaaga4=-60.d0*xyzzyaadx4
xyzzyaakm4=60.d0*xyzzyaabe4
xyzzyaakn4=-60.d0*xyzzyaabf4
xyzzyaagb4=xyzzyaakm4+xyzzyaakn4
xyzzyaagc4=xyzzyaajx4*xyzzyaagb4*xyzzyaabg4
xyzzyaajb4=-150.d0*xyzzyaabe4
xyzzyaagd4=xyzzyaaiz4+xyzzyaajb4
xyzzyaage4=xyzzyaacd4*xyzzyaagd4
xyzzyaajc4=60.d0*xyzzyaadn4
xyzzyaagf4=-60.d0*xyzzyaaju4
xyzzyaagg4=xyzzyaajc4+xyzzyaagf4
xyzzyaagh4=xyzzyaajx4*xyzzyaagg4
xyzzyaagi4=30.d0+xyzzyaage4+xyzzyaagh4
xyzzyaagj4=xyzzyaagi4*xyzzyaakb4
xyzzyaajd4=150.d0*xyzzyaabf4
xyzzyaagk4=xyzzyaaja4+xyzzyaajd4
xyzzyaagl4=xyzzyaacd4*xyzzyaagk4
xyzzyaagm4=60.d0*xyzzyaaju4
xyzzyaaje4=-60.d0*xyzzyaado4
xyzzyaagn4=xyzzyaagm4+xyzzyaaje4
xyzzyaago4=xyzzyaajx4*xyzzyaagn4
xyzzyaagp4=-30.d0+xyzzyaagl4+xyzzyaago4
xyzzyaagq4=xyzzyaagp4*xyzzyaakb4
xyzzyaagr4=90.d0+xyzzyaaga4
xyzzyaags4=xyzzyaagr4*xyzzyaabf4
xyzzyaagt4=-90.d0-xyzzyaaga4
xyzzyaagu4=xyzzyaagt4*xyzzyaabe4
xyzzyaagv4=xyzzyaags4+xyzzyaagu4
xyzzyaagw4=xyzzyaabd4*xyzzyaagv4*xyzzyaajy4
xyzzyaajf4=-60.d0*xyzzyaadv4
xyzzyaajg4=-60.d0*xyzzyaadw4
xyzzyaajh4=120.d0*xyzzyaadv4
xyzzyaagx4=-180.d0+xyzzyaajh4
xyzzyaagy4=xyzzyaadu4*xyzzyaagx4*xyzzyaajy4
xyzzyaaji4=120.d0*xyzzyaadw4
xyzzyaagz4=-180.d0+xyzzyaaji4
xyzzyaaha4=xyzzyaadu4*xyzzyaagz4*xyzzyaajy4
xyzzyaajj4=120.d0*xyzzyaadx4
xyzzyaahb4=-180.d0+xyzzyaajj4
xyzzyaahc4=xyzzyaadu4*xyzzyaahb4*xyzzyaajy4
xyzzyaajk4=90.d0*xyzzyaabf4
xyzzyaahd4=-180.d0*xyzzyaaju4
xyzzyaahe4=xyzzyaajc4+xyzzyaahd4
xyzzyaahf4=xyzzyaajx4*xyzzyaahe4
xyzzyaahg4=-180.d0*xyzzyaadw4
xyzzyaajl4=-210.d0*xyzzyaabe4
xyzzyaajm4=270.d0*xyzzyaabf4
xyzzyaahh4=xyzzyaajl4+xyzzyaajm4
xyzzyaahi4=xyzzyaacd4*xyzzyaahh4
xyzzyaahj4=90.d0+xyzzyaahi4+xyzzyaahf4
xyzzyaahk4=xyzzyaahj4*xyzzyaajz4
xyzzyaajn4=450.d0*xyzzyaabf4
xyzzyaahl4=xyzzyaaja4+xyzzyaajn4
xyzzyaahm4=xyzzyaacd4*xyzzyaahl4
xyzzyaajo4=-180.d0*xyzzyaado4
xyzzyaahn4=xyzzyaagm4+xyzzyaajo4
xyzzyaaho4=xyzzyaajx4*xyzzyaahn4
xyzzyaahp4=-90.d0+xyzzyaahm4+xyzzyaaho4
xyzzyaahq4=xyzzyaahp4*xyzzyaajz4
xyzzyaahr4=-180.d0*xyzzyaadx4
xyzzyaahs4=90.d0+xyzzyaahr4
xyzzyaaht4=xyzzyaahs4*xyzzyaabf4
xyzzyaahu4=-30.d0-xyzzyaaga4
xyzzyaahv4=xyzzyaahu4*xyzzyaabe4
xyzzyaahw4=xyzzyaaht4+xyzzyaahv4
xyzzyaahx4=xyzzyaabb4*xyzzyaahw4*xyzzyaajy4
xyzzyaahy4=30.d0+xyzzyaaga4
xyzzyaajp4=-90.d0*xyzzyaabe4
xyzzyaahz4=180.d0*xyzzyaaju4
xyzzyaaia4=xyzzyaaje4+xyzzyaahz4
xyzzyaaib4=xyzzyaajx4*xyzzyaaia4
xyzzyaajq4=-450.d0*xyzzyaabe4
xyzzyaaic4=xyzzyaaiz4+xyzzyaajq4
xyzzyaaid4=xyzzyaacd4*xyzzyaaic4
xyzzyaajr4=180.d0*xyzzyaadn4
xyzzyaaie4=xyzzyaagf4+xyzzyaajr4
xyzzyaaif4=xyzzyaajx4*xyzzyaaie4
xyzzyaaig4=90.d0+xyzzyaaid4+xyzzyaaif4
xyzzyaaih4=xyzzyaaig4*xyzzyaaka4
xyzzyaajs4=-270.d0*xyzzyaabe4
xyzzyaajt4=210.d0*xyzzyaabf4
xyzzyaaii4=xyzzyaajs4+xyzzyaajt4
xyzzyaaij4=xyzzyaacd4*xyzzyaaii4
xyzzyaaik4=-9.d1+xyzzyaaij4+xyzzyaaib4
xyzzyaail4=xyzzyaaik4*xyzzyaaka4
xyzzyaaim4=xyzzyaahy4*xyzzyaabf4
xyzzyaain4=180.d0*xyzzyaadx4
xyzzyaaio4=-90.d0+xyzzyaain4
xyzzyaaip4=xyzzyaaio4*xyzzyaabe4
xyzzyaaiq4=xyzzyaaim4+xyzzyaaip4
xyzzyaair4=xyzzyaabc4*xyzzyaaiq4*xyzzyaajy4
xyzzyaaci4(1)=xyzzyaabg4*xyzzyaabd4-1.5d0*(xyzzyaadr4+xyzzyaadt4)
xyzzyaaci4(2)=6.d0*xyzzyaabb4*xyzzyaabg4-1.5d0*(xyzzyaads4+xyzzyaadl4)
xyzzyaaci4(3)=6.d0*xyzzyaabc4*xyzzyaabg4-1.5d0*(xyzzyaadq4+xyzzyaadm4)
xyzzyaaci4(4)=15.d0*(xyzzyaadr4-xyzzyaadt4)
xyzzyaaci4(5)=30.d0*xyzzyaadu4
xyzzyaaci4(6)=-45.d0*xyzzyaads4+15.d0*xyzzyaadl4
xyzzyaaci4(7)=45.d0*xyzzyaadq4-15.d0*xyzzyaadm4
xyzzyaaci4(1:7)=xyzzyaaci4(1:7)*xyzzyaach4
xyzzyaack4(1)=xyzzyaabj4*xyzzyaach4*xyzzyaabs4
xyzzyaack4(2)=xyzzyaabi4*xyzzyaach4*xyzzyaabs4
xyzzyaack4(3)=xyzzyaach4*(3.d0*xyzzyaabg4-2.d0*xyzzyaacd4*xyzzyaadp4+x&
&yzzyaabu4*(xyzzyaabe4+xyzzyaabf4))
xyzzyaack4(4)=xyzzyaach4*((-4.5d0+xyzzyaadz4+xyzzyaaea4)*xyzzyaabe4-1.&
&5d0*xyzzyaabf4+3.d0*xyzzyaacd4*xyzzyaadn4+xyzzyaakf4)
xyzzyaack4(5)=xyzzyaady4
xyzzyaack4(6)=xyzzyaabj4*xyzzyaaeb4*xyzzyaach4
xyzzyaack4(7)=xyzzyaady4
xyzzyaack4(8)=xyzzyaach4*(3.d0*xyzzyaacd4*xyzzyaado4+(-1.5d0+xyzzyaadz&
&4)*xyzzyaabe4+(-4.5d0+xyzzyaaea4)*xyzzyaabf4+xyzzyaakf4)
xyzzyaack4(9)=xyzzyaabi4*xyzzyaaeb4*xyzzyaach4
xyzzyaack4(10)=xyzzyaabj4*(30.d0+xyzzyaaec4+xyzzyaaed4)*xyzzyaach4
xyzzyaack4(11)=xyzzyaabi4*(-30.d0+xyzzyaaec4+xyzzyaaed4)*xyzzyaach4
xyzzyaack4(12)=(xyzzyaabe4*(15.d0-30.d0*xyzzyaadx4)+xyzzyaabf4*(-15.d0&
&+30.d0*xyzzyaadx4))*xyzzyaach4
xyzzyaack4(13)=xyzzyaabi4*(30.d0+xyzzyaajf4)*xyzzyaach4
xyzzyaack4(14)=xyzzyaabj4*(30.d0+xyzzyaajg4)*xyzzyaach4
xyzzyaack4(15)=xyzzyaabh4*xyzzyaahy4*xyzzyaach4
xyzzyaack4(16)=xyzzyaach4*(xyzzyaaef4+(45.d0+xyzzyaaee4)*xyzzyaabe4-30&
&.d0*xyzzyaacd4*xyzzyaadn4)
xyzzyaack4(17)=xyzzyaabh4*(-90.d0+xyzzyaaec4+xyzzyaaee4)*xyzzyaach4
xyzzyaack4(18)=xyzzyaacd4*xyzzyaabj4*(xyzzyaaja4+xyzzyaajk4)*xyzzyaach&
&4
xyzzyaack4(19)=xyzzyaabh4*(90.d0+xyzzyaaed4-90.d0*xyzzyaadv4)*xyzzyaac&
&h4
xyzzyaack4(20)=(30.d0*xyzzyaacd4*xyzzyaado4+xyzzyaaef4+xyzzyaabe4*(45.&
&d0-90.d0*xyzzyaadw4))*xyzzyaach4
xyzzyaack4(21)=xyzzyaabi4*(xyzzyaajp4+xyzzyaaiz4)*xyzzyaajy4
xyzzyaacl4(1)=xyzzyaaen4
xyzzyaacl4(2)=xyzzyaaes4
xyzzyaacl4(3)=xyzzyaaex4
xyzzyaacl4(4)=(12.d0+xyzzyaacd4*xyzzyaaeg4)*xyzzyaadu4*xyzzyaajy4
xyzzyaacl4(5)=xyzzyaach4*(xyzzyaacd4*xyzzyaaei4*xyzzyaadl4+xyzzyaabb4*&
&(-3.d0+xyzzyaajx4*(xyzzyaaki4-6.d0*xyzzyaajw4)+xyzzyaacd4*xyzzyaakd4)&
&)
xyzzyaacl4(6)=xyzzyaach4*(xyzzyaacd4*xyzzyaaei4*xyzzyaadm4+xyzzyaabc4*&
&(-3.d0+xyzzyaajx4*(xyzzyaaki4-6.d0*xyzzyaajv4)+xyzzyaacd4*xyzzyaakc4)&
&)
xyzzyaacl4(7)=xyzzyaafd4
xyzzyaacl4(8)=xyzzyaafi4
xyzzyaacl4(9)=xyzzyaafn4
xyzzyaacl4(10)=xyzzyaafr4
xyzzyaacl4(11)=xyzzyaakb4*(12.d0+xyzzyaaez4+xyzzyaacd4*(xyzzyaabv4-15.&
&d0*xyzzyaabe4+xyzzyaakd4))
xyzzyaacl4(12)=xyzzyaafu4
xyzzyaacl4(13)=xyzzyaafr4
xyzzyaacl4(14)=xyzzyaafy4
xyzzyaacl4(15)=xyzzyaafz4
xyzzyaacl4(16)=xyzzyaafi4
xyzzyaacl4(17)=xyzzyaafu4
xyzzyaacl4(18)=xyzzyaakb4*(12.d0+xyzzyaafg4+xyzzyaacd4*(xyzzyaabv4-15.&
&d0*xyzzyaabf4+xyzzyaakc4))
xyzzyaacl4(19)=xyzzyaagj4
xyzzyaacl4(20)=xyzzyaagq4
xyzzyaacl4(21)=xyzzyaagw4
xyzzyaacl4(22)=60.d0*xyzzyaadu4*xyzzyaajx4*(xyzzyaabe4-xyzzyaabf4)*xyz&
&zyaach4
xyzzyaacl4(23)=(30.d0+xyzzyaacd4*(xyzzyaaja4+xyzzyaaiz4+xyzzyaaix4)+xy&
&zzyaagc4)*xyzzyaajz4
xyzzyaacl4(24)=(-30.d0+xyzzyaagc4+xyzzyaacd4*(xyzzyaaja4+xyzzyaaiz4+60&
&.d0*xyzzyaabg4))*xyzzyaaka4
xyzzyaacl4(25)=xyzzyaagy4
xyzzyaacl4(26)=xyzzyaaha4
xyzzyaacl4(27)=xyzzyaahc4
xyzzyaacl4(28)=(30.d0+xyzzyaajf4+xyzzyaajg4+120.d0*xyzzyaajx4*xyzzyaaj&
&u4)*xyzzyaakb4
xyzzyaacl4(29)=(30.d0+xyzzyaajf4+xyzzyaaga4+120.d0*xyzzyaajx4*xyzzyaaj&
&v4)*xyzzyaaka4
xyzzyaacl4(30)=(30.d0+xyzzyaajg4+xyzzyaaga4+120.d0*xyzzyaajx4*xyzzyaaj&
&w4)*xyzzyaajz4
xyzzyaacl4(31)=xyzzyaahk4
xyzzyaacl4(32)=xyzzyaahq4
xyzzyaacl4(33)=xyzzyaahx4
xyzzyaacl4(34)=(-90.d0+xyzzyaahf4+xyzzyaacd4*(xyzzyaajk4+90.d0*xyzzyaa&
&be4))*xyzzyaaka4
xyzzyaacl4(35)=(xyzzyaajk4+(-90.d0+xyzzyaahg4)*xyzzyaabe4+60.d0*xyzzya&
&acd4*xyzzyaadn4)*xyzzyaabd4*xyzzyaajy4
xyzzyaacl4(36)=(180.d0+xyzzyaahg4+60.d0*xyzzyaadv4)*xyzzyaadu4*xyzzyaa&
&jy4
xyzzyaacl4(37)=xyzzyaaih4
xyzzyaacl4(38)=xyzzyaail4
xyzzyaacl4(39)=xyzzyaair4
xyzzyaacl4(40)=(90.d0+xyzzyaaib4+xyzzyaacd4*(xyzzyaajp4-90.d0*xyzzyaab&
&f4))*xyzzyaajz4
xyzzyaacl4(41)=(xyzzyaajg4+180.d0*(xyzzyaadv4-1.d0))*xyzzyaadu4*xyzzya&
&ajy4
xyzzyaacl4(42)=(-60.d0*xyzzyaacd4*xyzzyaado4+xyzzyaajk4+xyzzyaabe4*(-9&
&0.d0+180.d0*xyzzyaadw4))*xyzzyaabd4*xyzzyaajy4
end select
do xyzzyaaak4=1,xyzzyaaae4
xyzzyaacm4(xyzzyaaak4)=xyzzyaacm4(xyzzyaaak4)+xyzzyaaci4(xyzzyaaak4)
enddo
do xyzzyaaak4=1,xyzzyaaae4
xyzzyaacn4(xyzzyaaak4)=xyzzyaacn4(xyzzyaaak4)+xyzzyaacj4(xyzzyaaak4)
enddo
do xyzzyaaak4=1,xyzzyaaaf4
xyzzyaaco4(xyzzyaaak4)=xyzzyaaco4(xyzzyaaak4)+xyzzyaack4(xyzzyaaak4)
enddo
do xyzzyaaak4=1,xyzzyaaag4
xyzzyaacp4(xyzzyaaak4)=xyzzyaacp4(xyzzyaaak4)+xyzzyaacl4(xyzzyaaak4)
enddo
enddo
if(xyzzyaaku4)then
xyzzyaaar4=first_ao(xyzzyaaao4)
xyzzyaaas4=xyzzyaaar4+xyzzyaaae4-1
if(.not.xyzzyaakq4.or.xyzzyaaad4>2)then
do xyzzyaaab4=1,num_real_k
rbf(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbf(xyzzyaaar4:xyzzyaaas4,xyzzya&
&aab4)+xyzzyaacm4(1:xyzzyaaae4)*phase(xyzzyaaab4)
rblap(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rblap(xyzzyaaar4:xyzzyaaas4,xy&
&zzyaaab4)+xyzzyaacn4(1:xyzzyaaae4)*phase(xyzzyaaab4)
rbgra1(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbgra1(xyzzyaaar4:xyzzyaaas4,&
&xyzzyaaab4)+xyzzyaaco4(1:xyzzyaaaf4:3)*phase(xyzzyaaab4)
rbgra2(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbgra2(xyzzyaaar4:xyzzyaaas4,&
&xyzzyaaab4)+xyzzyaaco4(2:xyzzyaaaf4:3)*phase(xyzzyaaab4)
rbgra3(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbgra3(xyzzyaaar4:xyzzyaaas4,&
&xyzzyaaab4)+xyzzyaaco4(3:xyzzyaaaf4:3)*phase(xyzzyaaab4)
rbsderiv1(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbsderiv1(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+xyzzyaacp4(1:xyzzyaaag4:6)*phase(xyzzyaaab4)
rbsderiv2(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbsderiv2(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+xyzzyaacp4(2:xyzzyaaag4:6)*phase(xyzzyaaab4)
rbsderiv3(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbsderiv3(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+xyzzyaacp4(3:xyzzyaaag4:6)*phase(xyzzyaaab4)
rbsderiv4(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbsderiv4(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+xyzzyaacp4(4:xyzzyaaag4:6)*phase(xyzzyaaab4)
rbsderiv5(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbsderiv5(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+xyzzyaacp4(5:xyzzyaaag4:6)*phase(xyzzyaaab4)
rbsderiv6(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbsderiv6(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+xyzzyaacp4(6:xyzzyaaag4:6)*phase(xyzzyaaab4)
enddo
do xyzzyaaab4=num_real_k_plus_1,num_k
xyzzyaakp4=cphase(xyzzyaaab4)
cbf(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbf(xyzzyaaar4:xyzzyaaas4,xyzzya&
&aab4)+cmplx(xyzzyaacm4(1:xyzzyaaae4),0.d0,kind=dp)*xyzzyaakp4
cblap(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cblap(xyzzyaaar4:xyzzyaaas4,xy&
&zzyaaab4)+cmplx(xyzzyaacn4(1:xyzzyaaae4),0.d0,kind=dp)*xyzzyaakp4
cbgra1(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbgra1(xyzzyaaar4:xyzzyaaas4,&
&xyzzyaaab4)+cmplx(xyzzyaaco4(1:xyzzyaaaf4:3),0.d0,kind=dp)*xyzzyaakp4
cbgra2(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbgra2(xyzzyaaar4:xyzzyaaas4,&
&xyzzyaaab4)+cmplx(xyzzyaaco4(2:xyzzyaaaf4:3),0.d0,kind=dp)*xyzzyaakp4
cbgra3(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbgra3(xyzzyaaar4:xyzzyaaas4,&
&xyzzyaaab4)+cmplx(xyzzyaaco4(3:xyzzyaaaf4:3),0.d0,kind=dp)*xyzzyaakp4
cbsderiv1(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbsderiv1(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+cmplx(xyzzyaacp4(1:xyzzyaaag4:6),0.d0,kind=dp)*xyzz&
&yaakp4
cbsderiv2(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbsderiv2(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+cmplx(xyzzyaacp4(2:xyzzyaaag4:6),0.d0,kind=dp)*xyzz&
&yaakp4
cbsderiv3(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbsderiv3(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+cmplx(xyzzyaacp4(3:xyzzyaaag4:6),0.d0,kind=dp)*xyzz&
&yaakp4
cbsderiv4(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbsderiv4(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+cmplx(xyzzyaacp4(4:xyzzyaaag4:6),0.d0,kind=dp)*xyzz&
&yaakp4
cbsderiv5(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbsderiv5(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+cmplx(xyzzyaacp4(5:xyzzyaaag4:6),0.d0,kind=dp)*xyzz&
&yaakp4
cbsderiv6(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbsderiv6(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+cmplx(xyzzyaacp4(6:xyzzyaaag4:6),0.d0,kind=dp)*xyzz&
&yaakp4
enddo
else
xyzzyaaak4=0
do xyzzyaaab4=1,num_real_k
rbf(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbf(xyzzyaaar4:xyzzyaaas4,xyzzya&
&aab4)+xyzzyaacm4(1:xyzzyaaae4)*phase(xyzzyaaab4)
rblap(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rblap(xyzzyaaar4:xyzzyaaas4,xy&
&zzyaaab4)+xyzzyaacn4(1:xyzzyaaae4)*phase(xyzzyaaab4)
rbgra1(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbgra1(xyzzyaaar4:xyzzyaaas4,&
&xyzzyaaab4)+xyzzyaaco4(1:xyzzyaaaf4:3)*phase(xyzzyaaab4)
rbgra2(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbgra2(xyzzyaaar4:xyzzyaaas4,&
&xyzzyaaab4)+xyzzyaaco4(2:xyzzyaaaf4:3)*phase(xyzzyaaab4)
rbgra3(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbgra3(xyzzyaaar4:xyzzyaaas4,&
&xyzzyaaab4)+xyzzyaaco4(3:xyzzyaaaf4:3)*phase(xyzzyaaab4)
rbsderiv1(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbsderiv1(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+xyzzyaacp4(1:xyzzyaaag4:6)*phase(xyzzyaaab4)
rbsderiv2(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbsderiv2(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+xyzzyaacp4(2:xyzzyaaag4:6)*phase(xyzzyaaab4)
rbsderiv3(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbsderiv3(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+xyzzyaacp4(3:xyzzyaaag4:6)*phase(xyzzyaaab4)
rbsderiv4(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbsderiv4(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+xyzzyaacp4(4:xyzzyaaag4:6)*phase(xyzzyaaab4)
rbsderiv5(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbsderiv5(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+xyzzyaacp4(5:xyzzyaaag4:6)*phase(xyzzyaaab4)
rbsderiv6(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=rbsderiv6(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+xyzzyaacp4(6:xyzzyaaag4:6)*phase(xyzzyaaab4)
do xyzzyaaah4=1,nband(xyzzyaaab4,xyzzyaaaa1)
xyzzyaaak4=xyzzyaaak4+1
if(xyzzyaaks4(xyzzyaaak4))then
rbf_s(xyzzyaaar4,xyzzyaaak4)=rbf_s(xyzzyaaar4,xyzzyaaak4)+xyzzyaacm4(1&
&)*phase(xyzzyaaab4)
rblap_s(xyzzyaaar4,xyzzyaaak4)=rblap_s(xyzzyaaar4,xyzzyaaak4)+xyzzyaac&
&n4(1)*phase(xyzzyaaab4)
rbgra1_s(xyzzyaaar4,xyzzyaaak4)=rbgra1_s(xyzzyaaar4,xyzzyaaak4)+xyzzya&
&aco4(1)*phase(xyzzyaaab4)
rbgra2_s(xyzzyaaar4,xyzzyaaak4)=rbgra2_s(xyzzyaaar4,xyzzyaaak4)+xyzzya&
&aco4(2)*phase(xyzzyaaab4)
rbgra3_s(xyzzyaaar4,xyzzyaaak4)=rbgra3_s(xyzzyaaar4,xyzzyaaak4)+xyzzya&
&aco4(3)*phase(xyzzyaaab4)
rbsderiv1_s(xyzzyaaar4,xyzzyaaak4)=rbsderiv1_s(xyzzyaaar4,xyzzyaaak4)+&
&xyzzyaacp4(1)*phase(xyzzyaaab4)
rbsderiv2_s(xyzzyaaar4,xyzzyaaak4)=rbsderiv2_s(xyzzyaaar4,xyzzyaaak4)+&
&xyzzyaacp4(2)*phase(xyzzyaaab4)
rbsderiv3_s(xyzzyaaar4,xyzzyaaak4)=rbsderiv3_s(xyzzyaaar4,xyzzyaaak4)+&
&xyzzyaacp4(3)*phase(xyzzyaaab4)
rbsderiv4_s(xyzzyaaar4,xyzzyaaak4)=rbsderiv4_s(xyzzyaaar4,xyzzyaaak4)+&
&xyzzyaacp4(4)*phase(xyzzyaaab4)
rbsderiv5_s(xyzzyaaar4,xyzzyaaak4)=rbsderiv5_s(xyzzyaaar4,xyzzyaaak4)+&
&xyzzyaacp4(5)*phase(xyzzyaaab4)
rbsderiv6_s(xyzzyaaar4,xyzzyaaak4)=rbsderiv6_s(xyzzyaaar4,xyzzyaaak4)+&
&xyzzyaacp4(6)*phase(xyzzyaaab4)
endif
enddo
enddo
do xyzzyaaab4=num_real_k_plus_1,num_k
xyzzyaako4=cphase(xyzzyaaab4)
cbf(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbf(xyzzyaaar4:xyzzyaaas4,xyzzya&
&aab4)+cmplx(xyzzyaacm4(1:xyzzyaaae4),0.d0,kind=dp)*xyzzyaako4
cblap(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cblap(xyzzyaaar4:xyzzyaaas4,xy&
&zzyaaab4)+cmplx(xyzzyaacn4(1:xyzzyaaae4),0.d0,kind=dp)*xyzzyaako4
cbgra1(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbgra1(xyzzyaaar4:xyzzyaaas4,&
&xyzzyaaab4)+cmplx(xyzzyaaco4(1:xyzzyaaaf4:3),0.d0,kind=dp)*xyzzyaako4
cbgra2(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbgra2(xyzzyaaar4:xyzzyaaas4,&
&xyzzyaaab4)+cmplx(xyzzyaaco4(2:xyzzyaaaf4:3),0.d0,kind=dp)*xyzzyaako4
cbgra3(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbgra3(xyzzyaaar4:xyzzyaaas4,&
&xyzzyaaab4)+cmplx(xyzzyaaco4(3:xyzzyaaaf4:3),0.d0,kind=dp)*xyzzyaako4
cbsderiv1(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbsderiv1(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+cmplx(xyzzyaacp4(1:xyzzyaaag4:6),0.d0,kind=dp)*xyzz&
&yaako4
cbsderiv2(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbsderiv2(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+cmplx(xyzzyaacp4(2:xyzzyaaag4:6),0.d0,kind=dp)*xyzz&
&yaako4
cbsderiv3(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbsderiv3(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+cmplx(xyzzyaacp4(3:xyzzyaaag4:6),0.d0,kind=dp)*xyzz&
&yaako4
cbsderiv4(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbsderiv4(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+cmplx(xyzzyaacp4(4:xyzzyaaag4:6),0.d0,kind=dp)*xyzz&
&yaako4
cbsderiv5(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbsderiv5(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+cmplx(xyzzyaacp4(5:xyzzyaaag4:6),0.d0,kind=dp)*xyzz&
&yaako4
cbsderiv6(xyzzyaaar4:xyzzyaaas4,xyzzyaaab4)=cbsderiv6(xyzzyaaar4:xyzzy&
&aaas4,xyzzyaaab4)+cmplx(xyzzyaacp4(6:xyzzyaaag4:6),0.d0,kind=dp)*xyzz&
&yaako4
do xyzzyaaah4=1,nband(xyzzyaaab4,xyzzyaaaa1)
xyzzyaaak4=xyzzyaaak4+1
if(xyzzyaaks4(xyzzyaaak4))then
cbf_s(xyzzyaaar4,xyzzyaaak4)=cbf_s(xyzzyaaar4,xyzzyaaak4)+cmplx(xyzzya&
&acm4(1),0.d0,kind=dp)*xyzzyaako4
cblap_s(xyzzyaaar4,xyzzyaaak4)=cblap_s(xyzzyaaar4,xyzzyaaak4)+cmplx(xy&
&zzyaacn4(1),0.d0,kind=dp)*xyzzyaako4
cbgra1_s(xyzzyaaar4,xyzzyaaak4)=cbgra1_s(xyzzyaaar4,xyzzyaaak4)+cmplx(&
&xyzzyaaco4(1),0.d0,kind=dp)*xyzzyaako4
cbgra2_s(xyzzyaaar4,xyzzyaaak4)=cbgra2_s(xyzzyaaar4,xyzzyaaak4)+cmplx(&
&xyzzyaaco4(2),0.d0,kind=dp)*xyzzyaako4
cbgra3_s(xyzzyaaar4,xyzzyaaak4)=cbgra3_s(xyzzyaaar4,xyzzyaaak4)+cmplx(&
&xyzzyaaco4(3),0.d0,kind=dp)*xyzzyaako4
cbsderiv1_s(xyzzyaaar4,xyzzyaaak4)=cbsderiv1_s(xyzzyaaar4,xyzzyaaak4)+&
&cmplx(xyzzyaacp4(1),0.d0,kind=dp)*xyzzyaako4
cbsderiv2_s(xyzzyaaar4,xyzzyaaak4)=cbsderiv2_s(xyzzyaaar4,xyzzyaaak4)+&
&cmplx(xyzzyaacp4(2),0.d0,kind=dp)*xyzzyaako4
cbsderiv3_s(xyzzyaaar4,xyzzyaaak4)=cbsderiv3_s(xyzzyaaar4,xyzzyaaak4)+&
&cmplx(xyzzyaacp4(3),0.d0,kind=dp)*xyzzyaako4
cbsderiv4_s(xyzzyaaar4,xyzzyaaak4)=cbsderiv4_s(xyzzyaaar4,xyzzyaaak4)+&
&cmplx(xyzzyaacp4(4),0.d0,kind=dp)*xyzzyaako4
cbsderiv5_s(xyzzyaaar4,xyzzyaaak4)=cbsderiv5_s(xyzzyaaar4,xyzzyaaak4)+&
&cmplx(xyzzyaacp4(5),0.d0,kind=dp)*xyzzyaako4
cbsderiv6_s(xyzzyaaar4,xyzzyaaak4)=cbsderiv6_s(xyzzyaaar4,xyzzyaaak4)+&
&cmplx(xyzzyaacp4(6),0.d0,kind=dp)*xyzzyaako4
endif
xyzzyaaak4=xyzzyaaak4+1
if(xyzzyaaks4(xyzzyaaak4))then
cbf_s(xyzzyaaar4,xyzzyaaak4)=cbf_s(xyzzyaaar4,xyzzyaaak4)+cmplx(xyzzya&
&acm4(1),0.d0,kind=dp)*xyzzyaako4
cblap_s(xyzzyaaar4,xyzzyaaak4)=cblap_s(xyzzyaaar4,xyzzyaaak4)+cmplx(xy&
&zzyaacn4(1),0.d0,kind=dp)*xyzzyaako4
cbgra1_s(xyzzyaaar4,xyzzyaaak4)=cbgra1_s(xyzzyaaar4,xyzzyaaak4)+cmplx(&
&xyzzyaaco4(1),0.d0,kind=dp)*xyzzyaako4
cbgra2_s(xyzzyaaar4,xyzzyaaak4)=cbgra2_s(xyzzyaaar4,xyzzyaaak4)+cmplx(&
&xyzzyaaco4(2),0.d0,kind=dp)*xyzzyaako4
cbgra3_s(xyzzyaaar4,xyzzyaaak4)=cbgra3_s(xyzzyaaar4,xyzzyaaak4)+cmplx(&
&xyzzyaaco4(3),0.d0,kind=dp)*xyzzyaako4
cbsderiv1_s(xyzzyaaar4,xyzzyaaak4)=cbsderiv1_s(xyzzyaaar4,xyzzyaaak4)+&
&cmplx(xyzzyaacp4(1),0.d0,kind=dp)*xyzzyaako4
cbsderiv2_s(xyzzyaaar4,xyzzyaaak4)=cbsderiv2_s(xyzzyaaar4,xyzzyaaak4)+&
&cmplx(xyzzyaacp4(2),0.d0,kind=dp)*xyzzyaako4
cbsderiv3_s(xyzzyaaar4,xyzzyaaak4)=cbsderiv3_s(xyzzyaaar4,xyzzyaaak4)+&
&cmplx(xyzzyaacp4(3),0.d0,kind=dp)*xyzzyaako4
cbsderiv4_s(xyzzyaaar4,xyzzyaaak4)=cbsderiv4_s(xyzzyaaar4,xyzzyaaak4)+&
&cmplx(xyzzyaacp4(4),0.d0,kind=dp)*xyzzyaako4
cbsderiv5_s(xyzzyaaar4,xyzzyaaak4)=cbsderiv5_s(xyzzyaaar4,xyzzyaaak4)+&
&cmplx(xyzzyaacp4(5),0.d0,kind=dp)*xyzzyaako4
cbsderiv6_s(xyzzyaaar4,xyzzyaaak4)=cbsderiv6_s(xyzzyaaar4,xyzzyaaak4)+&
&cmplx(xyzzyaacp4(6),0.d0,kind=dp)*xyzzyaako4
endif
enddo
enddo
endif
endif
enddo
if(xyzzyaakq4)then
xyzzyaaak4=0
if(xyzzyaaba4/=0.d0)then
xyzzyaacc4=sqrt(xyzzyaaba4)
xyzzyaacu4=1.d0/xyzzyaacc4
xyzzyaacv4=2.d0*xyzzyaacu4
xyzzyaacw4=xyzzyaabb4*xyzzyaacu4
xyzzyaacx4=xyzzyaabc4*xyzzyaacu4
xyzzyaacy4=xyzzyaabd4*xyzzyaacu4
else
xyzzyaacc4=0.d0
xyzzyaacu4=1.d0
xyzzyaacv4=2.d0
xyzzyaacw4=1.d0
xyzzyaacx4=1.d0
xyzzyaacy4=1.d0
endif
do xyzzyaaab4=1,num_real_k
do xyzzyaaah4=1,nband(xyzzyaaab4,xyzzyaaaa1)
xyzzyaaak4=xyzzyaaak4+1
if(xyzzyaaks4(xyzzyaaak4))then
xyzzyaadd4=acusp(1,xyzzyaaak4,xyzzyaaav4,xyzzyaaac1)
xyzzyaade4=acusp(2,xyzzyaaak4,xyzzyaaav4,xyzzyaaac1)
xyzzyaadf4=acusp(3,xyzzyaaak4,xyzzyaaav4,xyzzyaaac1)
xyzzyaadg4=acusp(4,xyzzyaaak4,xyzzyaaav4,xyzzyaaac1)
xyzzyaadh4=acusp(5,xyzzyaaak4,xyzzyaaav4,xyzzyaaac1)
xyzzyaacz4=xyzzyaadd4+xyzzyaade4*xyzzyaacc4
xyzzyaada4=xyzzyaade4+2.d0*xyzzyaadf4*xyzzyaacc4
xyzzyaadb4=2.d0*xyzzyaadf4+6.d0*xyzzyaadg4*xyzzyaacc4
xyzzyaadc4=xyzzyaacc4*xyzzyaacc4
xyzzyaacz4=xyzzyaacz4+xyzzyaadf4*xyzzyaadc4
xyzzyaada4=xyzzyaada4+3.d0*xyzzyaadg4*xyzzyaadc4
xyzzyaadb4=xyzzyaadb4+12.d0*xyzzyaadh4*xyzzyaadc4
xyzzyaadc4=xyzzyaadc4*xyzzyaacc4
xyzzyaacz4=xyzzyaacz4+xyzzyaadg4*xyzzyaadc4
xyzzyaada4=xyzzyaada4+4.d0*xyzzyaadh4*xyzzyaadc4
xyzzyaadc4=xyzzyaadc4*xyzzyaacc4
xyzzyaacz4=xyzzyaacz4+xyzzyaadh4*xyzzyaadc4
xyzzyaabq4=exp(xyzzyaacz4)*disign(xyzzyaaak4,xyzzyaaav4,xyzzyaaac1)
xyzzyaabr4=xyzzyaabq4*xyzzyaada4
xyzzyaabs4=(xyzzyaacv4+xyzzyaada4)*xyzzyaada4+xyzzyaadb4
xyzzyaabt4=xyzzyaada4*(xyzzyaada4-xyzzyaacu4)+xyzzyaadb4
xyzzyaabt4=xyzzyaabt4*xyzzyaacu4**2
xyzzyaabu4=xyzzyaada4*xyzzyaacu4
xyzzyaabv4=xyzzyaabt4*xyzzyaabq4
exp_poly0(xyzzyaaak4)=exp_poly0(xyzzyaaak4)+xyzzyaabq4+pshift(xyzzyaaa&
&k4,xyzzyaaav4,xyzzyaaac1)
exp_poly1(xyzzyaaak4)=exp_poly1(xyzzyaaak4)+xyzzyaabq4*xyzzyaabs4
exp_poly2(xyzzyaaak4)=exp_poly2(xyzzyaaak4)+xyzzyaabr4*xyzzyaacw4
exp_poly3(xyzzyaaak4)=exp_poly3(xyzzyaaak4)+xyzzyaabr4*xyzzyaacx4
exp_poly4(xyzzyaaak4)=exp_poly4(xyzzyaaak4)+xyzzyaabr4*xyzzyaacy4
exp_poly5(xyzzyaaak4)=exp_poly5(xyzzyaaak4)+(xyzzyaabu4+xyzzyaabt4*xyz&
&zyaabe4)*xyzzyaabq4
exp_poly6(xyzzyaaak4)=exp_poly6(xyzzyaaak4)+(xyzzyaabu4+xyzzyaabt4*xyz&
&zyaabf4)*xyzzyaabq4
exp_poly7(xyzzyaaak4)=exp_poly7(xyzzyaaak4)+(xyzzyaabu4+xyzzyaabt4*xyz&
&zyaabg4)*xyzzyaabq4
exp_poly8(xyzzyaaak4)=exp_poly8(xyzzyaaak4)+xyzzyaabv4*xyzzyaabh4
exp_poly9(xyzzyaaak4)=exp_poly9(xyzzyaaak4)+xyzzyaabv4*xyzzyaabj4
exp_poly10(xyzzyaaak4)=exp_poly10(xyzzyaaak4)+xyzzyaabv4*xyzzyaabi4
endif
enddo
enddo
do xyzzyaaab4=num_real_k_plus_1,num_k
do xyzzyaaah4=1,nband(xyzzyaaab4,xyzzyaaaa1)
do xyzzyaaat4=0,1
xyzzyaaak4=xyzzyaaak4+1
if(xyzzyaaak4>nemax)exit
if(xyzzyaaks4(xyzzyaaak4))then
xyzzyaadd4=acusp(1,xyzzyaaak4,xyzzyaaav4,xyzzyaaac1)
xyzzyaade4=acusp(2,xyzzyaaak4,xyzzyaaav4,xyzzyaaac1)
xyzzyaadf4=acusp(3,xyzzyaaak4,xyzzyaaav4,xyzzyaaac1)
xyzzyaadg4=acusp(4,xyzzyaaak4,xyzzyaaav4,xyzzyaaac1)
xyzzyaadh4=acusp(5,xyzzyaaak4,xyzzyaaav4,xyzzyaaac1)
xyzzyaacz4=xyzzyaadd4+xyzzyaade4*xyzzyaacc4
xyzzyaada4=xyzzyaade4+2.d0*xyzzyaadf4*xyzzyaacc4
xyzzyaadb4=2.d0*xyzzyaadf4+6.d0*xyzzyaadg4*xyzzyaacc4
xyzzyaadc4=xyzzyaacc4*xyzzyaacc4
xyzzyaacz4=xyzzyaacz4+xyzzyaadf4*xyzzyaadc4
xyzzyaada4=xyzzyaada4+3.d0*xyzzyaadg4*xyzzyaadc4
xyzzyaadb4=xyzzyaadb4+12.d0*xyzzyaadh4*xyzzyaadc4
xyzzyaadc4=xyzzyaadc4*xyzzyaacc4
xyzzyaacz4=xyzzyaacz4+xyzzyaadg4*xyzzyaadc4
xyzzyaada4=xyzzyaada4+4.d0*xyzzyaadh4*xyzzyaadc4
xyzzyaadc4=xyzzyaadc4*xyzzyaacc4
xyzzyaacz4=xyzzyaacz4+xyzzyaadh4*xyzzyaadc4
xyzzyaabq4=exp(xyzzyaacz4)*disign(xyzzyaaak4,xyzzyaaav4,xyzzyaaac1)+ps&
&hift(xyzzyaaak4,xyzzyaaav4,xyzzyaaac1)
xyzzyaabr4=xyzzyaabq4*xyzzyaada4
xyzzyaabs4=(xyzzyaacv4+xyzzyaada4)*xyzzyaada4+xyzzyaadb4
xyzzyaabt4=xyzzyaada4*(xyzzyaada4-xyzzyaacu4)+xyzzyaadb4
xyzzyaabt4=xyzzyaabt4*xyzzyaacu4**2
xyzzyaabu4=xyzzyaada4*xyzzyaacu4
xyzzyaabv4=xyzzyaabt4*xyzzyaabq4
exp_poly0(xyzzyaaak4)=exp_poly0(xyzzyaaak4)+xyzzyaabq4
exp_poly1(xyzzyaaak4)=exp_poly1(xyzzyaaak4)+xyzzyaabq4*xyzzyaabs4
exp_poly2(xyzzyaaak4)=exp_poly2(xyzzyaaak4)+xyzzyaabr4*xyzzyaacw4
exp_poly3(xyzzyaaak4)=exp_poly3(xyzzyaaak4)+xyzzyaabr4*xyzzyaacx4
exp_poly4(xyzzyaaak4)=exp_poly4(xyzzyaaak4)+xyzzyaabr4*xyzzyaacy4
exp_poly5(xyzzyaaak4)=exp_poly5(xyzzyaaak4)+(xyzzyaabu4+xyzzyaabt4*xyz&
&zyaabe4)*xyzzyaabq4
exp_poly6(xyzzyaaak4)=exp_poly6(xyzzyaaak4)+(xyzzyaabu4+xyzzyaabt4*xyz&
&zyaabf4)*xyzzyaabq4
exp_poly7(xyzzyaaak4)=exp_poly7(xyzzyaaak4)+(xyzzyaabu4+xyzzyaabt4*xyz&
&zyaabg4)*xyzzyaabq4
exp_poly8(xyzzyaaak4)=exp_poly8(xyzzyaaak4)+xyzzyaabv4*xyzzyaabh4
exp_poly9(xyzzyaaak4)=exp_poly9(xyzzyaaak4)+xyzzyaabv4*xyzzyaabj4
exp_poly10(xyzzyaaak4)=exp_poly10(xyzzyaaak4)+xyzzyaabv4*xyzzyaabi4
endif
enddo
enddo
enddo
xyzzyaakr4=.false.
endif
enddo
enddo
if(.not.xyzzyaakr4)then
exp_poly0(1:nuc_nele(jspin))=exp_poly0(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly1(1:nuc_nele(jspin))=exp_poly1(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly2(1:nuc_nele(jspin))=exp_poly2(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly3(1:nuc_nele(jspin))=exp_poly3(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly4(1:nuc_nele(jspin))=exp_poly4(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly5(1:nuc_nele(jspin))=exp_poly5(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly6(1:nuc_nele(jspin))=exp_poly6(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly7(1:nuc_nele(jspin))=exp_poly7(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly8(1:nuc_nele(jspin))=exp_poly8(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly9(1:nuc_nele(jspin))=exp_poly9(1:nuc_nele(jspin))*one_over_rno&
&rm
exp_poly10(1:nuc_nele(jspin))=exp_poly10(1:nuc_nele(jspin))*one_over_r&
&norm
endif
xyzzyaaai4=0
xyzzyaaaj4=0
xyzzyaaay4=gauss_offset(jspin)
xyzzyaaaz4=gauss_offsetc(jspin)
if(xyzzyaakr4)then
xyzzyaaaw4=0
do xyzzyaaao4=1,num_shells
if(.not.xyzzyaakv4(xyzzyaaao4))cycle
xyzzyaaar4=first_ao(xyzzyaaao4)-1
do xyzzyaaak4=1,numao_in_shell(xyzzyaaao4)
xyzzyaaaw4=xyzzyaaaw4+1
xyzzyaaax4(xyzzyaaaw4)=xyzzyaaar4+xyzzyaaak4
enddo
enddo
do xyzzyaaab4=1,num_real_k
xyzzyaaau4=nband(xyzzyaaab4,xyzzyaaaa1)
orb1(xyzzyaaai4+1:xyzzyaaai4+xyzzyaaau4)=multi_ddot_s(xyzzyaaau4,xyzzy&
&aaaw4,xyzzyaaax4,corbmask(xyzzyaaaj4+xyzzyaaaz4),rck(:,:,xyzzyaaab4,x&
&yzzyaaab1),maxb*num_ao,maxb,rbf(1,xyzzyaaab4),1.d0)
orb2(xyzzyaaai4+1:xyzzyaaai4+xyzzyaaau4)=multi_ddot_s(xyzzyaaau4,xyzzy&
&aaaw4,xyzzyaaax4,corbmask(xyzzyaaaj4+xyzzyaaaz4),rck(:,:,xyzzyaaab4,x&
&yzzyaaab1),maxb*num_ao,maxb,rblap(1,xyzzyaaab4),1.d0)
orb3(xyzzyaaai4+1:xyzzyaaai4+xyzzyaaau4)=multi_ddot_s(xyzzyaaau4,xyzzy&
&aaaw4,xyzzyaaax4,corbmask(xyzzyaaaj4+xyzzyaaaz4),rck(:,:,xyzzyaaab4,x&
&yzzyaaab1),maxb*num_ao,maxb,rbgra1(1,xyzzyaaab4),1.d0)
orb4(xyzzyaaai4+1:xyzzyaaai4+xyzzyaaau4)=multi_ddot_s(xyzzyaaau4,xyzzy&
&aaaw4,xyzzyaaax4,corbmask(xyzzyaaaj4+xyzzyaaaz4),rck(:,:,xyzzyaaab4,x&
&yzzyaaab1),maxb*num_ao,maxb,rbgra2(1,xyzzyaaab4),1.d0)
orb5(xyzzyaaai4+1:xyzzyaaai4+xyzzyaaau4)=multi_ddot_s(xyzzyaaau4,xyzzy&
&aaaw4,xyzzyaaax4,corbmask(xyzzyaaaj4+xyzzyaaaz4),rck(:,:,xyzzyaaab4,x&
&yzzyaaab1),maxb*num_ao,maxb,rbgra3(1,xyzzyaaab4),1.d0)
orb6(xyzzyaaai4+1:xyzzyaaai4+xyzzyaaau4)=multi_ddot_s(xyzzyaaau4,xyzzy&
&aaaw4,xyzzyaaax4,corbmask(xyzzyaaaj4+xyzzyaaaz4),rck(:,:,xyzzyaaab4,x&
&yzzyaaab1),maxb*num_ao,maxb,rbsderiv5(1,xyzzyaaab4),1.d0)
orb7(xyzzyaaai4+1:xyzzyaaai4+xyzzyaaau4)=multi_ddot_s(xyzzyaaau4,xyzzy&
&aaaw4,xyzzyaaax4,corbmask(xyzzyaaaj4+xyzzyaaaz4),rck(:,:,xyzzyaaab4,x&
&yzzyaaab1),maxb*num_ao,maxb,rbsderiv5(1,xyzzyaaab4),1.d0)
orb8(xyzzyaaai4+1:xyzzyaaai4+xyzzyaaau4)=multi_ddot_s(xyzzyaaau4,xyzzy&
&aaaw4,xyzzyaaax4,corbmask(xyzzyaaaj4+xyzzyaaaz4),rck(:,:,xyzzyaaab4,x&
&yzzyaaab1),maxb*num_ao,maxb,rbsderiv5(1,xyzzyaaab4),1.d0)
orb9(xyzzyaaai4+1:xyzzyaaai4+xyzzyaaau4)=multi_ddot_s(xyzzyaaau4,xyzzy&
&aaaw4,xyzzyaaax4,corbmask(xyzzyaaaj4+xyzzyaaaz4),rck(:,:,xyzzyaaab4,x&
&yzzyaaab1),maxb*num_ao,maxb,rbsderiv5(1,xyzzyaaab4),1.d0)
orb10(xyzzyaaai4+1:xyzzyaaai4+xyzzyaaau4)=multi_ddot_s(xyzzyaaau4,xyzz&
&yaaaw4,xyzzyaaax4,corbmask(xyzzyaaaj4+xyzzyaaaz4),rck(:,:,xyzzyaaab4,&
&xyzzyaaab1),maxb*num_ao,maxb,rbsderiv5(1,xyzzyaaab4),1.d0)
orb11(xyzzyaaai4+1:xyzzyaaai4+xyzzyaaau4)=multi_ddot_s(xyzzyaaau4,xyzz&
&yaaaw4,xyzzyaaax4,corbmask(xyzzyaaaj4+xyzzyaaaz4),rck(:,:,xyzzyaaab4,&
&xyzzyaaab1),maxb*num_ao,maxb,rbsderiv6(1,xyzzyaaab4),1.d0)
xyzzyaaai4=xyzzyaaai4+xyzzyaaau4
xyzzyaaaj4=xyzzyaaaj4+xyzzyaaau4
enddo
if(complex_states)then
do xyzzyaaab4=num_real_k_plus_1,num_k
xyzzyaaau4=nband(xyzzyaaab4,xyzzyaaaa1)
corb1(1:xyzzyaaau4)=multi_zdotu_s(xyzzyaaau4,xyzzyaaaw4,xyzzyaaax4,cor&
&bmask(xyzzyaaaj4+xyzzyaaaz4),cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_&
&ao,maxb,cbf(1,xyzzyaaab4),1.d0)
corb2(1:xyzzyaaau4)=multi_zdotu_s(xyzzyaaau4,xyzzyaaaw4,xyzzyaaax4,cor&
&bmask(xyzzyaaaj4+xyzzyaaaz4),cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_&
&ao,maxb,cblap(1,xyzzyaaab4),1.d0)
corb3(1:xyzzyaaau4)=multi_zdotu_s(xyzzyaaau4,xyzzyaaaw4,xyzzyaaax4,cor&
&bmask(xyzzyaaaj4+xyzzyaaaz4),cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_&
&ao,maxb,cbgra1(1,xyzzyaaab4),1.d0)
corb4(1:xyzzyaaau4)=multi_zdotu_s(xyzzyaaau4,xyzzyaaaw4,xyzzyaaax4,cor&
&bmask(xyzzyaaaj4+xyzzyaaaz4),cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_&
&ao,maxb,cbgra2(1,xyzzyaaab4),1.d0)
corb5(1:xyzzyaaau4)=multi_zdotu_s(xyzzyaaau4,xyzzyaaaw4,xyzzyaaax4,cor&
&bmask(xyzzyaaaj4+xyzzyaaaz4),cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_&
&ao,maxb,cbgra3(1,xyzzyaaab4),1.d0)
corb6(1:xyzzyaaau4)=multi_zdotu_s(xyzzyaaau4,xyzzyaaaw4,xyzzyaaax4,cor&
&bmask(xyzzyaaaj4+xyzzyaaaz4),cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_&
&ao,maxb,cbsderiv1(1,xyzzyaaab4),1.d0)
corb7(1:xyzzyaaau4)=multi_zdotu_s(xyzzyaaau4,xyzzyaaaw4,xyzzyaaax4,cor&
&bmask(xyzzyaaaj4+xyzzyaaaz4),cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_&
&ao,maxb,cbsderiv2(1,xyzzyaaab4),1.d0)
corb8(1:xyzzyaaau4)=multi_zdotu_s(xyzzyaaau4,xyzzyaaaw4,xyzzyaaax4,cor&
&bmask(xyzzyaaaj4+xyzzyaaaz4),cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_&
&ao,maxb,cbsderiv3(1,xyzzyaaab4),1.d0)
corb9(1:xyzzyaaau4)=multi_zdotu_s(xyzzyaaau4,xyzzyaaaw4,xyzzyaaax4,cor&
&bmask(xyzzyaaaj4+xyzzyaaaz4),cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_&
&ao,maxb,cbsderiv4(1,xyzzyaaab4),1.d0)
corb10(1:xyzzyaaau4)=multi_zdotu_s(xyzzyaaau4,xyzzyaaaw4,xyzzyaaax4,co&
&rbmask(xyzzyaaaj4+xyzzyaaaz4),cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num&
&_ao,maxb,cbsderiv5(1,xyzzyaaab4),1.d0)
corb11(1:xyzzyaaau4)=multi_zdotu_s(xyzzyaaau4,xyzzyaaaw4,xyzzyaaax4,co&
&rbmask(xyzzyaaaj4+xyzzyaaaz4),cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num&
&_ao,maxb,cbsderiv6(1,xyzzyaaab4),1.d0)
do xyzzyaaak4=1,xyzzyaaau4
xyzzyaaai4=xyzzyaaai4+1
xyzzyaaaj4=xyzzyaaaj4+1
if(.not.corbmask(xyzzyaaaj4+xyzzyaaaz4-1))cycle
orb1(xyzzyaaai4)=2.d0*real(corb1(xyzzyaaah4),dp)
orb2(xyzzyaaai4)=2.d0*real(corb2(xyzzyaaah4),dp)
orb3(xyzzyaaai4)=2.d0*real(corb3(xyzzyaaah4),dp)
orb4(xyzzyaaai4)=2.d0*real(corb4(xyzzyaaah4),dp)
orb5(xyzzyaaai4)=2.d0*real(corb5(xyzzyaaah4),dp)
orb6(xyzzyaaai4)=2.d0*real(corb6(xyzzyaaah4),dp)
orb7(xyzzyaaai4)=2.d0*real(corb7(xyzzyaaah4),dp)
orb8(xyzzyaaai4)=2.d0*real(corb8(xyzzyaaah4),dp)
orb9(xyzzyaaai4)=2.d0*real(corb9(xyzzyaaah4),dp)
orb10(xyzzyaaai4)=2.d0*real(corb10(xyzzyaaah4),dp)
orb11(xyzzyaaai4)=2.d0*real(corb11(xyzzyaaah4),dp)
if(xyzzyaaai4+1<=nuc_nele(jspin))then
xyzzyaaai4=xyzzyaaai4+1
orb1(xyzzyaaai4)=2.d0*aimag(corb1(xyzzyaaah4))
orb2(xyzzyaaai4)=2.d0*aimag(corb2(xyzzyaaah4))
orb3(xyzzyaaai4)=2.d0*aimag(corb3(xyzzyaaah4))
orb4(xyzzyaaai4)=2.d0*aimag(corb4(xyzzyaaah4))
orb5(xyzzyaaai4)=2.d0*aimag(corb5(xyzzyaaah4))
orb6(xyzzyaaai4)=2.d0*aimag(corb6(xyzzyaaah4))
orb7(xyzzyaaai4)=2.d0*aimag(corb7(xyzzyaaah4))
orb8(xyzzyaaai4)=2.d0*aimag(corb8(xyzzyaaah4))
orb9(xyzzyaaai4)=2.d0*aimag(corb9(xyzzyaaah4))
orb10(xyzzyaaai4)=2.d0*aimag(corb10(xyzzyaaah4))
orb11(xyzzyaaai4)=2.d0*aimag(corb11(xyzzyaaah4))
endif
enddo
enddo
endif
else
do xyzzyaaab4=1,num_real_k
do xyzzyaaah4=1,nband(xyzzyaaab4,xyzzyaaaa1)
xyzzyaaai4=xyzzyaaai4+1
xyzzyaaaj4=xyzzyaaaj4+1
if(.not.corbmask(xyzzyaaaj4+xyzzyaaaz4-1))cycle
if(xyzzyaakt4(xyzzyaaai4))then
rbf_s(1:num_ao,xyzzyaaai4)=rbf(1:num_ao,xyzzyaaab4)-rbf_s(1:num_ao,xyz&
&zyaaai4)
rblap_s(1:num_ao,xyzzyaaai4)=rblap(1:num_ao,xyzzyaaab4)-rblap_s(1:num_&
&ao,xyzzyaaai4)
rbgra1_s(1:num_ao,xyzzyaaai4)=rbgra1(1:num_ao,xyzzyaaab4)-rbgra1_s(1:n&
&um_ao,xyzzyaaai4)
rbgra2_s(1:num_ao,xyzzyaaai4)=rbgra2(1:num_ao,xyzzyaaab4)-rbgra2_s(1:n&
&um_ao,xyzzyaaai4)
rbgra3_s(1:num_ao,xyzzyaaai4)=rbgra3(1:num_ao,xyzzyaaab4)-rbgra3_s(1:n&
&um_ao,xyzzyaaai4)
rbsderiv1_s(1:num_ao,xyzzyaaai4)=rbsderiv1(1:num_ao,xyzzyaaab4)-rbsder&
&iv1_s(1:num_ao,xyzzyaaai4)
rbsderiv2_s(1:num_ao,xyzzyaaai4)=rbsderiv2(1:num_ao,xyzzyaaab4)-rbsder&
&iv2_s(1:num_ao,xyzzyaaai4)
rbsderiv3_s(1:num_ao,xyzzyaaai4)=rbsderiv3(1:num_ao,xyzzyaaab4)-rbsder&
&iv3_s(1:num_ao,xyzzyaaai4)
rbsderiv4_s(1:num_ao,xyzzyaaai4)=rbsderiv4(1:num_ao,xyzzyaaab4)-rbsder&
&iv4_s(1:num_ao,xyzzyaaai4)
rbsderiv5_s(1:num_ao,xyzzyaaai4)=rbsderiv5(1:num_ao,xyzzyaaab4)-rbsder&
&iv5_s(1:num_ao,xyzzyaaai4)
rbsderiv6_s(1:num_ao,xyzzyaaai4)=rbsderiv6(1:num_ao,xyzzyaaab4)-rbsder&
&iv6_s(1:num_ao,xyzzyaaai4)
orb1(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbf_s(1,xyzzyaaai4))
orb2(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rblap_s(1,xyzzyaaai4))
orb3(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbgra1_s(1,xyzzyaaai4))
orb4(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbgra2_s(1,xyzzyaaai4))
orb5(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbgra3_s(1,xyzzyaaai4))
orb6(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbsderiv1_s(1,xyzzyaaai4))
orb7(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbsderiv2_s(1,xyzzyaaai4))
orb8(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbsderiv3_s(1,xyzzyaaai4))
orb9(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbsderiv4_s(1,xyzzyaaai4))
orb10(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*&
&num_ao,xyzzyaaah4,maxb,rbsderiv5_s(1,xyzzyaaai4))
orb11(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*&
&num_ao,xyzzyaaah4,maxb,rbsderiv6_s(1,xyzzyaaai4))
orb1(xyzzyaaai4)=orb1(xyzzyaaai4)+exp_poly0(xyzzyaaai4)
orb2(xyzzyaaai4)=orb2(xyzzyaaai4)+exp_poly1(xyzzyaaai4)
orb3(xyzzyaaai4)=orb3(xyzzyaaai4)+exp_poly2(xyzzyaaai4)
orb4(xyzzyaaai4)=orb4(xyzzyaaai4)+exp_poly3(xyzzyaaai4)
orb5(xyzzyaaai4)=orb5(xyzzyaaai4)+exp_poly4(xyzzyaaai4)
orb6(xyzzyaaai4)=orb6(xyzzyaaai4)+exp_poly5(xyzzyaaai4)
orb7(xyzzyaaai4)=orb7(xyzzyaaai4)+exp_poly6(xyzzyaaai4)
orb8(xyzzyaaai4)=orb8(xyzzyaaai4)+exp_poly7(xyzzyaaai4)
orb9(xyzzyaaai4)=orb9(xyzzyaaai4)+exp_poly8(xyzzyaaai4)
orb10(xyzzyaaai4)=orb10(xyzzyaaai4)+exp_poly9(xyzzyaaai4)
orb11(xyzzyaaai4)=orb11(xyzzyaaai4)+exp_poly10(xyzzyaaai4)
else
orb1(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbf(1,xyzzyaaab4))
orb2(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rblap(1,xyzzyaaab4))
orb3(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbgra1(1,xyzzyaaab4))
orb4(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbgra2(1,xyzzyaaab4))
orb5(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbgra3(1,xyzzyaaab4))
orb6(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbsderiv1(1,xyzzyaaab4))
orb7(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbsderiv2(1,xyzzyaaab4))
orb8(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbsderiv3(1,xyzzyaaab4))
orb9(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*n&
&um_ao,xyzzyaaah4,maxb,rbsderiv4(1,xyzzyaaab4))
orb10(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*&
&num_ao,xyzzyaaah4,maxb,rbsderiv5(1,xyzzyaaab4))
orb11(xyzzyaaai4)=ddot_alt(num_ao,rck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*&
&num_ao,xyzzyaaah4,maxb,rbsderiv6(1,xyzzyaaab4))
endif
enddo
enddo
if(complex_states)then
do xyzzyaaab4=num_real_k_plus_1,num_k
do xyzzyaaah4=1,nband(xyzzyaaab4,xyzzyaaaa1)
corb1(1)=czero
corb2(1)=czero
corb3(1)=czero
corb4(1)=czero
corb5(1)=czero
corb6(1)=czero
corb7(1)=czero
corb8(1)=czero
corb9(1)=czero
corb10(1)=czero
corb11(1)=czero
xyzzyaaai4=xyzzyaaai4+1
xyzzyaaaj4=xyzzyaaaj4+1
if(.not.corbmask(xyzzyaaaj4+xyzzyaaaz4-1))cycle
if(xyzzyaakt4(xyzzyaaai4).and.xyzzyaakt4(xyzzyaaai4+1))then
cbf_s(1:num_ao,xyzzyaaai4)=cbf(1:num_ao,xyzzyaaab4)-cbf_s(1:num_ao,xyz&
&zyaaai4)
cblap_s(1:num_ao,xyzzyaaai4)=cblap(1:num_ao,xyzzyaaab4)-cblap_s(1:num_&
&ao,xyzzyaaai4)
cbgra1_s(1:num_ao,xyzzyaaai4)=cbgra1(1:num_ao,xyzzyaaab4)-cbgra1_s(1:n&
&um_ao,xyzzyaaai4)
cbgra2_s(1:num_ao,xyzzyaaai4)=cbgra2(1:num_ao,xyzzyaaab4)-cbgra2_s(1:n&
&um_ao,xyzzyaaai4)
cbgra3_s(1:num_ao,xyzzyaaai4)=cbgra3(1:num_ao,xyzzyaaab4)-cbgra3_s(1:n&
&um_ao,xyzzyaaai4)
cbsderiv1_s(1:num_ao,xyzzyaaai4)=cbsderiv1(1:num_ao,xyzzyaaab4)-cbsder&
&iv1_s(1:num_ao,xyzzyaaai4)
cbsderiv2_s(1:num_ao,xyzzyaaai4)=cbsderiv2(1:num_ao,xyzzyaaab4)-cbsder&
&iv2_s(1:num_ao,xyzzyaaai4)
cbsderiv3_s(1:num_ao,xyzzyaaai4)=cbsderiv3(1:num_ao,xyzzyaaab4)-cbsder&
&iv3_s(1:num_ao,xyzzyaaai4)
cbsderiv4_s(1:num_ao,xyzzyaaai4)=cbsderiv4(1:num_ao,xyzzyaaab4)-cbsder&
&iv4_s(1:num_ao,xyzzyaaai4)
cbsderiv5_s(1:num_ao,xyzzyaaai4)=cbsderiv5(1:num_ao,xyzzyaaab4)-cbsder&
&iv5_s(1:num_ao,xyzzyaaai4)
cbsderiv6_s(1:num_ao,xyzzyaaai4)=cbsderiv6(1:num_ao,xyzzyaaab4)-cbsder&
&iv6_s(1:num_ao,xyzzyaaai4)
corb1(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbf_s(1,xyzzyaaai4))
corb2(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cblap_s(1,xyzzyaaai4))
corb3(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra1_s(1,xyzzyaaai4))
corb4(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra2_s(1,xyzzyaaai4))
corb5(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra3_s(1,xyzzyaaai4))
corb6(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv1_s(1,xyzzyaaai4))
corb7(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv2_s(1,xyzzyaaai4))
corb8(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv3_s(1,xyzzyaaai4))
corb9(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv4_s(1,xyzzyaaai4))
corb10(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah4,maxb,cbsderiv5_s(1,xyzzyaaai4))
corb11(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah4,maxb,cbsderiv6_s(1,xyzzyaaai4))
orb1(xyzzyaaai4)=2.d0*real(corb1(1),dp)+exp_poly0(xyzzyaaai4)
orb2(xyzzyaaai4)=2.d0*real(corb2(1),dp)+exp_poly1(xyzzyaaai4)
orb3(xyzzyaaai4)=2.d0*real(corb3(1),dp)+exp_poly2(xyzzyaaai4)
orb4(xyzzyaaai4)=2.d0*real(corb4(1),dp)+exp_poly3(xyzzyaaai4)
orb5(xyzzyaaai4)=2.d0*real(corb5(1),dp)+exp_poly4(xyzzyaaai4)
orb6(xyzzyaaai4)=2.d0*real(corb6(1),dp)+exp_poly5(xyzzyaaai4)
orb7(xyzzyaaai4)=2.d0*real(corb7(1),dp)+exp_poly6(xyzzyaaai4)
orb8(xyzzyaaai4)=2.d0*real(corb8(1),dp)+exp_poly7(xyzzyaaai4)
orb9(xyzzyaaai4)=2.d0*real(corb9(1),dp)+exp_poly8(xyzzyaaai4)
orb10(xyzzyaaai4)=2.d0*real(corb10(1),dp)+exp_poly9(xyzzyaaai4)
orb11(xyzzyaaai4)=2.d0*real(corb11(1),dp)+exp_poly10(xyzzyaaai4)
if(xyzzyaaai4+1<=nuc_nele(jspin))then
xyzzyaaai4=xyzzyaaai4+1
orb1(xyzzyaaai4)=2.d0*aimag(corb1(1))+exp_poly0(xyzzyaaai4)
orb2(xyzzyaaai4)=2.d0*aimag(corb2(1))+exp_poly1(xyzzyaaai4)
orb3(xyzzyaaai4)=2.d0*aimag(corb3(1))+exp_poly2(xyzzyaaai4)
orb4(xyzzyaaai4)=2.d0*aimag(corb4(1))+exp_poly3(xyzzyaaai4)
orb5(xyzzyaaai4)=2.d0*aimag(corb5(1))+exp_poly4(xyzzyaaai4)
orb6(xyzzyaaai4)=2.d0*aimag(corb6(1))+exp_poly5(xyzzyaaai4)
orb7(xyzzyaaai4)=2.d0*aimag(corb7(1))+exp_poly6(xyzzyaaai4)
orb8(xyzzyaaai4)=2.d0*aimag(corb8(1))+exp_poly7(xyzzyaaai4)
orb9(xyzzyaaai4)=2.d0*aimag(corb9(1))+exp_poly8(xyzzyaaai4)
orb10(xyzzyaaai4)=2.d0*aimag(corb10(1))+exp_poly9(xyzzyaaai4)
orb11(xyzzyaaai4)=2.d0*aimag(corb11(1))+exp_poly10(xyzzyaaai4)
endif
else
if(xyzzyaakt4(xyzzyaaai4))then
cbf_s(1:num_ao,xyzzyaaai4)=cbf(1:num_ao,xyzzyaaab4)-cbf_s(1:num_ao,xyz&
&zyaaai4)
cblap_s(1:num_ao,xyzzyaaai4)=cblap(1:num_ao,xyzzyaaab4)-cblap_s(1:num_&
&ao,xyzzyaaai4)
cbgra1_s(1:num_ao,xyzzyaaai4)=cbgra1(1:num_ao,xyzzyaaab4)-cbgra1_s(1:n&
&um_ao,xyzzyaaai4)
cbgra2_s(1:num_ao,xyzzyaaai4)=cbgra2(1:num_ao,xyzzyaaab4)-cbgra2_s(1:n&
&um_ao,xyzzyaaai4)
cbgra3_s(1:num_ao,xyzzyaaai4)=cbgra3(1:num_ao,xyzzyaaab4)-cbgra3_s(1:n&
&um_ao,xyzzyaaai4)
cbsderiv1_s(1:num_ao,xyzzyaaai4)=cbsderiv1(1:num_ao,xyzzyaaab4)-cbsder&
&iv1_s(1:num_ao,xyzzyaaai4)
cbsderiv2_s(1:num_ao,xyzzyaaai4)=cbsderiv2(1:num_ao,xyzzyaaab4)-cbsder&
&iv2_s(1:num_ao,xyzzyaaai4)
cbsderiv3_s(1:num_ao,xyzzyaaai4)=cbsderiv3(1:num_ao,xyzzyaaab4)-cbsder&
&iv3_s(1:num_ao,xyzzyaaai4)
cbsderiv4_s(1:num_ao,xyzzyaaai4)=cbsderiv4(1:num_ao,xyzzyaaab4)-cbsder&
&iv4_s(1:num_ao,xyzzyaaai4)
cbsderiv5_s(1:num_ao,xyzzyaaai4)=cbsderiv5(1:num_ao,xyzzyaaab4)-cbsder&
&iv5_s(1:num_ao,xyzzyaaai4)
cbsderiv6_s(1:num_ao,xyzzyaaai4)=cbsderiv6(1:num_ao,xyzzyaaab4)-cbsder&
&iv6_s(1:num_ao,xyzzyaaai4)
corb1(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbf_s(1,xyzzyaaai4))
corb2(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cblap_s(1,xyzzyaaai4))
corb3(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra1_s(1,xyzzyaaai4))
corb4(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra2_s(1,xyzzyaaai4))
corb5(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra3_s(1,xyzzyaaai4))
corb6(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv1_s(1,xyzzyaaai4))
corb7(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv2_s(1,xyzzyaaai4))
corb8(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv3_s(1,xyzzyaaai4))
corb9(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv4_s(1,xyzzyaaai4))
corb10(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah4,maxb,cbsderiv5_s(1,xyzzyaaai4))
corb11(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah4,maxb,cbsderiv6_s(1,xyzzyaaai4))
orb1(xyzzyaaai4)=2.d0*real(corb1(1),dp)+exp_poly0(xyzzyaaai4)
orb2(xyzzyaaai4)=2.d0*real(corb2(1),dp)+exp_poly1(xyzzyaaai4)
orb3(xyzzyaaai4)=2.d0*real(corb3(1),dp)+exp_poly2(xyzzyaaai4)
orb4(xyzzyaaai4)=2.d0*real(corb4(1),dp)+exp_poly3(xyzzyaaai4)
orb5(xyzzyaaai4)=2.d0*real(corb5(1),dp)+exp_poly4(xyzzyaaai4)
orb6(xyzzyaaai4)=2.d0*real(corb6(1),dp)+exp_poly5(xyzzyaaai4)
orb7(xyzzyaaai4)=2.d0*real(corb7(1),dp)+exp_poly6(xyzzyaaai4)
orb8(xyzzyaaai4)=2.d0*real(corb8(1),dp)+exp_poly7(xyzzyaaai4)
orb9(xyzzyaaai4)=2.d0*real(corb9(1),dp)+exp_poly8(xyzzyaaai4)
orb10(xyzzyaaai4)=2.d0*real(corb10(1),dp)+exp_poly9(xyzzyaaai4)
orb11(xyzzyaaai4)=2.d0*real(corb11(1),dp)+exp_poly10(xyzzyaaai4)
else
corb1(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbf(1,xyzzyaaab4))
corb2(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cblap(1,xyzzyaaab4))
corb3(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra1(1,xyzzyaaab4))
corb4(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra2(1,xyzzyaaab4))
corb5(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra3(1,xyzzyaaab4))
corb6(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv1(1,xyzzyaaab4))
corb7(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv2(1,xyzzyaaab4))
corb8(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv3(1,xyzzyaaab4))
corb9(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv4(1,xyzzyaaab4))
corb10(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah4,maxb,cbsderiv5(1,xyzzyaaab4))
corb11(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah4,maxb,cbsderiv6(1,xyzzyaaab4))
orb1(xyzzyaaai4)=2.d0*real(corb1(1),dp)
orb2(xyzzyaaai4)=2.d0*real(corb2(1),dp)
orb3(xyzzyaaai4)=2.d0*real(corb3(1),dp)
orb4(xyzzyaaai4)=2.d0*real(corb4(1),dp)
orb5(xyzzyaaai4)=2.d0*real(corb5(1),dp)
orb6(xyzzyaaai4)=2.d0*real(corb6(1),dp)
orb7(xyzzyaaai4)=2.d0*real(corb7(1),dp)
orb8(xyzzyaaai4)=2.d0*real(corb8(1),dp)
orb9(xyzzyaaai4)=2.d0*real(corb9(1),dp)
orb10(xyzzyaaai4)=2.d0*real(corb10(1),dp)
orb11(xyzzyaaai4)=2.d0*real(corb11(1),dp)
endif
if(xyzzyaaai4+1<=nuc_nele(jspin))then
xyzzyaaai4=xyzzyaaai4+1
corb1(1)=czero
corb2(1)=czero
corb3(1)=czero
corb4(1)=czero
corb5(1)=czero
corb6(1)=czero
corb7(1)=czero
corb8(1)=czero
corb9(1)=czero
corb10(1)=czero
corb11(1)=czero
if(xyzzyaakt4(xyzzyaaai4))then
cbf_s(1:num_ao,xyzzyaaai4)=cbf(1:num_ao,xyzzyaaab4)-cbf_s(1:num_ao,xyz&
&zyaaai4)
cblap_s(1:num_ao,xyzzyaaai4)=cblap(1:num_ao,xyzzyaaab4)-cblap_s(1:num_&
&ao,xyzzyaaai4)
cbgra1_s(1:num_ao,xyzzyaaai4)=cbgra1(1:num_ao,xyzzyaaab4)-cbgra1_s(1:n&
&um_ao,xyzzyaaai4)
cbgra2_s(1:num_ao,xyzzyaaai4)=cbgra2(1:num_ao,xyzzyaaab4)-cbgra2_s(1:n&
&um_ao,xyzzyaaai4)
cbgra3_s(1:num_ao,xyzzyaaai4)=cbgra3(1:num_ao,xyzzyaaab4)-cbgra3_s(1:n&
&um_ao,xyzzyaaai4)
cbsderiv1_s(1:num_ao,xyzzyaaai4)=cbsderiv1(1:num_ao,xyzzyaaab4)-cbsder&
&iv1_s( 1:num_ao,xyzzyaaai4)
cbsderiv2_s(1:num_ao,xyzzyaaai4)=cbsderiv2(1:num_ao,xyzzyaaab4)-cbsder&
&iv2_s( 1:num_ao,xyzzyaaai4)
cbsderiv3_s(1:num_ao,xyzzyaaai4)=cbsderiv3(1:num_ao,xyzzyaaab4)-cbsder&
&iv3_s( 1:num_ao,xyzzyaaai4)
cbsderiv4_s(1:num_ao,xyzzyaaai4)=cbsderiv4(1:num_ao,xyzzyaaab4)-cbsder&
&iv4_s( 1:num_ao,xyzzyaaai4)
cbsderiv5_s(1:num_ao,xyzzyaaai4)=cbsderiv5(1:num_ao,xyzzyaaab4)-cbsder&
&iv5_s( 1:num_ao,xyzzyaaai4)
cbsderiv6_s(1:num_ao,xyzzyaaai4)=cbsderiv6(1:num_ao,xyzzyaaab4)-cbsder&
&iv6_s( 1:num_ao,xyzzyaaai4)
corb1(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbf_s(1,xyzzyaaai4))
corb2(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cblap_s(1,xyzzyaaai4))
corb3(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra1_s(1,xyzzyaaai4))
corb4(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra2_s(1,xyzzyaaai4))
corb5(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra3_s(1,xyzzyaaai4))
corb6(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv1_s(1,xyzzyaaai4))
corb7(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv2_s(1,xyzzyaaai4))
corb8(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv3_s(1,xyzzyaaai4))
corb9(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv4_s(1,xyzzyaaai4))
corb10(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah4,maxb,cbsderiv5_s(1,xyzzyaaai4))
corb11(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah4,maxb,cbsderiv6_s(1,xyzzyaaai4))
orb1(xyzzyaaai4)=2.d0*aimag(corb1(1))+exp_poly0(xyzzyaaai4)
orb2(xyzzyaaai4)=2.d0*aimag(corb2(1))+exp_poly1(xyzzyaaai4)
orb3(xyzzyaaai4)=2.d0*aimag(corb3(1))+exp_poly2(xyzzyaaai4)
orb4(xyzzyaaai4)=2.d0*aimag(corb4(1))+exp_poly3(xyzzyaaai4)
orb5(xyzzyaaai4)=2.d0*aimag(corb5(1))+exp_poly4(xyzzyaaai4)
orb6(xyzzyaaai4)=2.d0*aimag(corb6(1))+exp_poly5(xyzzyaaai4)
orb7(xyzzyaaai4)=2.d0*aimag(corb7(1))+exp_poly6(xyzzyaaai4)
orb8(xyzzyaaai4)=2.d0*aimag(corb8(1))+exp_poly7(xyzzyaaai4)
orb9(xyzzyaaai4)=2.d0*aimag(corb9(1))+exp_poly8(xyzzyaaai4)
orb10(xyzzyaaai4)=2.d0*aimag(corb10(1))+exp_poly9(xyzzyaaai4)
orb11(xyzzyaaai4)=2.d0*aimag(corb11(1))+exp_poly10(xyzzyaaai4)
else
corb1(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbf(1,xyzzyaaab4))
corb2(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cblap(1,xyzzyaaab4))
corb3(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra1(1,xyzzyaaab4))
corb4(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra2(1,xyzzyaaab4))
corb5(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbgra3(1,xyzzyaaab4))
corb6(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv1(1,xyzzyaaab4))
corb7(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv2(1,xyzzyaaab4))
corb8(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv3(1,xyzzyaaab4))
corb9(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,x&
&yzzyaaah4,maxb,cbsderiv4(1,xyzzyaaab4))
corb10(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah4,maxb,cbsderiv5(1,xyzzyaaab4))
corb11(1)=zdotu_alt(num_ao,cck(:,:,xyzzyaaab4,xyzzyaaab1),maxb*num_ao,&
&xyzzyaaah4,maxb,cbsderiv6(1,xyzzyaaab4))
orb1(xyzzyaaai4)=2.d0*aimag(corb1(1))
orb2(xyzzyaaai4)=2.d0*aimag(corb2(1))
orb3(xyzzyaaai4)=2.d0*aimag(corb3(1))
orb4(xyzzyaaai4)=2.d0*aimag(corb4(1))
orb5(xyzzyaaai4)=2.d0*aimag(corb5(1))
orb6(xyzzyaaai4)=2.d0*aimag(corb6(1))
orb7(xyzzyaaai4)=2.d0*aimag(corb7(1))
orb8(xyzzyaaai4)=2.d0*aimag(corb8(1))
orb9(xyzzyaaai4)=2.d0*aimag(corb9(1))
orb10(xyzzyaaai4)=2.d0*aimag(corb10(1))
orb11(xyzzyaaai4)=2.d0*aimag(corb11(1))
endif
endif
endif
enddo
enddo
endif
endif
orbval(xyzzyaaay4:xyzzyaaai4+xyzzyaaay4-1,1)=orb1(1:xyzzyaaai4)*rnorm
orblap(xyzzyaaay4:xyzzyaaai4+xyzzyaaay4-1,1)=orb2(1:xyzzyaaai4)*rnorm
orbgrad(1,xyzzyaaay4:xyzzyaaai4+xyzzyaaay4-1,1)=orb3(1:xyzzyaaai4)*rno&
&rm
orbgrad(2,xyzzyaaay4:xyzzyaaai4+xyzzyaaay4-1,1)=orb4(1:xyzzyaaai4)*rno&
&rm
orbgrad(3,xyzzyaaay4:xyzzyaaai4+xyzzyaaay4-1,1)=orb5(1:xyzzyaaai4)*rno&
&rm
orbsderivs(1,xyzzyaaay4:xyzzyaaai4+xyzzyaaay4-1,1)=orb6(1:xyzzyaaai4)*&
&rnorm
orbsderivs(2,xyzzyaaay4:xyzzyaaai4+xyzzyaaay4-1,1)=orb7(1:xyzzyaaai4)*&
&rnorm
orbsderivs(3,xyzzyaaay4:xyzzyaaai4+xyzzyaaay4-1,1)=orb8(1:xyzzyaaai4)*&
&rnorm
orbsderivs(4,xyzzyaaay4:xyzzyaaai4+xyzzyaaay4-1,1)=orb9(1:xyzzyaaai4)*&
&rnorm
orbsderivs(5,xyzzyaaay4:xyzzyaaai4+xyzzyaaay4-1,1)=orb10(1:xyzzyaaai4)&
&*rnorm
orbsderivs(6,xyzzyaaay4:xyzzyaaai4+xyzzyaaay4-1,1)=orb11(1:xyzzyaaai4)&
&*rnorm
if(excite)then
do xyzzyaaak4=1,gauss_ex_norb
if(.not.orbmask(gauss_gs_norb+xyzzyaaak4))cycle
xyzzyaaab4=virtual_k(xyzzyaaak4,jspin)
xyzzyaaau4=full2vrt(xyzzyaaak4,jspin)
if(xyzzyaaab4<=num_real_k)then
psi(xyzzyaaak4)  =sum(rbf   (:,xyzzyaaab4)*rck_ex(:,xyzzyaaau4,jspin))
flap(xyzzyaaak4) =sum(rblap (:,xyzzyaaab4)*rck_ex(:,xyzzyaaau4,jspin))
fgra1(xyzzyaaak4)=sum(rbgra1(:,xyzzyaaab4)*rck_ex(:,xyzzyaaau4,jspin))
fgra2(xyzzyaaak4)=sum(rbgra2(:,xyzzyaaab4)*rck_ex(:,xyzzyaaau4,jspin))
fgra3(xyzzyaaak4)=sum(rbgra3(:,xyzzyaaab4)*rck_ex(:,xyzzyaaau4,jspin))
else
psi(xyzzyaaak4)=2.d0*sum(real(cbf(:,xyzzyaaab4)*cck_ex(:,xyzzyaaau4,js&
&pin),dp))
flap(xyzzyaaak4)=2.d0*sum(real(cblap(:,xyzzyaaab4)*cck_ex(:,xyzzyaaau4&
&,jspin),dp))
fgra1(xyzzyaaak4)=2.d0*sum(real(cbgra1(:,xyzzyaaab4)*cck_ex(:,xyzzyaaa&
&u4,jspin),dp))
fgra2(xyzzyaaak4)=2.d0*sum(real(cbgra2(:,xyzzyaaab4)*cck_ex(:,xyzzyaaa&
&u4,jspin),dp))
fgra3(xyzzyaaak4)=2.d0*sum(real(cbgra3(:,xyzzyaaab4)*cck_ex(:,xyzzyaaa&
&u4,jspin),dp))
endif
enddo
do xyzzyaaak4=1,gauss_ex_norb
if(.not.orbmask(gauss_gs_norb+xyzzyaaak4))cycle
orbval(gauss_gs_norb+xyzzyaaak4,1)=psi(xyzzyaaak4)
orblap(gauss_gs_norb+xyzzyaaak4,1)=flap(xyzzyaaak4)
orbgrad(1,gauss_gs_norb+xyzzyaaak4,1)=fgra1(xyzzyaaak4)
orbgrad(2,gauss_gs_norb+xyzzyaaak4,1)=fgra2(xyzzyaaak4)
orbgrad(3,gauss_gs_norb+xyzzyaaak4,1)=fgra3(xyzzyaaak4)
enddo
endif
end subroutine xyzzyaaaf1
end module slaarnaay
