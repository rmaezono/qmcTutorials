TWIST AVERAGING WITH CASTEP AND CASINO
======================================

This directory contains a script "twistav_castep" for carrying out twist
averaging using CASTEP and CASINO.  It runs CASTEP, CASTEP2CASINO, BLIP and
CASINO, then offsets the grid of k vectors randomly and starts again.  The
CASTEP and CASINO output files are put in directories called twist0001,
twist0002, etc.  The progress of the calculation is reported in the STATUS
file.  All the necessary CASTEP and CASINO input files must be set up in
the directory in which the calculation is run.  The CASTEP input file
may either specify a KPOINT_LIST block, containing a complete list of k
vectors (i.e. both members of a +/-k pair must be
given), in which case all values are shifted by the random offset.
Alternatively, the k grid may be specified by the KPOINT_MP_GRID or the
KPOINT_MP_SPACING option, in which case a KPOINT_MP_OFFSET line (which must
not be present in the original input) will be added to the file.
In either case, complex_wf must be T in the CASINO input file.

The script uses runqmc to run the CASINO calculations.  If the script is
being used on a machine with a queueing system then the -batch flag should
be set and the command for running CASINO should be specified with e.g.
-casino "runqmc nnodes 4 time 00:05:00".  The script doesn't currently let
you submit the CASTEP jobs to a queueing system, but the CASTEP runs are
relatively quick.

The script requires the program "twistoffset_castep.f90" to generate the
random offset to the k-vector grid.  (This program is intended to be run
by the twistav_castep script, not by humans.)

There is also a short script called "clearup_twistav", for getting rid of the
results of a twist-averaging run.


Finally, a script called twistanalysis_castep is available to analyse DMC
results generated by twistav_castep.  It extrapolates the DMC results at each
twist to zero time step, then fits

    E_DMC(twist) = <E_DMC> + c.[ E_DFT(twist) - E_DFT(fine k-point mesh) ]

to the DMC energy E_DMC(twist).  <E_DMC> and c are fitting parameters, with
the former being the twist-averaged DMC energy.  E_DFT(twist) is the DFT
energy from the wave-function generation calculation at a particular twist,
while E_DFT(fine k-point mesh) is the DFT energy with a large MP grid.

To use this script:

1. Use twistav_castep to generate the input files for CASINO (i.e., use CASTEP
and CASTEP2CASINO but not CASINO by using the -justcastepblip argument to
twistav_castep).

2. In each twistxxxx directory, create two or more directories that contain
DMC calculations at that twist with different time steps.  (These directories
should contain: input, dmc.hist and dmc.status.)

3. The user will be asked to enter the results of a DFT calculation with a
fine k-point mesh.  In all other regards, this DFT calculation should be the
same as the wave-function-generation calculations.  The twistanalysis_castep
script currently assumes that the density-mixing algorithm is used in CASTEP
(no fixed-occupancy calculations).

4. In the directory containing the twistxxxx directories, run
twistanalysis_castep.  The twist-averaged results will be placed in
twistanalysis.results.
